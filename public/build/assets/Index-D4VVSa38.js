import{r as l,y as R,j as e,Y as I,a as W}from"./app-DCaEnIQ_.js";import{A as q,t as _}from"./authenticated-layout-B6ZEfIqX.js";import{C as T,a as M,b as D,c as k}from"./card-CrukETFe.js";import{B as G}from"./button-BYn5AtxP.js";import{L as j}from"./label-BkhqmzXR.js";import{S as u,a as p,b as f,c as g,e as m}from"./select-DZ9GbxSz.js";import{T as J,a as K,b as Y,c as z,d as P,e as L}from"./table-BLO6Njln.js";import{e as Q,a as U,s as X}from"./startOfMonth-alQccdl5.js";import{f as $}from"./format-7_oTgTIh.js";import"./input-ROFZV3Ig.js";import"./index-BHdoycJG.js";import"./index-C9NISCAZ.js";import"./index-Cr6pMLAT.js";import"./chevron-down-pj6_iuMY.js";function je({studentsWithAttendance:V,clubs:B,organizations:Z,filters:c}){var y,A;const h=new Date().getFullYear(),b=(new Date().getMonth()+1).toString().padStart(2,"0"),[i,S]=l.useState(((y=c.date)==null?void 0:y.split("-")[0])||h.toString()),[d,v]=l.useState(((A=c.date)==null?void 0:A.split("-")[1])||b),[o,w]=l.useState(()=>({club_id:c.club_id||"",organization_id:c.organization_id||""}));l.useEffect(()=>{const t=setTimeout(()=>{const a=`${i}-${d}`,s={...o,date:a};R.get(route("admin.attendances.index"),s,{preserveState:!0,replace:!0,only:["studentsWithAttendance"]})},300);return()=>clearTimeout(t)},[i,d,o.club_id,o.organization_id]);const N=new Date(`${i}-${d}-01`),C=Q({start:X(N),end:U(N)}),[E,F]=l.useState(V),H=async(t,a,s)=>{const n=s?"present":"absent";try{await W.post(route("admin.attendances.toggle"),{student_id:t,date:a,status:n}),F(x=>x.map(r=>({...r,records:r.student.id===t?{...r.records,[a]:n}:r.records}))),_.success(`Attendance marked as ${n}`)}catch{_.error("Failed to update attendance")}},O=()=>{S(h.toString()),v(b),w({club_id:"",organization_id:""})};return e.jsxs(q,{header:"Attendances",children:[e.jsx(I,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-5",children:e.jsxs(T,{children:[e.jsx(M,{className:"flex flex-row items-center justify-between",children:e.jsx(D,{children:"Filters"})}),e.jsx(k,{children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(j,{className:"text-sm mb-1",children:"Club"}),e.jsxs(u,{value:o.club_id,onValueChange:t=>w(a=>({...a,club_id:t})),children:[e.jsx(p,{children:e.jsx(f,{placeholder:"All Clubs"})}),e.jsxs(g,{children:[e.jsx(m,{value:"all",children:"All"}),B.map(t=>e.jsx(m,{value:t.id.toString(),children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(j,{className:"text-sm mb-1",children:"Year"}),e.jsxs(u,{value:i,onValueChange:S,children:[e.jsx(p,{children:e.jsx(f,{placeholder:"Year"})}),e.jsx(g,{children:Array.from({length:5},(t,a)=>(h-a).toString()).map(t=>e.jsx(m,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(j,{className:"text-sm mb-1",children:"Month"}),e.jsxs(u,{value:d,onValueChange:v,children:[e.jsx(p,{children:e.jsx(f,{placeholder:"Month"})}),e.jsx(g,{children:Array.from({length:12},(t,a)=>{const s=(a+1).toString().padStart(2,"0");return e.jsx(m,{value:s,children:new Date(0,a).toLocaleString("default",{month:"long"})},s)})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(G,{className:"bg-primary text-black",onClick:O,children:"Reset Filters"})})]})})]})}),e.jsx("div",{className:"container mx-auto",children:e.jsxs(T,{children:[e.jsx(M,{children:e.jsx(D,{children:"Attendance List"})}),e.jsx(k,{children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx(z,{children:"Student"}),C.map(t=>e.jsx(z,{className:"text-center min-w-[40px]",children:$(t,"dd")},t.toString()))]})}),e.jsx(P,{children:E.map(({student:t,records:a})=>e.jsxs(Y,{children:[e.jsx(L,{children:t.name}),C.map(s=>{const n=$(s,"yyyy-MM-dd"),x=a[n];return e.jsx(L,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:x==="present",onChange:r=>H(t.id,n,r.target.checked)})},n)})]},t.id))})]})})})})]})})]})}export{je as default};
