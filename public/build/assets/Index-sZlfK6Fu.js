import{r as c,j as e,Y as G,b as j,y as F}from"./app-DA1l7Pz2.js";import{B as m}from"./button-Gy5bETBI.js";import{B as X}from"./badge-CCwunBC7.js";import{A as Q,B as Z,D as ee,a as se,b as ae,c as h}from"./authenticated-layout-Cm50mDP7.js";import{S as b,a as N,b as w,c as S,e as n}from"./select-BQWZ1kLl.js";import{D as te}from"./DataTable-DkXI1nMY.js";import{C as g,a as v,b as f,c as y}from"./card-ZeUXod8E.js";import{L as C}from"./label-C4prtjBf.js";import{D as le,a as re,b as ne,c as ie,d as ce,e as oe}from"./dialog-C1vFvh2b.js";import{s as r}from"./index-sFwGSaal.js";import{W as U}from"./wallet-D0WVAAOE.js";import{H as de}from"./hourglass-BTaeeI1R.js";import{E as me}from"./ellipsis-Ctegt4N9.js";import{S as he}from"./square-pen-EadRlnHQ.js";import{C as xe}from"./circle-check-big-CFwyMg5k.js";import{C as ue}from"./circle-x-D7hkOPQn.js";import{T as pe}from"./trash-2-BSBV37O0.js";import{F as je}from"./file-text-DPCVAiK_.js";import{D as ge}from"./download-DIu56G-Q.js";import"./input-DxV1BBW2.js";import"./separator-BSkw8R2-.js";import"./index-BPW7cAYa.js";import"./sun-CWJzmtv-.js";import"./users-OAYQJbng.js";import"./log-out-BN-MizCe.js";import"./index-ymjLEhg1.js";import"./index-D85rk6Z2.js";import"./chevron-down-BJ8BK26W.js";import"./table-CHDeVmLV.js";const D=(i,l)=>{const o=Number(i)||0;return l==="JPY"?o.toLocaleString():o.toFixed(2)},ve=new Date().getFullYear(),fe=["All",...Array.from({length:5},(i,l)=>(ve-l).toString())],ye=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function Ge({payments:i,filters:l,amountsByCurrency:o={},defaultCurrencyCode:x="MYR",currencies:H=[]}){var E,I,L,V;const[A,R]=c.useState(l.status||""),[M,_]=c.useState(l.currency_code||""),[P,B]=c.useState(l.month?l.month.length===4?l.month:l.month.split("-")[0]:"All"),[k,Y]=c.useState(((E=l.month)==null?void 0:E.split("-")[1])||""),J=({year:s,month:a,status:p,currency:d})=>{const T=s==="All"?"":a?`${s}-${a}`:s;F.get(r("club.payments.index"),{status:p||null,month:T||null,currency_code:d||null},{preserveScroll:!0,preserveState:!0,replace:!0})},[K,W]=c.useState(!0),[t,u]=c.useState({open:!1,payment:null,newStatus:null});c.useEffect(()=>{if(K){W(!1);return}J({year:P,month:k,status:A,currency:M})},[P,k,A,M]);const $=()=>{R(""),B("All"),Y(""),_(""),F.get(r("club.payments.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})},q=[{header:"#",cell:({row:s})=>s.index+1},{header:"Student",cell:({row:s})=>{var a;return((a=s.original.student)==null?void 0:a.name)||"-"}},{header:"Amount",cell:({row:s})=>{var O;const a=s.original,p=a.amount,d=a.currency_code,T=((O=a.currency)==null?void 0:O.symbol)||d,z=D(p,d);return e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[d==="MYR"?"RM ":T,z]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:d})]})}},{header:"Status",cell:({row:s})=>e.jsx(X,{variant:s.original.status==="paid"||s.original.status==="success"?"default":"destructive",children:s.original.status})},{header:"Method",accessorKey:"method"},{header:"Month",accessorKey:"month"},{header:"Pay At",accessorKey:"pay_at"},{header:"Actions",cell:({row:s})=>e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(ae,{align:"end",children:[e.jsx(h,{asChild:!0,children:e.jsxs(j,{href:r("club.payments.edit",s.original.id),children:[e.jsx(he,{className:"w-4 h-4 mr-2"})," Edit"]})}),s.original.status==="unpaid"&&e.jsxs(h,{onClick:a=>{a.preventDefault(),u({open:!0,payment:s.original,newStatus:"paid"})},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Mark as Paid"]}),(s.original.status==="paid"||s.original.status==="success")&&e.jsxs(h,{onClick:a=>{a.preventDefault(),u({open:!0,payment:s.original,newStatus:"unpaid"})},children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Mark as Unpaid"]}),e.jsx(h,{asChild:!0,children:e.jsxs(j,{href:r("club.payments.destroy",s.original.id),method:"delete",as:"button",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"})," Delete"]})}),e.jsx(h,{asChild:!0,children:e.jsxs(j,{href:r("invoice.show",{payment:s.original.id}),children:[e.jsx(je,{className:"w-4 h-4 mr-2"})," Invoice"]})}),e.jsxs(h,{onClick:a=>{a.preventDefault();const p=r("invoice.download",{payment:s.original.id});window.open(p,"_blank")},children:[e.jsx(ge,{className:"w-4 h-4 mr-2"})," Download Invoice"]})]})]})}];return e.jsxs(Q,{header:"Payments",children:[e.jsx(G,{title:"Payments"}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-muted-foreground",children:"Payment Overview"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6",children:[e.jsxs(g,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20 col-span-1 sm:col-span-2 lg:col-span-3 xl:col-span-4",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Total Revenue"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(U,{className:"h-6 w-6 text-primary"})})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[x==="MYR"?"RM":x," ",D(o[x]||0,x)]}),Object.keys(o).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(o).filter(([s])=>s!==x).map(([s,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s,":"]}),e.jsx("span",{children:D(a,s)})]},s))})]})})})]}),e.jsxs(g,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Total Payments"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(U,{className:"h-6 w-6 text-primary"})})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:i.length})})]}),e.jsxs(g,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Paid"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Z,{className:"h-6 w-6 text-green-600"})})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:i.filter(s=>s.status==="paid").length})})]}),e.jsxs(g,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Unpaid"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(de,{className:"h-6 w-6 text-yellow-500"})})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:i.filter(s=>s.status==="unpaid").length})})]})]})]}),e.jsxs(g,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between",children:[e.jsx(f,{children:"Payments"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{href:r("club.payments.bulk-generate"),children:e.jsx(m,{variant:"outline",children:"Bulk Generate"})}),e.jsx(j,{href:r("club.payments.create"),children:e.jsx(m,{children:"Add Payment"})})]})]}),e.jsxs(y,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(C,{className:"text-sm mb-1",children:"Year"}),e.jsxs(b,{value:P,onValueChange:s=>{B(s),s==="All"&&Y("")},children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Year"})}),e.jsx(S,{children:fe.map(s=>e.jsx(n,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(C,{className:"text-sm mb-1",children:"Month"}),e.jsxs(b,{value:k,onValueChange:s=>Y(s==="all"?"":s),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Month"})}),e.jsxs(S,{children:[e.jsx(n,{value:"all",children:"All"}),ye.map(s=>e.jsx(n,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(C,{className:"text-sm mb-1",children:"Status"}),e.jsxs(b,{value:A,onValueChange:s=>R(s==="all"?"":s),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"All Statuses"})}),e.jsxs(S,{children:[e.jsx(n,{value:"all",children:"All"}),e.jsx(n,{value:"paid",children:"Paid"}),e.jsx(n,{value:"unpaid",children:"Unpaid"})]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(C,{className:"text-sm mb-1",children:"Currency"}),e.jsxs(b,{value:M,onValueChange:s=>_(s==="all"?"":s),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"All Currencies"})}),e.jsxs(S,{children:[e.jsx(n,{value:"all",children:"All"}),H.map(s=>e.jsxs(n,{value:s.code,children:[s.code," -"," ",s.symbol]},s.code))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(m,{variant:"secondary",onClick:$,children:"Reset Filters"})})]})}),e.jsx(te,{data:i,columns:q})]})]})]}),e.jsx(le,{open:t.open,onOpenChange:s=>{s||u({open:!1,payment:null,newStatus:null})},children:e.jsxs(re,{children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Confirm Status Change"}),e.jsxs(ce,{children:["Are you sure you want to change the payment status from"," ",e.jsx("strong",{children:((I=t.payment)==null?void 0:I.status)==="paid"?"Paid":"Unpaid"})," ","to"," ",e.jsx("strong",{children:t.newStatus==="paid"?"Paid":"Unpaid"}),"?"]})]}),t.payment&&e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Student:"})," ",(L=t.payment.student)==null?void 0:L.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",((V=t.payment.currency)==null?void 0:V.symbol)||"",D(t.payment.amount,t.payment.currency_code)," ",t.payment.currency_code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Month:"})," ",t.payment.month]})]})}),e.jsxs(oe,{children:[e.jsx(m,{variant:"outline",onClick:()=>{u({open:!1,payment:null,newStatus:null})},children:"Cancel"}),e.jsx(m,{onClick:()=>{t.payment&&t.newStatus&&F.patch(r("club.payments.updateStatus",t.payment.id),{status:t.newStatus},{onSuccess:()=>{u({open:!1,payment:null,newStatus:null})}})},children:"Confirm"})]})]})})]})}export{Ge as default};
