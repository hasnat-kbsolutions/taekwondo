import{r,W as be,j as e,Y as Ne,b as A,y as o}from"./app-C2xXveN-.js";import{A as we,B as Se,t as y,D as De,a as Ce,b as Me,c as h}from"./authenticated-layout-BjG0-HbX.js";import{B as c}from"./button-CpLBrkPM.js";import{B as Ae}from"./badge-CZbiwBxD.js";import{S as I,a as L,b as O,c as P,e as u}from"./select-_dWkLhpx.js";import{D as Z,a as ee,b as ae,c as se,d as te,e as $}from"./dialog-ByGTnqFk.js";import{D as _e}from"./DataTable-B7X2CYu4.js";import{C as v,a as b,b as N,c as w}from"./card-DbE4vXCG.js";import{L as S}from"./label-s6w04Ko4.js";import{s as n}from"./index-sFwGSaal.js";import{W as le}from"./wallet-Dmq8hF7A.js";import{H as ke}from"./hourglass-CKRI_dl9.js";import{F as ne,U as ie}from"./upload-BmeuxSmb.js";import{D as re}from"./download-DON6AUJI.js";import{T as ce}from"./trash-2-DlbeyM8X.js";import{C as de}from"./circle-x-BvuBq8B3.js";import{E as Re}from"./ellipsis-ObQ0B4yH.js";import{S as Ue}from"./square-pen-C1mtrOLi.js";import{C as Ye}from"./circle-check-big-By7rEXeJ.js";import{F as Fe}from"./file-text-9SG7JnD9.js";import"./input-uKThI7IY.js";import"./separator-Be3qWvhY.js";import"./index-BCtSHVQ3.js";import"./sun-wqgmDwy9.js";import"./users-BBtCh4Aq.js";import"./log-out-BUfAgkVI.js";import"./index-C9JcK9ps.js";import"./index-D9Tde0Le.js";import"./chevron-down-cEcyA7ib.js";import"./table-DT4u8R7z.js";const _=(D,i="MYR")=>{const C=Number(D)||0;return i==="JPY"?C.toLocaleString():C.toFixed(2)},Te=new Date().getFullYear(),Ee=["All",...Array.from({length:5},(D,i)=>(Te-i).toString())],Ie=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function pa({payments:D,filters:i,totalPayments:C,paidPayments:me,unpaidPayments:oe,amountsByCurrency:x,defaultCurrencyCode:j}){var q,X,G,Q;const[k,H]=r.useState(i.status||""),[s,R]=r.useState(null),[he,f]=r.useState(!1),[J,M]=r.useState(null),[p,U]=r.useState(null),{data:V,setData:xe,processing:W,errors:z,reset:Y}=be({attachment:null}),[F,K]=r.useState(i.payment_month?i.payment_month.length===4?i.payment_month:i.payment_month.split("-")[0]:"All"),[T,E]=r.useState(((q=i.payment_month)==null?void 0:q.split("-")[1])||""),B=a=>{var d;const t=(d=a.target.files)==null?void 0:d[0];if(U(t||null),t){if(t.type.startsWith("image/")){const m=new FileReader;m.onloadend=()=>{M(m.result)},m.readAsDataURL(t)}else M(null);xe("attachment",t)}},pe=()=>{var t;if(!V.attachment||!s){y.error("Please select a file to upload");return}const a=new FormData;a.append("attachment",V.attachment),(t=s.attachment)!=null&&t.id&&a.append("replace_attachment_id",s.attachment.id.toString()),o.post(n("club.payments.upload-attachment",{payment:s.id}),a,{onSuccess:()=>{y.success(s.attachment?"Attachment updated successfully":"Attachment uploaded successfully"),f(!1),M(null),U(null),Y(),o.reload({only:["payments"]})},onError:()=>{y.error("Failed to upload attachment")}})},ue=()=>{s!=null&&s.attachment&&confirm("Are you sure you want to delete this attachment?")&&o.delete(n("club.payments.delete-attachment",{attachment:s.attachment.id}),{onSuccess:()=>{y.success("Attachment deleted successfully"),f(!1),R(null),o.reload({only:["payments"]})},onError:()=>{y.error("Failed to delete attachment")}})},je=({year:a,month:t,status:d})=>{const m=a==="All"?"":t?`${a}-${t}`:a;o.get(n("club.payments.index"),{status:d||null,payment_month:m||null},{preserveScroll:!0,preserveState:!0,replace:!0})},[fe,ge]=r.useState(!0),[l,g]=r.useState({open:!1,payment:null,newStatus:null});r.useEffect(()=>{if(fe){ge(!1);return}je({year:F,month:T,status:k})},[F,T,k]);const ye=()=>{H(""),K("All"),E(""),o.get(n("club.payments.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})},ve=[{header:"#",cell:({row:a})=>a.index+1},{header:"Student",cell:({row:a})=>{var t;return((t=a.original.student)==null?void 0:t.name)||"-"}},{header:"Amount",cell:({row:a})=>{var m;const t=((m=a.original.currency)==null?void 0:m.symbol)||"RM",d=a.original.currency_code||"MYR";return`${t} ${_(a.original.amount,d)}`}},{header:"Status",cell:({row:a})=>e.jsx(Ae,{variant:a.original.status==="paid"||a.original.status==="success"?"default":"destructive",children:a.original.status})},{header:"Method",accessorKey:"method"},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",accessorKey:"pay_at"},{header:"Proof",cell:({row:a})=>{const t=a.original;return e.jsx("div",{className:"flex items-center gap-2",children:t.attachment?e.jsx(ne,{className:"w-4 h-4 text-primary"}):e.jsx(de,{className:"w-4 h-4 text-muted-foreground"})})}},{header:"Actions",cell:({row:a})=>e.jsxs(De,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Re,{className:"h-4 w-4"})})}),e.jsxs(Me,{align:"end",children:[e.jsx(h,{asChild:!0,children:e.jsxs(A,{href:n("club.payments.edit",a.original.id),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"})," Edit"]})}),a.original.status==="unpaid"&&e.jsxs(h,{onClick:t=>{t.preventDefault(),g({open:!0,payment:a.original,newStatus:"paid"})},children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"})," Mark as Paid"]}),(a.original.status==="paid"||a.original.status==="success")&&e.jsxs(h,{onClick:t=>{t.preventDefault(),g({open:!0,payment:a.original,newStatus:"unpaid"})},children:[e.jsx(de,{className:"w-4 h-4 mr-2"})," Mark as Unpaid"]}),e.jsx(h,{asChild:!0,children:e.jsxs(A,{href:n("club.payments.destroy",a.original.id),method:"delete",as:"button",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"})," Delete"]})}),e.jsx(h,{asChild:!0,children:e.jsxs(A,{href:n("invoice.show",{payment:a.original.id}),children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Invoice"]})}),e.jsxs(h,{onClick:t=>{t.preventDefault();const d=n("invoice.download",{payment:a.original.id});window.open(d,"_blank")},children:[e.jsx(re,{className:"w-4 h-4 mr-2"})," Download Invoice"]}),e.jsxs(h,{onClick:t=>{t.preventDefault(),R(a.original),f(!0)},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),a.original.attachment?"Manage":"Upload"," ","Proof"]})]})]})}];return e.jsxs(we,{header:"Payments",children:[e.jsx(Ne,{title:"Payments"}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Payments"}),e.jsx(le,{className:"h-6 w-6 text-primary"})]}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:C||0})})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Paid"}),e.jsx(Se,{className:"h-6 w-6 text-green-600"})]}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:me||0})})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Unpaid"}),e.jsx(ke,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:oe||0})})]}),e.jsxs(v,{className:"col-span-1 sm:col-span-2 lg:col-span-4",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(le,{className:"h-6 w-6 text-primary"})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"text-lg font-bold",children:[j==="MYR"?"RM":j," ",_((x==null?void 0:x[j||"MYR"])||0,j||"MYR")]}),x&&Object.keys(x).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(x).filter(([a])=>a!==j).map(([a,t])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a,":"]}),e.jsx("span",{children:_(t,a)})]},a))})]})})]})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsx(N,{children:"Payments"}),e.jsx(A,{href:n("club.payments.create"),children:e.jsx(c,{children:"Add Payment"})})]}),e.jsxs(w,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(S,{className:"text-sm mb-1",children:"Year"}),e.jsxs(I,{value:F,onValueChange:a=>{K(a),a==="All"&&E("")},children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Year"})}),e.jsx(P,{children:Ee.map(a=>e.jsx(u,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(S,{className:"text-sm mb-1",children:"Month"}),e.jsxs(I,{value:T,onValueChange:a=>E(a==="all"?"":a),children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Month"})}),e.jsxs(P,{children:[e.jsx(u,{value:"all",children:"All"}),Ie.map(a=>e.jsx(u,{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(S,{className:"text-sm mb-1",children:"Status"}),e.jsxs(I,{value:k,onValueChange:a=>H(a==="all"?"":a),children:[e.jsx(L,{children:e.jsx(O,{placeholder:"All Statuses"})}),e.jsxs(P,{children:[e.jsx(u,{value:"all",children:"All"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"unpaid",children:"Unpaid"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(c,{variant:"secondary",onClick:ye,children:"Reset Filters"})})]})}),e.jsx(_e,{data:D,columns:ve})]})]}),e.jsx(Z,{open:he,onOpenChange:f,children:e.jsxs(ee,{className:"max-w-2xl",children:[e.jsxs(ae,{children:[e.jsx(se,{children:s!=null&&s.attachment?"Update Payment Proof":"Upload Payment Proof"}),e.jsx(te,{children:"Upload an image or PDF as proof of payment. Max 5MB."})]}),e.jsxs("div",{className:"space-y-4",children:[(s==null?void 0:s.attachment)&&!p&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(ne,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.attachment.original_filename}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.attachment.file_type.toUpperCase()})]})]})}),s.attachment.file_type.match(/^(jpg|jpeg|png|gif|webp)$/i)&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:`/storage/${s.attachment.file_path}`,alt:"Current proof",className:"w-full h-auto max-h-64 object-contain bg-white"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{s!=null&&s.attachment&&window.open(n("club.payments.download-attachment",{attachment:s.attachment.id}),"_blank")},children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(c,{size:"sm",variant:"destructive",className:"flex-1",onClick:ue,children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),J&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-muted/50",children:e.jsx("img",{src:J,alt:"Preview",className:"w-full h-auto max-h-64 object-contain"})})]}),(!(s!=null&&s.attachment)||p)&&e.jsxs("form",{onSubmit:a=>{a.preventDefault(),pe()},children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(S,{htmlFor:"attachment",children:"Select File"}),e.jsx("input",{id:"attachment",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:B,className:"file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-4 file:py-2 file:mr-4 text-sm"}),z.attachment&&e.jsx("p",{className:"text-sm text-red-600",children:z.attachment})]})}),e.jsxs($,{className:"gap-2 mt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>{p?(U(null),M(null),Y()):(f(!1),R(null),Y())},children:p?"Cancel":"Close"}),p&&e.jsx(c,{type:"submit",disabled:W,children:W?"Uploading...":s!=null&&s.attachment?"Replace":"Upload"})]})]}),e.jsx("input",{id:"attachment-hidden",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:B,className:"hidden"}),(s==null?void 0:s.attachment)&&!p&&e.jsx($,{children:e.jsxs(c,{variant:"outline",onClick:()=>{var a;(a=document.getElementById("attachment-hidden"))==null||a.click()},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Replace with New File"]})})]})]})}),e.jsx(Z,{open:l.open,onOpenChange:a=>{a||g({open:!1,payment:null,newStatus:null})},children:e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsx(se,{children:"Confirm Status Change"}),e.jsxs(te,{children:["Are you sure you want to change the payment status from"," ",e.jsx("strong",{children:((X=l.payment)==null?void 0:X.status)==="paid"?"Paid":"Unpaid"})," ","to"," ",e.jsx("strong",{children:l.newStatus==="paid"?"Paid":"Unpaid"}),"?"]})]}),l.payment&&e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Student:"})," ",(G=l.payment.student)==null?void 0:G.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",((Q=l.payment.currency)==null?void 0:Q.symbol)||"",_(l.payment.amount,l.payment.currency_code||"MYR")," ",l.payment.currency_code||"MYR"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Month:"})," ",l.payment.payment_month]})]})}),e.jsxs($,{children:[e.jsx(c,{variant:"outline",onClick:()=>{g({open:!1,payment:null,newStatus:null})},children:"Cancel"}),e.jsx(c,{onClick:()=>{l.payment&&l.newStatus&&o.patch(n("club.payments.updateStatus",l.payment.id),{status:l.newStatus},{onSuccess:()=>{g({open:!1,payment:null,newStatus:null})}})},children:"Confirm"})]})]})})]})]})}export{pa as default};
