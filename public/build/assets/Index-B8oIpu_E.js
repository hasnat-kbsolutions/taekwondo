import{r as f,y as Y,j as e,Y as z,a as O}from"./app-WuIRYNFZ.js";import{A as k,t as D}from"./authenticated-layout-slQwf14M.js";import{C as P,a as V,b as B,c as E}from"./card-pgRQk9vN.js";import{t as x,P as I,a as L,f as g,C as F,b as R,c as $}from"./format-KB-4o-fR.js";import{B as G}from"./button-CACmJT7M.js";import{S as y,a as w,b as S,c as v,d as C,e as b}from"./select-DpurANkx.js";import{T as q,a as J,b as _,c as N,d as K,e as M}from"./table-D1OvJesn.js";import"./input-GzazAHq2.js";import"./index-D8PAsJvH.js";import"./Combination-B9B3pFXv.js";import"./index-CWEkWXxv.js";function Q(d){const s=x(d),c=s.getMonth();return s.setFullYear(s.getFullYear(),c+1,0),s.setHours(23,59,59,999),s}function U(d,s){const c=x(d.start),m=x(d.end);let l=+c>+m;const a=l?+c:+m,r=l?m:c;r.setHours(0,0,0,0);let p=1;const o=[];for(;+r<=a;)o.push(x(r)),r.setDate(r.getDate()+p),r.setHours(0,0,0,0);return l?o.reverse():o}function W(d){const s=x(d);return s.setDate(1),s.setHours(0,0,0,0),s}function ie({studentsWithAttendance:d,companies:s,organizations:c,clubs:m,filters:l}){const[a,r]=f.useState({company_id:l.company_id||"",organization_id:l.organization_id||"",club_id:l.club_id||"",date:l.date||new Date().toISOString().slice(0,7)});f.useEffect(()=>{Y.get(route("attendances.index"),a,{preserveState:!0,replace:!0})},[a]);const p=a.date?new Date(a.date+"-01"):new Date,o=U({start:W(p),end:Q(p)}),[T,A]=f.useState(d),H=async(t,n,u)=>{const i=u?"present":"absent";try{await O.post(route("attendances.toggle"),{student_id:t,date:n,status:i}),A(j=>j.map(h=>({...h,records:h.student.id===t?{...h.records,[n]:i}:h.records}))),D.success(`Attendance marked as ${i}`)}catch{D.error("Failed to update attendance")}};return e.jsxs(k,{header:"Attendances",children:[e.jsx(z,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(P,{children:[e.jsx(V,{children:e.jsx(B,{children:"Attendance List"})}),e.jsxs(E,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(y,{value:a.company_id,onValueChange:t=>r(n=>({...n,company_id:t})),children:[e.jsx(w,{className:"w-full",children:e.jsx(S,{placeholder:"All Companies"})}),e.jsx(v,{children:e.jsx(C,{children:s.map(t=>e.jsx(b,{value:String(t.id),children:t.name},t.id))})})]}),e.jsxs(y,{value:a.organization_id,onValueChange:t=>r(n=>({...n,organization_id:t})),children:[e.jsx(w,{className:"w-full",children:e.jsx(S,{placeholder:"All Organizations"})}),e.jsx(v,{children:e.jsx(C,{children:c.map(t=>e.jsx(b,{value:String(t.id),children:t.name},t.id))})})]}),e.jsxs(y,{value:a.club_id,onValueChange:t=>r(n=>({...n,club_id:t})),children:[e.jsx(w,{className:"w-full",children:e.jsx(S,{placeholder:"All Clubs"})}),e.jsx(v,{children:e.jsx(C,{children:m.map(t=>e.jsx(b,{value:String(t.id),children:t.name},t.id))})})]}),e.jsxs(I,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),a.date?g(new Date(a.date+"-01"),"MMMM yyyy"):e.jsx("span",{children:"Select Month"})]})}),e.jsx(R,{className:"w-auto p-0",children:e.jsx($,{mode:"single",selected:a.date?new Date(a.date+"-01"):void 0,onSelect:t=>{if(t){const n=g(t,"yyyy-MM");r(u=>({...u,date:n}))}},captionLayout:"dropdown",fromYear:2020,toYear:new Date().getFullYear(),classNames:{day:"hidden"}})})]})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[" ",e.jsxs(q,{children:[e.jsx(J,{children:e.jsxs(_,{children:[e.jsx(N,{children:"Student"}),o.map(t=>e.jsx(N,{className:"text-center min-w-[40px]",children:g(t,"dd")},t.toString()))]})}),e.jsx(K,{children:T.map(({student:t,records:n})=>e.jsxs(_,{children:[e.jsx(M,{children:t.name}),o.map(u=>{const i=g(u,"yyyy-MM-dd"),j=n[i];return e.jsx(M,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:j==="present",onChange:h=>H(t.id,i,h.target.checked)})},i)})]},t.id))})]})]})})]})]})})]})}export{ie as default};
