import{r as c,y as O,j as e,Y as z,a as R}from"./app-OMdiln-E.js";import{A as V,t as v}from"./authenticated-layout-DShfHJdr.js";import{C as E,a as H,b as B,c as I}from"./card-CQTpkTAm.js";import{S as h,a as m,b as u,c as x,d as p,e as g}from"./select-DIrerrpG.js";import{T as J,a as L,b as y,c as S,d as q,e as C}from"./table-DnYQ2GqH.js";import{e as G,a as W,s as Y}from"./startOfMonth-alQccdl5.js";import{f}from"./format-7_oTgTIh.js";import"./button-DjqBIVTd.js";import"./input-fIaSY3FD.js";import"./index-a7NDMNNq.js";import"./index-fEr8QWGN.js";function se({studentsWithAttendance:w,branches:N,organizations:_,clubs:A,filters:i}){const[s,d]=c.useState(()=>({branch_id:i.branch_id||"",organization_id:i.organization_id||"",club_id:i.club_id||"",date:i.date||f(new Date,"yyyy-MM")})),T=c.useRef(i);c.useEffect(()=>{const a=setTimeout(()=>{JSON.stringify(s)!==JSON.stringify(T.current)&&O.get(route("admin.attendances.index"),s,{preserveState:!0,replace:!0,only:["studentsWithAttendance"],onFinish:()=>console.log("Request completed")})},500);return()=>clearTimeout(a)},[s]);const j=s.date?new Date(s.date+"-01"):new Date,b=G({start:Y(j),end:W(j)}),[k,D]=c.useState(w),M=async(a,t,o)=>{const n=o?"present":"absent";try{await R.post(route("admin.attendances.toggle"),{student_id:a,date:t,status:n}),D(l=>l.map(r=>({...r,records:r.student.id===a?{...r.records,[t]:n}:r.records}))),v.success(`Attendance marked as ${n}`)}catch{v.error("Failed to update attendance")}};return e.jsxs(V,{header:"Attendances",children:[e.jsx(z,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(E,{children:[e.jsx(H,{children:e.jsx(B,{children:"Attendance List"})}),e.jsxs(I,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(h,{value:s.branch_id,onValueChange:a=>d(t=>({...t,branch_id:a})),children:[e.jsx(m,{className:"w-full",children:e.jsx(u,{placeholder:"All Branches"})}),e.jsx(x,{children:e.jsx(p,{children:N.map(a=>e.jsx(g,{value:String(a.id),children:a.name},a.id))})})]}),e.jsxs(h,{value:s.organization_id,onValueChange:a=>d(t=>({...t,organization_id:a})),children:[e.jsx(m,{className:"w-full",children:e.jsx(u,{placeholder:"All Organizations"})}),e.jsx(x,{children:e.jsx(p,{children:_.map(a=>e.jsx(g,{value:String(a.id),children:a.name},a.id))})})]}),e.jsxs(h,{value:s.club_id,onValueChange:a=>d(t=>({...t,club_id:a})),children:[e.jsx(m,{className:"w-full",children:e.jsx(u,{placeholder:"All Clubs"})}),e.jsx(x,{children:e.jsx(p,{children:A.map(a=>e.jsx(g,{value:String(a.id),children:a.name},a.id))})})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx("input",{id:"month-picker",type:"month",value:s.date,onChange:a=>{d(t=>({...t,date:a.target.value}))},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[" ",e.jsxs(J,{children:[e.jsx(L,{children:e.jsxs(y,{children:[e.jsx(S,{children:"Student"}),b.map(a=>e.jsx(S,{className:"text-center min-w-[40px]",children:f(a,"dd")},a.toString()))]})}),e.jsx(q,{children:k.map(({student:a,records:t})=>e.jsxs(y,{children:[e.jsx(C,{children:a.name}),b.map(o=>{const n=f(o,"yyyy-MM-dd"),l=t[n];return e.jsx(C,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:l==="present",onChange:r=>M(a.id,n,r.target.checked)})},n)})]},a.id))})]})]})})]})]})})]})}export{se as default};
