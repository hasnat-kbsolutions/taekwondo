import{m as r,W as V,j as e,Y as E,y as k}from"./app-C2xXveN-.js";import{A as J,C as L}from"./authenticated-layout-BjG0-HbX.js";import{B as v,a as $}from"./button-CpLBrkPM.js";import{I as _}from"./input-uKThI7IY.js";import{L as o}from"./label-s6w04Ko4.js";import{C as B,a as T,b as H,c as O}from"./card-DbE4vXCG.js";import{S as j,a as f,b as g,c as S,e as y}from"./select-_dWkLhpx.js";import{C as R}from"./calendar-BdWX8fSi.js";import{P as W,a as q,b as z}from"./popover-EqWAvmPT.js";import{f as C}from"./format-LUeNQFBy.js";import"./separator-Be3qWvhY.js";import"./index-BCtSHVQ3.js";import"./sun-wqgmDwy9.js";import"./users-BBtCh4Aq.js";import"./log-out-BUfAgkVI.js";import"./index-C9JcK9ps.js";import"./index-D9Tde0Le.js";import"./chevron-down-cEcyA7ib.js";const G=["January","February","March","April","May","June","July","August","September","October","November","December"],b=new Date().getFullYear(),K=Array.from({length:10},(h,n)=>b-5+n);function xe({students:h=[],feeTypes:n=[]}){const[m,F]=r.useState(""),[l,D]=r.useState(""),{data:s,setData:i,processing:I,errors:a}=V({student_id:"",fee_type_id:"",month:"",amount:"",discount:"0",fine:"0",due_date:""}),[x,P]=r.useState(s.month?s.month.split("-")[0]:String(b)),[p,M]=r.useState(s.month?s.month.split("-")[1]:""),[c,Y]=r.useState(s.due_date?new Date(s.due_date):void 0);r.useEffect(()=>{m&&i("student_id",m)},[m]),r.useEffect(()=>{if(l){console.log("Syncing fee_type_id to form:",l),i("fee_type_id",l);const t=parseInt(l,10);if(!isNaN(t)){const d=n.find(u=>u.id===t);d!=null&&d.default_amount&&i("amount",d.default_amount.toString())}}},[l]),r.useEffect(()=>{if(x&&p){const t=`${x}-${p.padStart(2,"0")}`;i("month",t)}},[x,p]),r.useEffect(()=>{c&&i("due_date",C(c,"yyyy-MM-dd"))},[c]);const w=t=>{console.log("Fee type selected:",t),D(t)},A=t=>{t.preventDefault(),console.log("Submitting with fee_type_id:",s.fee_type_id,"selectedFeeTypeId:",l);const d=s.fee_type_id||l,u=s.student_id||m;if(!d||d===""){alert("Please select a fee type");return}if(!u||u===""){alert("Please select a student");return}const N={student_id:u,fee_type_id:d,month:s.month,amount:s.amount,discount:s.discount,fine:s.fine,due_date:s.due_date};console.log("Final form data:",N),k.post(route("admin.student-fees.store"),N)};return e.jsxs(J,{header:"Create Student Fee",children:[e.jsx(E,{title:"Create Student Fee"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(B,{children:[e.jsx(T,{children:e.jsx(H,{children:"Create Student Fee"})}),e.jsx(O,{children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(o,{children:["Student"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(j,{value:m,onValueChange:F,children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Select Student"})}),e.jsx(S,{children:h&&h.length>0?h.map(t=>e.jsxs(y,{value:String(t.id),children:[t.name," ",t.surname||""]},t.id)):e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No students available"})})]}),a.student_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.student_id})]}),e.jsxs("div",{children:[e.jsxs(o,{children:["Fee Type"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(j,{value:l,onValueChange:w,disabled:!n||n.length===0,children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Select Fee Type"})}),e.jsx(S,{children:n&&n.length>0?n.map(t=>e.jsx(y,{value:String(t.id),children:t.name},t.id)):e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No fee types available. Please create fee types first."})})]}),a.fee_type_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.fee_type_id}),(!n||n.length===0)&&e.jsxs("p",{className:"text-yellow-600 text-sm mt-1",children:["No fee types found. Please create fee types first from"," ",e.jsx("a",{href:route("admin.fee-types.create"),className:"underline",children:"Fee Types"}),"."]})]}),e.jsxs("div",{children:[e.jsxs(o,{children:["Month (YYYY-MM)"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(j,{value:x,onValueChange:P,children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Year"})}),e.jsx(S,{children:K.map(t=>e.jsx(y,{value:String(t),children:t},t))})]}),e.jsxs(j,{value:p,onValueChange:M,children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Month"})}),e.jsx(S,{children:G.map((t,d)=>e.jsx(y,{value:String(d+1).padStart(2,"0"),children:t},t))})]})]}),a.month&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.month})]}),e.jsxs("div",{children:[e.jsxs(o,{children:["Amount"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(_,{type:"number",step:"0.01",min:"0",value:s.amount,onChange:t=>i("amount",t.target.value),placeholder:"0.00"}),a.amount&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.amount})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Discount"}),e.jsx(_,{type:"number",step:"0.01",min:"0",value:s.discount,onChange:t=>i("discount",t.target.value),placeholder:"0.00"}),a.discount&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.discount})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Fine"}),e.jsx(_,{type:"number",step:"0.01",min:"0",value:s.fine,onChange:t=>i("fine",t.target.value),placeholder:"0.00"}),a.fine&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.fine})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Due Date"}),e.jsxs(W,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:$("w-full justify-start text-left font-normal",!c&&"text-muted-foreground"),children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),c?C(c,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(z,{className:"w-auto p-0",children:e.jsx(R,{mode:"single",selected:c,onSelect:Y,initialFocus:!0})})]}),a.due_date&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.due_date})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(v,{type:"submit",disabled:I,children:"Create Student Fee"}),e.jsx(v,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Cancel"})]})]})})]})})]})}export{xe as default};
