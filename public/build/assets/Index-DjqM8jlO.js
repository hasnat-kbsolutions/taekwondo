import{r as o,y as K,j as e,Y as Q,b as U,a as Z}from"./app-ByP4EyMF.js";import{A as ee,q as j,C as u,y as $,z as se,E as I,F as O,G as W,D as ae,a as te,b as le,c as re,t as Y}from"./authenticated-layout-Qq67eihM.js";import{C as c,c as d,a as ne,b as ce}from"./card-CKPA4ccG.js";import{B as de}from"./button-xRIIPuWW.js";import{L as B}from"./label-DlfdlFhI.js";import{B as ie}from"./badge-Dh2Aq8W_.js";import{S as H,a as F,b as z,c as R,e as V}from"./select-DYOzuw-F.js";import{T as oe,a as xe,b as v,c as _,d as me,e as S}from"./table-9EkxEIEw.js";import{C as x}from"./circle-check-B7xuna73.js";import{C as g}from"./circle-x-D7u-GhdJ.js";import{P as q,i as he,a as pe,b as je}from"./isWeekend-BrMTysCU.js";import{e as ue,a as ge,s as be}from"./startOfMonth-Bwwd0hjf.js";import{f as i}from"./format-LUeNQFBy.js";import"./input-DHU4GFng.js";import"./separator-DivMgUP8.js";import"./index-DmN_BMdc.js";import"./sun-w0LeklHu.js";import"./users-BmXZoUBI.js";import"./log-out-DV0RpnIg.js";import"./index-BMO2_zHf.js";import"./index-UrMmZlMe.js";import"./index-C39nNiIL.js";import"./chevron-down-oDmv8qA3.js";const Ne=[{value:"present",label:"Present",icon:e.jsx(x,{className:"w-4 h-4"}),color:"text-green-600"},{value:"absent",label:"Absent",icon:e.jsx(g,{className:"w-4 h-4"}),color:"text-red-500"},{value:"late",label:"Late",icon:e.jsx(j,{className:"w-4 h-4"}),color:"text-yellow-500"},{value:"excused",label:"Excused",icon:e.jsx(u,{className:"w-4 h-4"}),color:"text-blue-500"}];function Ve({studentsWithAttendance:b,holidays:N={},filters:k}){var L,P;const f=new Date().getFullYear(),C=(new Date().getMonth()+1).toString().padStart(2,"0"),[m,M]=o.useState(((L=k.date)==null?void 0:L.split("-")[0])||f.toString()),[h,E]=o.useState(((P=k.date)==null?void 0:P.split("-")[1])||C);o.useEffect(()=>{const s=setTimeout(()=>{const a=`${m}-${h}`;K.get(route("club.attendances.index"),{date:a},{preserveState:!0,replace:!0,only:["studentsWithAttendance","holidays"]})},300);return()=>clearTimeout(s)},[m,h]);const D=new Date(`${m}-${h}-01`),w=ue({start:be(D),end:ge(D)}),[y,T]=o.useState(b);o.useEffect(()=>{T(b)},[b]);const G=async(s,a,l)=>{try{await Z.post(route("club.attendances.toggle"),{student_id:s,date:a,status:l}),T(t=>t.map(n=>({...n,records:n.student.id===s?{...n.records,[a]:l}:n.records}))),Y.success(`Attendance marked as ${l}`)}catch{Y.error("Failed to update attendance")}},X=()=>{M(f.toString()),E(C)},A=s=>{const a=i(s,"yyyy-MM-dd"),l=N[a],t=he(s),n=pe(s),r=je(s);return{dateStr:a,holiday:l,isWeekendDay:t,isSat:n,isSun:r,isNonWorkingDay:t||!!l}},J=s=>{switch(s){case"present":return e.jsx(x,{className:"w-4 h-4 text-green-600"});case"absent":return e.jsx(g,{className:"w-4 h-4 text-red-500"});case"late":return e.jsx(j,{className:"w-4 h-4 text-yellow-500"});case"excused":return e.jsx(u,{className:"w-4 h-4 text-blue-500"});default:return e.jsx($,{className:"w-4 h-4 text-gray-300"})}},p=(()=>{let s=0,a=0,l=0,t=0;return y.forEach(({records:n})=>{Object.values(n).forEach(r=>{r==="present"?s++:r==="absent"?a++:r==="late"?l++:r==="excused"&&t++})}),{totalPresent:s,totalAbsent:a,totalLate:l,totalExcused:t}})();return e.jsxs(ee,{header:"Attendances",children:[e.jsx(Q,{title:"Attendances"}),e.jsxs("div",{className:"container mx-auto py-5 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(c,{className:"bg-green-50 dark:bg-green-950/20 border-green-200",children:e.jsx(d,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Present"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:p.totalPresent})]}),e.jsx(x,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(c,{className:"bg-red-50 dark:bg-red-950/20 border-red-200",children:e.jsx(d,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Absent"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:p.totalAbsent})]}),e.jsx(g,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(c,{className:"bg-yellow-50 dark:bg-yellow-950/20 border-yellow-200",children:e.jsx(d,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:"Late"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:p.totalLate})]}),e.jsx(j,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(c,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200",children:e.jsx(d,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Excused"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:p.totalExcused})]}),e.jsx(u,{className:"w-8 h-8 text-blue-500"})]})})})]}),e.jsx(c,{children:e.jsxs(d,{className:"pt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded"}),e.jsx("span",{children:"Saturday"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-100 border border-orange-300 rounded"}),e.jsx("span",{children:"Sunday"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-purple-100 border border-purple-300 rounded"}),e.jsx("span",{children:"Holiday"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Present"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Absent"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:"Late"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"Excused"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4 text-gray-300"}),e.jsx("span",{children:"Not Marked"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Click on any cell to change the attendance status."})]})}),e.jsxs(c,{children:[e.jsx(ne,{children:e.jsx(ce,{children:"Attendance List"})}),e.jsxs(d,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(B,{className:"text-sm mb-1",children:"Year"}),e.jsxs(H,{value:m,onValueChange:M,children:[e.jsx(F,{children:e.jsx(z,{placeholder:"Year"})}),e.jsx(R,{children:Array.from({length:5},(s,a)=>(f-a).toString()).map(s=>e.jsx(V,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(B,{className:"text-sm mb-1",children:"Month"}),e.jsxs(H,{value:h,onValueChange:E,children:[e.jsx(F,{children:e.jsx(z,{placeholder:"Month"})}),e.jsx(R,{children:Array.from({length:12},(s,a)=>{const l=(a+1).toString().padStart(2,"0");return e.jsx(V,{value:l,children:new Date(0,a).toLocaleString("default",{month:"long"})},l)})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(de,{variant:"secondary",onClick:X,children:"Reset Filters"})})]})}),Object.keys(N).length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-purple-50 dark:bg-purple-950/20 border border-purple-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-700",children:"Holidays this month:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(N).map(([s,a])=>e.jsxs(ie,{variant:"outline",className:"bg-purple-100 text-purple-700 border-purple-300",children:[i(new Date(s),"MMM d")," - ",a.name]},s))})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsx(se,{children:e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsxs(v,{children:[e.jsx(_,{className:"sticky left-0 bg-background z-10 min-w-[150px]",children:"Student"}),w.map(s=>{const a=A(s);return e.jsx(_,{className:`text-center min-w-[40px] ${a.holiday?"bg-purple-100 dark:bg-purple-900/30":a.isSun?"bg-orange-100 dark:bg-orange-900/30":a.isSat?"bg-yellow-100 dark:bg-yellow-900/30":""}`,children:e.jsxs(I,{children:[e.jsx(O,{asChild:!0,children:e.jsxs("div",{className:"cursor-help",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:i(s,"EEE")}),e.jsx("div",{children:i(s,"dd")}),a.holiday&&e.jsx(q,{className:"w-3 h-3 mx-auto text-purple-600"})]})}),e.jsxs(W,{children:[e.jsx("p",{children:i(s,"EEEE, MMMM d, yyyy")}),a.holiday&&e.jsx("p",{className:"text-purple-400 font-medium",children:a.holiday.name}),a.isWeekendDay&&!a.holiday&&e.jsx("p",{className:"text-yellow-400",children:"Weekend"})]})]})},s.toString())})]})}),e.jsx(me,{children:y.length===0?e.jsx(v,{children:e.jsx(S,{colSpan:w.length+1,className:"text-center py-8 text-muted-foreground",children:"No students found."})}):y.map(({student:s,records:a})=>e.jsxs(v,{children:[e.jsx(S,{className:"sticky left-0 bg-background z-10",children:e.jsxs("div",{children:[e.jsx(U,{href:route("club.student-insights.show",s.id),className:"text-blue-600 hover:text-blue-800 hover:underline font-medium",children:s.name}),s.code&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.code})]})}),w.map(l=>{const t=A(l),n=a[t.dateStr];return e.jsx(S,{className:`text-center p-1 ${t.holiday?"bg-purple-50 dark:bg-purple-900/20":t.isSun?"bg-orange-50 dark:bg-orange-900/20":t.isSat?"bg-yellow-50 dark:bg-yellow-900/20":""}`,children:t.isNonWorkingDay?e.jsxs(I,{children:[e.jsx(O,{asChild:!0,children:e.jsx("span",{className:"text-gray-400 cursor-not-allowed",children:"â€”"})}),e.jsxs(W,{children:[e.jsx("p",{children:i(l,"EEEE, MMMM d")}),t.holiday?e.jsx("p",{className:"text-purple-400",children:t.holiday.name}):e.jsx("p",{className:"text-yellow-400",children:"Weekend - No Class"})]})]}):e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsx("button",{className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:"Click to change status",children:J(n)})}),e.jsx(le,{align:"center",children:Ne.map(r=>e.jsxs(re,{onClick:()=>G(s.id,t.dateStr,r.value),className:`flex items-center gap-2 ${r.color}`,children:[r.icon,e.jsx("span",{children:r.label}),n===r.value&&e.jsx(x,{className:"w-3 h-3 ml-auto"})]},r.value))})]})},t.dateStr)})]},s.id))})]})})})})]})]})]})]})}export{Ve as default};
