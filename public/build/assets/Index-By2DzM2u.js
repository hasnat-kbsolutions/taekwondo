import{r as c,y as B,j as e,Y as E,b as H,a as O}from"./app-BCeOW9N9.js";import{A as R,t as b}from"./authenticated-layout-BDVPFE6k.js";import{C as V,a as _,b as I,c as W}from"./card-VXQ6T6DP.js";import{B as q}from"./button-BJ6mlj7e.js";import{L as S}from"./label-BgqE86Fs.js";import{S as v,a as w,b as y,c as N,e as C}from"./select-CNHaQc9V.js";import{T as z,a as G,b as T,c as A,d as J,e as M}from"./table-BvvKhhch.js";import{e as K,a as P,s as Q}from"./startOfMonth-Bwwd0hjf.js";import{f as D}from"./format-LUeNQFBy.js";import"./input-BpihmCmf.js";import"./separator-BVeLWKCp.js";import"./index-C1m5ObQF.js";import"./sun-HQaehw-B.js";import"./users-BZ-atLCR.js";import"./log-out-g_pGI50i.js";import"./index-Dd0VXab7.js";import"./index-De3ioJU_.js";import"./chevron-down-mX2uQkHH.js";function ge({studentsWithAttendance:Y,clubs:U,filters:m}){var f,g;const i=new Date().getFullYear(),h=(new Date().getMonth()+1).toString().padStart(2,"0"),[l,x]=c.useState(((f=m.date)==null?void 0:f.split("-")[0])||i.toString()),[o,u]=c.useState(((g=m.date)==null?void 0:g.split("-")[1])||h),[X,Z]=c.useState(()=>({}));c.useEffect(()=>{const t=setTimeout(()=>{const a={date:`${l}-${o}`};B.get(route("club.attendances.index"),a,{preserveState:!0,replace:!0,only:["studentsWithAttendance"]})},300);return()=>clearTimeout(t)},[l,o]);const p=new Date(`${l}-${o}-01`),j=K({start:Q(p),end:P(p)}),[k,L]=c.useState(Y),$=async(t,s,a)=>{const r=a?"present":"absent";try{await O.post(route("club.attendances.toggle"),{student_id:t,date:s,status:r}),L(d=>d.map(n=>({...n,records:n.student.id===t?{...n.records,[s]:r}:n.records}))),b.success(`Attendance marked as ${r}`)}catch{b.error("Failed to update attendance")}},F=()=>{x(i.toString()),u(h)};return e.jsxs(R,{header:"Attendances",children:[e.jsx(E,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-5",children:e.jsxs(V,{children:[e.jsx(_,{children:e.jsx(I,{children:"Attendance List"})}),e.jsxs(W,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(S,{className:"text-sm mb-1",children:"Year"}),e.jsxs(v,{value:l,onValueChange:x,children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Year"})}),e.jsx(N,{children:Array.from({length:5},(t,s)=>(i-s).toString()).map(t=>e.jsx(C,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(S,{className:"text-sm mb-1",children:"Month"}),e.jsxs(v,{value:o,onValueChange:u,children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Month"})}),e.jsx(N,{children:Array.from({length:12},(t,s)=>{const a=(s+1).toString().padStart(2,"0");return e.jsx(C,{value:a,children:new Date(0,s).toLocaleString("default",{month:"long"})},a)})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(q,{variant:"secondary",onClick:F,children:"Reset Filters"})})]})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs(z,{children:[e.jsx(G,{children:e.jsxs(T,{children:[e.jsx(A,{children:"Student"}),j.map(t=>e.jsx(A,{className:"text-center min-w-[40px]",children:D(t,"dd")},t.toString()))]})}),e.jsx(J,{children:k.map(({student:t,records:s})=>e.jsxs(T,{children:[e.jsx(M,{children:e.jsx(H,{href:route("club.student-insights.show",t.id),className:"text-blue-600 hover:text-blue-800 hover:underline font-medium",children:t.name})}),j.map(a=>{const r=D(a,"yyyy-MM-dd"),d=s[r];return e.jsx(M,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:d==="present",onChange:n=>$(t.id,r,n.target.checked)})},r)})]},t.id))})]})})})]})]})})]})}export{ge as default};
