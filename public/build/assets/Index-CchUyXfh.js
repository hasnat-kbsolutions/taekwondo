import{r,W as Ge,j as e,Y as Qe,b as R,y as x}from"./app-BCeOW9N9.js";import{A as Ze,W as Ae,B as es,t as C,D as ss,a as ts,b as as,c as m}from"./authenticated-layout-BDVPFE6k.js";import{B as i}from"./button-BJ6mlj7e.js";import{B as ls}from"./badge-CU-JtyUY.js";import{S as A,a as D,b as M,c as _,e as d}from"./select-CNHaQc9V.js";import{D as z,a as B,b as K,c as q,d as X,e as F}from"./dialog-8Rhv4OVu.js";import{D as ns}from"./DataTable-Cvsj2WMj.js";import{C as g,a as y,b as N,c as v}from"./card-VXQ6T6DP.js";import{L as u}from"./label-BgqE86Fs.js";import{H as De}from"./hourglass-BAgdQZYf.js";import{C as Me}from"./circle-x-CIoSsCDA.js";import{F as _e}from"./file-check-CEceA7T0.js";import{D as ke}from"./download-BLy-DCAD.js";import{T as Ue}from"./trash-2-hW1F2hEJ.js";import{U as Re}from"./upload-CjRQRoeR.js";import{E as cs}from"./ellipsis-D-9Nm7cQ.js";import{E as rs}from"./eye-C2idcpaU.js";import{S as is}from"./square-pen-CKVr_1W0.js";import{C as Fe}from"./circle-check-big-VVvf_o74.js";import{F as ds}from"./file-text-DZuld9JH.js";import"./input-BpihmCmf.js";import"./separator-BVeLWKCp.js";import"./index-C1m5ObQF.js";import"./sun-HQaehw-B.js";import"./users-BZ-atLCR.js";import"./log-out-g_pGI50i.js";import"./index-Dd0VXab7.js";import"./index-De3ioJU_.js";import"./chevron-down-mX2uQkHH.js";import"./table-BvvKhhch.js";const os=new Date().getFullYear(),ms=["All",...Array.from({length:5},(G,w)=>(os-w).toString())],hs=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function Hs({payments:G,students:w=[],filters:h,currencies:Ye,totalPayments:Ee=0,successfulPayments:Te=0,pendingPayments:Oe=0,failedPayments:Ie=0,amountsByCurrency:p={},defaultCurrencyCode:b="MYR"}){var re,ie,de,oe,me,he,xe,ue,pe,je,fe,ge,ye,Ne,ve,we,be,Se;const[Y,Q]=r.useState(h.status||""),[E,Z]=r.useState(h.month?h.month.length===4?h.month:h.month.split("-")[0]:"All"),[T,O]=r.useState(((re=h.month)==null?void 0:re.split("-")[1])||""),[I,ee]=r.useState(h.currency_code||""),[L,se]=r.useState(h.student_id||""),k=(s,t)=>{const n=Number(s)||0;return t==="JPY"?n.toLocaleString():n.toFixed(2)},[c,Le]=r.useState(null),[Ve,V]=r.useState(!1),[a,P]=r.useState(null),[Pe,S]=r.useState(!1),[te,U]=r.useState(null),[j,$]=r.useState(null),[l,f]=r.useState({open:!1,payment:null,newStatus:null}),{data:ae,setData:$e,processing:le,errors:ne,reset:H}=Ge({attachment:null}),He=s=>{Le(s),V(!0)},ce=s=>{var n;const t=(n=s.target.files)==null?void 0:n[0];if($(t||null),t){if(t.type.startsWith("image/")){const o=new FileReader;o.onloadend=()=>{U(o.result)},o.readAsDataURL(t)}else U(null);$e("attachment",t)}},Je=()=>{var t;if(!ae.attachment||!a){C.error("Please select a file to upload");return}const s=new FormData;s.append("attachment",ae.attachment),(t=a.attachment)!=null&&t.id&&s.append("replace_attachment_id",a.attachment.id.toString()),x.post(route("admin.payments.upload-attachment",{payment:a.id}),s,{onSuccess:()=>{C.success(a.attachment?"Attachment updated successfully":"Attachment uploaded successfully"),S(!1),U(null),$(null),H(),x.reload({only:["payments"]})},onError:()=>{C.error("Failed to upload attachment")}})},We=()=>{a!=null&&a.attachment&&confirm("Are you sure you want to delete this attachment?")&&x.delete(route("admin.payments.delete-attachment",{attachment:a.attachment.id}),{onSuccess:()=>{C.success("Attachment deleted successfully"),S(!1),P(null),x.reload({only:["payments"]})},onError:()=>{C.error("Failed to delete attachment")}})},ze=({year:s,month:t,status:n,currency:o,student:J})=>{const W=s==="All"?"":t?`${s}-${t}`:s;x.get(route("admin.payments.index"),{status:n||null,month:W||null,currency_code:o||null,student_id:J||null},{preserveScroll:!0,preserveState:!0,replace:!0})},[Be,Ke]=r.useState(!0);r.useEffect(()=>{if(Be){Ke(!1);return}ze({year:E,month:T,status:Y,currency:I,student:L})},[E,T,Y,I,L]);const qe=()=>{Q(""),Z("All"),O(""),ee(""),se(""),x.get(route("admin.payments.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})},Xe=[{header:"#",cell:({row:s})=>s.index+1},{header:"Student",cell:({row:s})=>{var n;const t=(n=s.original.student_fee)==null?void 0:n.student;return t?`${t.name} ${t.surname||""}`.trim():"-"}},{header:"Fee Type",cell:({row:s})=>{var t,n;return((n=(t=s.original.student_fee)==null?void 0:t.fee_type)==null?void 0:n.name)||"-"}},{header:"Month",cell:({row:s})=>{var t;return((t=s.original.student_fee)==null?void 0:t.month)||"-"}},{header:"Amount",cell:({row:s})=>{var Ce;const t=s.original,n=t.amount,o=t.currency_code,J=((Ce=t.currency)==null?void 0:Ce.symbol)||o,W=k(n,o);return e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[o==="MYR"?"RM ":J,W]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:o})]})}},{header:"Status",cell:({row:s})=>{const t=s.original.status,n=t==="successful"?"default":t==="pending"?"secondary":"destructive";return e.jsx(ls,{variant:n,children:t.charAt(0).toUpperCase()+t.slice(1)})}},{header:"Method",accessorKey:"method"},{header:"Pay At",accessorKey:"pay_at"},{header:"Proof",cell:({row:s})=>{const t=s.original;return e.jsx("div",{className:"flex items-center gap-2",children:t.attachment?e.jsx(_e,{className:"w-4 h-4 text-primary"}):e.jsx(Me,{className:"w-4 h-4 text-muted-foreground"})})}},{header:"Actions",cell:({row:s})=>e.jsxs(ss,{children:[e.jsx(ts,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(cs,{className:"h-4 w-4"})})}),e.jsxs(as,{align:"end",children:[e.jsxs(m,{onClick:()=>He(s.original),children:[e.jsx(rs,{className:"w-4 h-4 mr-2"})," View"]}),e.jsx(m,{asChild:!0,children:e.jsxs(R,{href:route("admin.payments.edit",s.original.id),children:[e.jsx(is,{className:"w-4 h-4 mr-2"})," Edit"]})}),s.original.status==="pending"&&e.jsxs(m,{onClick:t=>{t.preventDefault(),f({open:!0,payment:s.original,newStatus:"successful"})},children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Mark as Successful"]}),s.original.status==="successful"&&e.jsxs(m,{onClick:t=>{t.preventDefault(),f({open:!0,payment:s.original,newStatus:"pending"})},children:[e.jsx(De,{className:"w-4 h-4 mr-2"})," Mark as Pending"]}),s.original.status==="failed"&&e.jsxs(m,{onClick:t=>{t.preventDefault(),f({open:!0,payment:s.original,newStatus:"successful"})},children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Mark as Successful"]}),e.jsxs(m,{onClick:t=>{t.preventDefault(),P(s.original),S(!0)},children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s.original.attachment?"Manage":"Upload"," ","Proof"]}),e.jsx(m,{asChild:!0,children:e.jsxs(R,{href:route("admin.payments.destroy",s.original.id),method:"delete",as:"button",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"})," Delete"]})}),e.jsx(m,{asChild:!0,children:e.jsxs(R,{href:route("invoice.show",{payment:s.original.id}),children:[e.jsx(ds,{className:"w-4 h-4 mr-2"})," Invoice"]})}),e.jsxs(m,{onClick:t=>{t.preventDefault();const n=route("invoice.download",{payment:s.original.id});window.open(n,"_blank")},children:[e.jsx(ke,{className:"w-4 h-4 mr-2"})," Download Invoice"]})]})]})}];return e.jsxs(Ze,{header:"Payments",children:[e.jsx(Qe,{title:"Payments"}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(g,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Payments"}),e.jsx(Ae,{className:"h-6 w-6 text-primary"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ee||0})})]}),e.jsxs(g,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Successful"}),e.jsx(es,{className:"h-6 w-6 text-green-600"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Te||0})})]}),e.jsxs(g,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Pending"}),e.jsx(De,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:Oe||0})})]}),e.jsxs(g,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Failed"}),e.jsx(Me,{className:"h-6 w-6 text-red-500"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-red-500",children:Ie||0})})]}),e.jsxs(g,{className:"col-span-1 sm:col-span-2 lg:col-span-4",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(Ae,{className:"h-6 w-6 text-primary"})]}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"text-lg font-bold",children:[b==="MYR"?"RM":b||""," ",k((p==null?void 0:p[b||"MYR"])||0,b||"MYR")]}),p&&Object.keys(p).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(p).filter(([s])=>s!==b).map(([s,t])=>e.jsxs("div",{children:[s==="MYR"?"RM":s," ",k(t,s)]},s))})]})})]})]}),e.jsxs(g,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between",children:[e.jsx(N,{children:"Payments"}),e.jsx(R,{href:route("admin.payments.create"),children:e.jsx(i,{children:"Add Payment"})})]}),e.jsxs(v,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Year"}),e.jsxs(A,{value:E,onValueChange:s=>{Z(s),s==="All"&&O("")},children:[e.jsx(D,{children:e.jsx(M,{placeholder:"Year"})}),e.jsx(_,{children:ms.map(s=>e.jsx(d,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Month"}),e.jsxs(A,{value:T,onValueChange:s=>O(s==="all"?"":s),children:[e.jsx(D,{children:e.jsx(M,{placeholder:"Month"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"All"}),hs.map(s=>e.jsx(d,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Status"}),e.jsxs(A,{value:Y,onValueChange:s=>Q(s==="all"?"":s),children:[e.jsx(D,{children:e.jsx(M,{placeholder:"All Statuses"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"All"}),e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"successful",children:"Successful"}),e.jsx(d,{value:"failed",children:"Failed"})]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Currency"}),e.jsxs(A,{value:I,onValueChange:s=>ee(s==="all"?"":s),children:[e.jsx(D,{children:e.jsx(M,{placeholder:"All Currencies"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"All"}),Ye.map(s=>e.jsxs(d,{value:s.code,children:[s.code," -"," ",s.symbol]},s.code))]})]})]}),w&&w.length>0&&e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Student"}),e.jsxs(A,{value:L,onValueChange:s=>se(s==="all"?"":s),children:[e.jsx(D,{children:e.jsx(M,{placeholder:"All Students"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"All"}),w.map(s=>e.jsxs(d,{value:String(s.id),children:[s.name," ",s.surname||""]},s.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(i,{variant:"secondary",onClick:qe,children:"Reset Filters"})})]})}),e.jsx(ns,{data:G,columns:Xe})]})]}),e.jsx(z,{open:Ve,onOpenChange:V,children:e.jsxs(B,{className:"w-full",children:[e.jsxs(K,{children:[e.jsx(q,{className:"text-3xl text-foreground",children:"Edit Payment"}),e.jsx(X,{className:"text-muted-foreground",children:"Update payment details like amount and status."})]}),c&&e.jsxs("div",{className:"space-y-2 text-sm ",children:[e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Student:"})," ",(de=(ie=c.student_fee)==null?void 0:ie.student)==null?void 0:de.name," ",((me=(oe=c.student_fee)==null?void 0:oe.student)==null?void 0:me.surname)||""]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Fee Type:"})," ",(xe=(he=c.student_fee)==null?void 0:he.fee_type)==null?void 0:xe.name]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Amount:"})," ",((ue=c.currency)==null?void 0:ue.symbol)||"RM"," ",c.amount," (",c.currency_code,")"]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Status:"})," ",((pe=c.status)==null?void 0:pe.charAt(0).toUpperCase())+((je=c.status)==null?void 0:je.slice(1))]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Method:"})," ",c.method]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Month:"})," ",(fe=c.student_fee)==null?void 0:fe.month]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Pay At:"})," ",c.pay_at]}),c.notes&&e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Notes:"})," ",c.notes]})]}),e.jsx(F,{children:e.jsx(i,{onClick:()=>V(!1),children:"Close"})})]})}),e.jsx(z,{open:Pe,onOpenChange:S,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsxs(K,{children:[e.jsx(q,{children:a!=null&&a.attachment?"Update Payment Proof":"Upload Payment Proof"}),e.jsx(X,{children:"Upload an image or PDF as proof of payment. Max 5MB."})]}),e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.attachment)&&!j&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(_e,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.attachment.original_filename}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.attachment.file_type.toUpperCase()})]})]})}),a.attachment.file_type.match(/^(jpg|jpeg|png|gif|webp)$/i)&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:`/storage/${a.attachment.file_path}`,alt:"Current proof",className:"w-full h-auto max-h-64 object-contain bg-white"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{a!=null&&a.attachment&&window.open(route("admin.payments.download-attachment",{attachment:a.attachment.id}),"_blank")},children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(i,{size:"sm",variant:"destructive",className:"flex-1",onClick:We,children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),te&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-muted/50",children:e.jsx("img",{src:te,alt:"Preview",className:"w-full h-auto max-h-64 object-contain"})})]}),(!(a!=null&&a.attachment)||j)&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),Je()},children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"attachment",children:"Select File"}),e.jsx("input",{id:"attachment",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:ce,className:"file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-4 file:py-2 file:mr-4 text-sm"}),ne.attachment&&e.jsx("p",{className:"text-sm text-red-600",children:ne.attachment})]})}),e.jsxs(F,{className:"gap-2 mt-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>{j?($(null),U(null),H()):(S(!1),P(null),H())},children:j?"Cancel":"Close"}),j&&e.jsx(i,{type:"submit",disabled:le,children:le?"Uploading...":a!=null&&a.attachment?"Replace":"Upload"})]})]}),e.jsx("input",{id:"attachment-hidden",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:ce,className:"hidden"}),(a==null?void 0:a.attachment)&&!j&&e.jsx(F,{children:e.jsxs(i,{variant:"outline",onClick:()=>{var s;(s=document.getElementById("attachment-hidden"))==null||s.click()},children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Replace with New File"]})})]})]})}),e.jsx(z,{open:l.open,onOpenChange:s=>{s||f({open:!1,payment:null,newStatus:null})},children:e.jsxs(B,{children:[e.jsxs(K,{children:[e.jsx(q,{children:"Confirm Status Change"}),e.jsxs(X,{children:["Are you sure you want to change the payment status from"," ",e.jsx("strong",{children:(ge=l.payment)!=null&&ge.status?l.payment.status.charAt(0).toUpperCase()+l.payment.status.slice(1):"Unknown"})," ","to"," ",e.jsx("strong",{children:l.newStatus?l.newStatus.charAt(0).toUpperCase()+l.newStatus.slice(1):"Unknown"}),"?"]})]}),l.payment&&e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Student:"})," ",(Ne=(ye=l.payment.student_fee)==null?void 0:ye.student)==null?void 0:Ne.name," ",((we=(ve=l.payment.student_fee)==null?void 0:ve.student)==null?void 0:we.surname)||""]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",((be=l.payment.currency)==null?void 0:be.symbol)||"",k(l.payment.amount,l.payment.currency_code)," ",l.payment.currency_code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Month:"})," ",(Se=l.payment.student_fee)==null?void 0:Se.month]})]})}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>{f({open:!1,payment:null,newStatus:null})},children:"Cancel"}),e.jsx(i,{onClick:()=>{l.payment&&l.newStatus&&x.patch(route("admin.payments.updateStatus",l.payment.id),{status:l.newStatus},{onSuccess:()=>{f({open:!1,payment:null,newStatus:null})}})},children:"Confirm"})]})]})})]})]})}export{Hs as default};
