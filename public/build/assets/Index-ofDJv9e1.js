import{r as n,W as oe,j as e,Y as he,b as h,y as x}from"./app-CHxsABbU.js";import{A as xe,B as ue,t as v,D as pe,a as je,b as fe,c as d}from"./authenticated-layout-BpjSoaF9.js";import{B as c}from"./button-CVVcaTnG.js";import{B as ge}from"./badge-C1Xnlai7.js";import{S as Y,a as F,b as T,c as E,e as u}from"./select-D09diZvD.js";import{D as be,a as Ne,b as ve,c as ye,d as we,e as K}from"./dialog-BC-xRP0f.js";import{D as Se}from"./DataTable-CkQCuIhe.js";import{C as p,a as j,b as f,c as g}from"./card-C5nEaoSG.js";import{L as y}from"./label-CCOtPfjK.js";import{W as B}from"./wallet-DeYrR61G.js";import{H as De}from"./hourglass-Denvbkgt.js";import{C as I}from"./circle-x-DmxhxWQP.js";import{F as q,U as X}from"./upload-I3tyDqmG.js";import{D as G}from"./download-ZeCRAdEh.js";import{T as Q}from"./trash-2-D8bTICyX.js";import{E as Ce}from"./ellipsis-ChGKUR5a.js";import{S as Me}from"./square-pen-aE7EwmXR.js";import{C as Ae}from"./circle-check-big-BK1yyWlj.js";import{F as _e}from"./file-text-BcaPfFrM.js";import"./input-CbcG-BTm.js";import"./separator-DNOPl6qu.js";import"./index-CN-1e5st.js";import"./createLucideIcon-BOF96pXa.js";import"./building-2-Ik-crbZS.js";import"./users-BD-bUwfe.js";import"./log-out-DhNmSrES.js";import"./calendar-BaxiiAEL.js";import"./sun-BGtUC1J2.js";import"./index-Dh0DyDEf.js";import"./index-B5rDxbdp.js";import"./chevron-down-DVqaVJfg.js";import"./table-DlA2-qFm.js";const L=(w,l="MYR")=>{const S=Number(w)||0;return l==="JPY"?S.toLocaleString():S.toFixed(2)},ke=new Date().getFullYear(),Re=["All",...Array.from({length:5},(w,l)=>(ke-l).toString())],Ue=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function oa({payments:w,filters:l,totalPayments:S,paidPayments:Z,pendingPayments:ee,unpaidPayments:ae,amountsByCurrency:m,defaultCurrencyCode:b}){var z;const[C,O]=n.useState(l.status||""),[s,M]=n.useState(null),[se,N]=n.useState(!1),[$,D]=n.useState(null),[o,A]=n.useState(null),{data:H,setData:te,processing:J,errors:P,reset:_}=oe({attachment:null}),[k,V]=n.useState(l.payment_month?l.payment_month.length===4?l.payment_month:l.payment_month.split("-")[0]:"All"),[R,U]=n.useState(((z=l.payment_month)==null?void 0:z.split("-")[1])||""),W=a=>{var i;const t=(i=a.target.files)==null?void 0:i[0];if(A(t||null),t){if(t.type.startsWith("image/")){const r=new FileReader;r.onloadend=()=>{D(r.result)},r.readAsDataURL(t)}else D(null);te("attachment",t)}},le=()=>{var t;if(!H.attachment||!s){v.error("Please select a file to upload");return}const a=new FormData;a.append("attachment",H.attachment),(t=s.attachment)!=null&&t.id&&a.append("replace_attachment_id",s.attachment.id.toString()),x.post(route("club.payments.upload-attachment",{payment:s.id}),a,{onSuccess:()=>{v.success(s.attachment?"Attachment updated successfully":"Attachment uploaded successfully"),N(!1),D(null),A(null),_(),x.reload({only:["payments"]})},onError:()=>{v.error("Failed to upload attachment")}})},ne=()=>{s!=null&&s.attachment&&confirm("Are you sure you want to delete this attachment?")&&x.delete(route("club.payments.delete-attachment",{attachment:s.attachment.id}),{onSuccess:()=>{v.success("Attachment deleted successfully"),N(!1),M(null),x.reload({only:["payments"]})},onError:()=>{v.error("Failed to delete attachment")}})},ie=({year:a,month:t,status:i})=>{const r=a==="All"?"":t?`${a}-${t}`:a;x.get(route("club.payments.index"),{status:i||null,payment_month:r||null},{preserveScroll:!0,preserveState:!0,replace:!0})},[re,ce]=n.useState(!0);n.useEffect(()=>{if(re){ce(!1);return}ie({year:k,month:R,status:C})},[k,R,C]);const de=()=>{O(""),V("All"),U(""),x.get(route("club.payments.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})},me=[{header:"#",cell:({row:a})=>a.index+1},{header:"Student",cell:({row:a})=>{var t;return((t=a.original.student)==null?void 0:t.name)||"-"}},{header:"Amount",cell:({row:a})=>{var r;const t=((r=a.original.currency)==null?void 0:r.symbol)||"RM",i=a.original.currency_code||"MYR";return`${t} ${L(a.original.amount,i)}`}},{header:"Status",cell:({row:a})=>e.jsx(ge,{variant:a.original.status==="paid"||a.original.status==="success"?"default":"destructive",children:a.original.status})},{header:"Method",accessorKey:"method"},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",accessorKey:"pay_at"},{header:"Proof",cell:({row:a})=>{const t=a.original;return e.jsx("div",{className:"flex items-center gap-2",children:t.attachment?e.jsx(q,{className:"w-4 h-4 text-primary"}):e.jsx(I,{className:"w-4 h-4 text-muted-foreground"})})}},{header:"Actions",cell:({row:a})=>e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ce,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",children:[e.jsx(d,{asChild:!0,children:e.jsxs(h,{href:route("club.payments.edit",a.original.id),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"})," Edit"]})}),a.original.status==="unpaid"&&e.jsx(d,{asChild:!0,children:e.jsxs(h,{href:route("club.payments.updateStatus",a.original.id),method:"patch",data:{status:"paid"},as:"button",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"})," ","Mark as Paid"]})}),(a.original.status==="paid"||a.original.status==="success")&&e.jsx(d,{asChild:!0,children:e.jsxs(h,{href:route("club.payments.updateStatus",a.original.id),method:"patch",data:{status:"unpaid"},as:"button",children:[e.jsx(I,{className:"w-4 h-4 mr-2"})," Mark as Unpaid"]})}),e.jsx(d,{asChild:!0,children:e.jsxs(h,{href:route("club.payments.destroy",a.original.id),method:"delete",as:"button",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Delete"]})}),e.jsx(d,{asChild:!0,children:e.jsxs(h,{href:route("invoice.show",{payment:a.original.id}),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"})," Invoice"]})}),e.jsxs(d,{onClick:t=>{t.preventDefault();const i=route("invoice.download",{payment:a.original.id});window.open(i,"_blank")},children:[e.jsx(G,{className:"w-4 h-4 mr-2"})," Download Invoice"]}),e.jsxs(d,{onClick:t=>{t.preventDefault(),M(a.original),N(!0)},children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),a.original.attachment?"Manage":"Upload"," ","Proof"]})]})]})}];return e.jsxs(xe,{header:"Payments",children:[e.jsx(he,{title:"Payments"}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Payments"}),e.jsx(B,{className:"h-6 w-6 text-primary"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:S||0})})]}),e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Paid"}),e.jsx(ue,{className:"h-6 w-6 text-green-600"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Z||0})})]}),e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Pending"}),e.jsx(De,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:ee||0})})]}),e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Unpaid"}),e.jsx(I,{className:"h-6 w-6 text-red-600"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:ae||0})})]}),e.jsxs(p,{className:"col-span-1 sm:col-span-2 lg:col-span-4",children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(B,{className:"h-6 w-6 text-primary"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"text-lg font-bold",children:[b==="MYR"?"RM":b," ",L((m==null?void 0:m[b||"MYR"])||0,b||"MYR")]}),m&&Object.keys(m).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(m).filter(([a])=>a!==b).map(([a,t])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a,":"]}),e.jsx("span",{children:L(t,a)})]},a))})]})})]})]}),e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(f,{children:"Payments"}),e.jsx(h,{href:route("club.payments.create"),children:e.jsx(c,{children:"Add Payment"})})]}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(y,{className:"text-sm mb-1",children:"Year"}),e.jsxs(Y,{value:k,onValueChange:a=>{V(a),a==="All"&&U("")},children:[e.jsx(F,{children:e.jsx(T,{placeholder:"Year"})}),e.jsx(E,{children:Re.map(a=>e.jsx(u,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(y,{className:"text-sm mb-1",children:"Month"}),e.jsxs(Y,{value:R,onValueChange:a=>U(a==="all"?"":a),children:[e.jsx(F,{children:e.jsx(T,{placeholder:"Month"})}),e.jsxs(E,{children:[e.jsx(u,{value:"all",children:"All"}),Ue.map(a=>e.jsx(u,{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(y,{className:"text-sm mb-1",children:"Status"}),e.jsxs(Y,{value:C,onValueChange:a=>O(a==="all"?"":a),children:[e.jsx(F,{children:e.jsx(T,{placeholder:"All Statuses"})}),e.jsxs(E,{children:[e.jsx(u,{value:"all",children:"All"}),e.jsx(u,{value:"paid",children:"Paid"}),e.jsx(u,{value:"unpaid",children:"Unpaid"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(c,{variant:"secondary",onClick:de,children:"Reset Filters"})})]})}),e.jsx(Se,{data:w,columns:me})]})]}),e.jsx(be,{open:se,onOpenChange:N,children:e.jsxs(Ne,{className:"max-w-2xl",children:[e.jsxs(ve,{children:[e.jsx(ye,{children:s!=null&&s.attachment?"Update Payment Proof":"Upload Payment Proof"}),e.jsx(we,{children:"Upload an image or PDF as proof of payment. Max 5MB."})]}),e.jsxs("div",{className:"space-y-4",children:[(s==null?void 0:s.attachment)&&!o&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(q,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.attachment.original_filename}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.attachment.file_type.toUpperCase()})]})]})}),s.attachment.file_type.match(/^(jpg|jpeg|png|gif|webp)$/i)&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:`/storage/${s.attachment.file_path}`,alt:"Current proof",className:"w-full h-auto max-h-64 object-contain bg-white"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{s!=null&&s.attachment&&window.open(route("club.payments.download-attachment",{attachment:s.attachment.id}),"_blank")},children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(c,{size:"sm",variant:"destructive",className:"flex-1",onClick:ne,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-muted/50",children:e.jsx("img",{src:$,alt:"Preview",className:"w-full h-auto max-h-64 object-contain"})})]}),(!(s!=null&&s.attachment)||o)&&e.jsxs("form",{onSubmit:a=>{a.preventDefault(),le()},children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(y,{htmlFor:"attachment",children:"Select File"}),e.jsx("input",{id:"attachment",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:W,className:"file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-4 file:py-2 file:mr-4 text-sm"}),P.attachment&&e.jsx("p",{className:"text-sm text-red-600",children:P.attachment})]})}),e.jsxs(K,{className:"gap-2 mt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>{o?(A(null),D(null),_()):(N(!1),M(null),_())},children:o?"Cancel":"Close"}),o&&e.jsx(c,{type:"submit",disabled:J,children:J?"Uploading...":s!=null&&s.attachment?"Replace":"Upload"})]})]}),e.jsx("input",{id:"attachment-hidden",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:W,className:"hidden"}),(s==null?void 0:s.attachment)&&!o&&e.jsx(K,{children:e.jsxs(c,{variant:"outline",onClick:()=>{var a;(a=document.getElementById("attachment-hidden"))==null||a.click()},children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Replace with New File"]})})]})]})})]})]})}export{oa as default};
