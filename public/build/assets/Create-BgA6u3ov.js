import{q as V,r as L,m as R,j as e,Y as q,y as z}from"./app-mogbz9dh.js";import{A as H}from"./authenticated-layout-CHtlqjhX.js";import{I as v}from"./input-CYCdtZ2P.js";import{C as D}from"./react-icons.esm-Ch3vQ706.js";import{P as M,a as k,b as A}from"./popover-CUvRl1Ns.js";import{C as I}from"./calendar-DJCFQ-q5.js";import{B as _}from"./button-BQRAfs2B.js";import{S as y,a as g,b as N,c as C,e as l}from"./select-BH9luFBb.js";import{C as F,a as Y,b as $,c as B}from"./card-BrMoc1R4.js";import{L as n}from"./label-Ck-4Q1oU.js";import{C as O}from"./checkbox-GPjpsONT.js";import{f as x}from"./format-LUeNQFBy.js";import"./separator-DWmXc86k.js";import"./index-DYs0IQfs.js";import"./sun-CpD6bzbD.js";import"./users-BQ71ijzB.js";import"./log-out-ULRKpF-A.js";import"./index-DJrisgFK.js";import"./chevron-down-CNFsgjT-.js";import"./index-DKcV70qe.js";function ue(){var b,w;const{students:h=[],studentFeePlans:j=[],currencies:U=[],bank_information:p=[],errors:S={}}=V().props,[a,m]=L.useState({student_id:"",month:"",amount:"",currency_code:"MYR",status:"paid",method:"cash",pay_at:"",due_date:"",notes:"",transaction_id:"",bank_information:[]}),t=R.useMemo(()=>a.student_id?j.find(s=>String(s.student_id)===String(a.student_id)):null,[a.student_id,j]),i=(s,o)=>{var c;if(m(r=>({...r,[s]:o})),s==="student_id"){const r=j.find(u=>String(u.student_id)===String(o));if(r){typeof r.effective_amount<"u"&&m(f=>({...f,amount:String(r.effective_amount)}));const u=r.currency_code||((c=r.plan)==null?void 0:c.currency_code);u&&m(f=>({...f,currency_code:u}))}}},E=(s,o)=>{m(c=>({...c,bank_information:o?[...c.bank_information,s]:c.bank_information.filter(r=>r!==s)}))},T=s=>{s.preventDefault(),z.post(route("organization.payments.store"),a)},d=s=>S[s]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:S[s]});return e.jsxs(H,{header:"Add Payment",children:[e.jsx(q,{title:"Add Payment"}),e.jsx("div",{className:"p-6",children:e.jsxs(F,{children:[e.jsx(Y,{children:e.jsx($,{children:"Add Payment"})}),e.jsx(B,{children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(n,{children:["Student",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(y,{value:a.student_id,onValueChange:s=>i("student_id",s),children:[e.jsx(g,{className:"w-full",children:e.jsx(N,{placeholder:"Select Student"})}),e.jsx(C,{children:Array.isArray(h)&&h.length>0?h.map(s=>e.jsxs(l,{value:String(s.id),children:[s.name," ",s.surname||""]},s.id)):e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No students available"})})]}),d("student_id")]}),e.jsxs("div",{children:[e.jsx(n,{children:"Month (YYYY-MM)"}),e.jsx(v,{type:"month",value:a.month,onChange:s=>i("month",s.target.value)}),d("month")]}),e.jsxs("div",{children:[e.jsxs(n,{children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(y,{value:a.status,onValueChange:s=>i("status",s),children:[e.jsx(g,{className:"w-full",children:e.jsx(N,{placeholder:"Select Status"})}),e.jsxs(C,{children:[e.jsx(l,{value:"paid",children:"Paid"}),e.jsx(l,{value:"unpaid",children:"Unpaid"})]})]}),d("status")]}),e.jsxs("div",{children:[e.jsxs(n,{children:["Method",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(y,{value:a.method,onValueChange:s=>i("method",s),children:[e.jsx(g,{className:"w-full",children:e.jsx(N,{placeholder:"Select Method"})}),e.jsxs(C,{children:[e.jsx(l,{value:"cash",children:"Cash"}),e.jsx(l,{value:"card",children:"Card"}),e.jsx(l,{value:"stripe",children:"Stripe"})]})]}),d("method")]}),e.jsxs("div",{children:[e.jsx(n,{children:"Transaction ID"}),e.jsx(v,{type:"text",value:a.transaction_id,onChange:s=>i("transaction_id",s.target.value),placeholder:"Optional transaction ID"}),d("transaction_id")]}),e.jsxs("div",{children:[e.jsx(n,{children:"Pay At"}),e.jsxs(M,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(_,{variant:"outline",className:"w-full justify-start text-left font-normal "+(!a.pay_at&&"text-muted-foreground"),children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),a.pay_at?x(new Date(a.pay_at),"PPP"):"Pick a date"]})}),e.jsx(A,{className:"w-auto p-0",children:e.jsx(I,{mode:"single",selected:a.pay_at?new Date(a.pay_at):void 0,onSelect:s=>i("pay_at",s?x(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),d("pay_at")]}),e.jsxs("div",{children:[e.jsx(n,{children:"Due Date"}),e.jsxs(M,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(_,{variant:"outline",className:"w-full justify-start text-left font-normal "+(!a.due_date&&"text-muted-foreground"),children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),a.due_date?x(new Date(a.due_date),"PPP"):"Pick a date"]})}),e.jsx(A,{className:"w-auto p-0",children:e.jsx(I,{mode:"single",selected:a.due_date?new Date(a.due_date):void 0,onSelect:s=>i("due_date",s?x(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),d("due_date")]}),e.jsx("div",{className:"col-span-2",children:e.jsxs(F,{children:[e.jsx(Y,{children:e.jsx($,{className:"text-base",children:"Fee Plan Details"})}),e.jsxs(B,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Plan"}),e.jsx("div",{className:"mt-1 text-sm",children:((b=t==null?void 0:t.plan)==null?void 0:b.name)||"Custom"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Currency"}),e.jsx("div",{className:"mt-1 text-sm",children:(t==null?void 0:t.currency_code)||((w=t==null?void 0:t.plan)==null?void 0:w.currency_code)||"-"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Base Amount"}),e.jsx("div",{className:"mt-1 text-sm",children:typeof(t==null?void 0:t.base_amount)<"u"?t==null?void 0:t.base_amount:"-"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Effective Amount"}),e.jsx("div",{className:"mt-1 text-sm",children:typeof(t==null?void 0:t.effective_amount)<"u"?t==null?void 0:t.effective_amount:"-"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Interval"}),e.jsxs("div",{className:"mt-1 text-sm",children:[t==null?void 0:t.interval,(t==null?void 0:t.interval)==="custom"&&(t!=null&&t.interval_count)?` (${t==null?void 0:t.interval_count})`:""]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Discount"}),e.jsx("div",{className:"mt-1 text-sm",children:t!=null&&t.discount_type?`${t==null?void 0:t.discount_type} ${t==null?void 0:t.discount_value}`:"None"})]})]})]})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Notes"}),e.jsx(v,{value:a.notes,onChange:s=>i("notes",s.target.value)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-base font-semibold",children:"Bank Information (Select banks to show on invoice)"}),p&&p.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg",children:[e.jsx(O,{id:`bank-${s.id}`,checked:a.bank_information.includes(s.id),onCheckedChange:o=>E(s.id,o)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{htmlFor:`bank-${s.id}`,className:"text-sm font-medium cursor-pointer",children:s.bank_name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.account_name," -"," ",s.account_number,s.currency&&` (${s.currency})`]})]})]},s.id))}):e.jsxs("div",{className:"p-4 border border-dashed rounded-lg text-center text-muted-foreground",children:[e.jsx("p",{children:"No bank information available."}),e.jsx("p",{className:"text-sm",children:"Please add bank information first."})]}),d("bank_information")]}),e.jsx("div",{className:"pt-4",children:e.jsx(_,{type:"submit",children:"Save"})})]})})]})})]})}export{ue as default};
