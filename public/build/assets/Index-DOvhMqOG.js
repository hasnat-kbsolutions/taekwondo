import{r as i,y as M,j as e,Y as O,a as R}from"./app-BwTXSz7i.js";import{A as E,t as p}from"./authenticated-layout-DXIZPje9.js";import{C as H,a as V,b as z,c as B}from"./card-OxrEwD4R.js";import{S as g,a as j,b,c as y,d as v,e as S}from"./select-B073Gnsp.js";import{T as I,a as J,b as C,c as w,d as L,e as N}from"./table-CnrrvRqx.js";import{f as m}from"./format-7_oTgTIh.js";import{e as q,a as F,s as G}from"./startOfMonth-alQccdl5.js";import"./button-BCDa-7Qv.js";import"./input-BTbbPB6x.js";import"./index-CPCL5TU8.js";import"./index-qGe5pddD.js";function te({studentsWithAttendance:c,branches:T,clubs:A,filters:d}){const[s,o]=i.useState(()=>({branch_id:d.branch_id||"",club_id:d.club_id||"",date:d.date||m(new Date,"yyyy-MM")})),_=i.useRef(d);i.useEffect(()=>{f(c)},[c]),i.useEffect(()=>{const a=setTimeout(()=>{JSON.stringify(s)!==JSON.stringify(_.current)&&M.get(route("organization.attendances.index"),s,{preserveState:!0,replace:!0,only:["studentsWithAttendance"],onFinish:()=>console.log("Request completed")})},500);return()=>clearTimeout(a)},[s]);const u=s.date?new Date(s.date+"-01"):new Date,x=q({start:G(u),end:F(u)}),[k,f]=i.useState(c),D=async(a,t,h)=>{const r=h?"present":"absent";try{await R.post(route("organization.attendances.toggle"),{student_id:a,date:t,status:r}),f(l=>l.map(n=>({...n,records:n.student.id===a?{...n.records,[t]:r}:n.records}))),p.success(`Attendance marked as ${r}`)}catch{p.error("Failed to update attendance")}};return e.jsxs(E,{header:"Attendances",children:[e.jsx(O,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(H,{children:[e.jsx(V,{children:e.jsx(z,{children:"Attendance List"})}),e.jsxs(B,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(g,{value:s.branch_id,onValueChange:a=>o(t=>({...t,branch_id:a})),children:[e.jsx(j,{className:"w-full",children:e.jsx(b,{placeholder:"All Branches"})}),e.jsx(y,{children:e.jsx(v,{children:T.map(a=>e.jsx(S,{value:String(a.id),children:a.name},a.id))})})]}),e.jsxs(g,{value:s.club_id,onValueChange:a=>o(t=>({...t,club_id:a})),children:[e.jsx(j,{className:"w-full",children:e.jsx(b,{placeholder:"All Clubs"})}),e.jsx(y,{children:e.jsx(v,{children:A.map(a=>e.jsx(S,{value:String(a.id),children:a.name},a.id))})})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx("input",{id:"month-picker",type:"month",value:s.date,onChange:a=>{o(t=>({...t,date:a.target.value}))},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[" ",e.jsxs(I,{children:[e.jsx(J,{children:e.jsxs(C,{children:[e.jsx(w,{children:"Student"}),x.map(a=>e.jsx(w,{className:"text-center min-w-[40px]",children:m(a,"dd")},a.toString()))]})}),e.jsx(L,{children:k.map(({student:a,records:t})=>e.jsxs(C,{children:[e.jsx(N,{children:a.name}),x.map(h=>{const r=m(h,"yyyy-MM-dd"),l=t[r];return e.jsx(N,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:l==="present",onChange:n=>D(a.id,r,n.target.checked)})},r)})]},a.id))})]})]})})]})]})})]})}export{te as default};
