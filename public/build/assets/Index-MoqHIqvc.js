import{r as c,y as R,j as e,Y as V,a as _}from"./app-Df8hygk-.js";import{A as I,t as S}from"./authenticated-layout-B4W976zT.js";import{C as b,a as w,b as v,c as y}from"./card-DqVGc9FH.js";import{B as W}from"./button-2SiMpDbH.js";import{L as N}from"./label-a5D2rivt.js";import{S as C,a as T,b as A,c as M,e as D}from"./select-BCtRAn9G.js";import{T as q,a as z,b as k,c as Y,d as G,e as F}from"./table-BHK9RecV.js";import{e as J,a as K,s as P}from"./startOfMonth-alQccdl5.js";import{f as L}from"./format-7_oTgTIh.js";import"./input-XCU48omI.js";import"./separator-CvacvyxJ.js";import"./index-CWyIQQtB.js";import"./sun-DOsMyv6Q.js";import"./users-B4l2OX_S.js";import"./log-out-Bi4kVoog.js";import"./index-C2lhu9cK.js";import"./index-p2-b0plT.js";import"./chevron-down-Bp2fLOHs.js";function fe({studentsWithAttendance:$,clubs:Q,filters:m}){var f,g;const d=new Date().getFullYear(),x=(new Date().getMonth()+1).toString().padStart(2,"0"),[l,h]=c.useState(((f=m.date)==null?void 0:f.split("-")[0])||d.toString()),[o,p]=c.useState(((g=m.date)==null?void 0:g.split("-")[1])||x),[U,X]=c.useState(()=>({}));c.useEffect(()=>{const t=setTimeout(()=>{const a={date:`${l}-${o}`};R.get(route("club.attendances.index"),a,{preserveState:!0,replace:!0,only:["studentsWithAttendance"]})},300);return()=>clearTimeout(t)},[l,o]);const u=new Date(`${l}-${o}-01`),j=J({start:P(u),end:K(u)}),[B,E]=c.useState($),H=async(t,s,a)=>{const r=a?"present":"absent";try{await _.post(route("club.attendances.toggle"),{student_id:t,date:s,status:r}),E(i=>i.map(n=>({...n,records:n.student.id===t?{...n.records,[s]:r}:n.records}))),S.success(`Attendance marked as ${r}`)}catch{S.error("Failed to update attendance")}},O=()=>{h(d.toString()),p(x)};return e.jsxs(I,{header:"Attendances",children:[e.jsx(V,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-5",children:e.jsxs(b,{children:[e.jsx(w,{className:"flex flex-row items-center justify-between",children:e.jsx(v,{children:"Filters"})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(N,{className:"text-sm mb-1",children:"Year"}),e.jsxs(C,{value:l,onValueChange:h,children:[e.jsx(T,{children:e.jsx(A,{placeholder:"Year"})}),e.jsx(M,{children:Array.from({length:5},(t,s)=>(d-s).toString()).map(t=>e.jsx(D,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(N,{className:"text-sm mb-1",children:"Month"}),e.jsxs(C,{value:o,onValueChange:p,children:[e.jsx(T,{children:e.jsx(A,{placeholder:"Month"})}),e.jsx(M,{children:Array.from({length:12},(t,s)=>{const a=(s+1).toString().padStart(2,"0");return e.jsx(D,{value:a,children:new Date(0,s).toLocaleString("default",{month:"long"})},a)})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(W,{className:"bg-primary text-background",onClick:O,children:"Reset Filters"})})]})})]})}),e.jsx("div",{className:"container mx-auto",children:e.jsxs(b,{children:[e.jsx(w,{children:e.jsx(v,{children:"Attendance List"})}),e.jsx(y,{children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs(q,{children:[e.jsx(z,{children:e.jsxs(k,{children:[e.jsx(Y,{children:"Student"}),j.map(t=>e.jsx(Y,{className:"text-center min-w-[40px]",children:L(t,"dd")},t.toString()))]})}),e.jsx(G,{children:B.map(({student:t,records:s})=>e.jsxs(k,{children:[e.jsx(F,{children:t.name}),j.map(a=>{const r=L(a,"yyyy-MM-dd"),i=s[r];return e.jsx(F,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:i==="present",onChange:n=>H(t.id,r,n.target.checked)})},r)})]},t.id))})]})})})})]})})]})}export{fe as default};
