import{r as c,j as e,Y as ae,b as C,y as R}from"./app-DCao4lWu.js";import{B as p}from"./button-DNx5tCFx.js";import{B as K}from"./badge-Cj0SZuSw.js";import{A as te,W,B as le,D as ne,a as re,b as ie,c as d}from"./authenticated-layout-E5uSI4hx.js";import{S as j,a as g,b as f,c as v,e as n}from"./select-BFhnm8bp.js";import{D as ce}from"./DataTable-BWNN9fVZ.js";import{C as y,a as b,b as N,c as S}from"./card-D--GcLXN.js";import{L as w}from"./label-BrGiPhmc.js";import{D as oe,a as de,b as me,c as xe,d as he,e as ue}from"./dialog-dwRmcGnJ.js";import{s as i}from"./index-sFwGSaal.js";import{H as pe}from"./hourglass-JyifwMB9.js";import{F as je}from"./file-check-t9kuerq0.js";import{C as $}from"./circle-x-pwIOVa4z.js";import{E as ge}from"./ellipsis-BDIDq8D9.js";import{S as fe}from"./square-pen-EEi2VRni.js";import{C as ve}from"./circle-check-big-D2qg8VK5.js";import{D as q}from"./download-BFHVBE8G.js";import{T as ye}from"./trash-2-DSpz0iJn.js";import{F as be}from"./file-text-CDQ8DSGI.js";import"./input-CInK40zc.js";import"./separator-Dl1SOj0c.js";import"./index-BJLS17WZ.js";import"./sun-BUaGJE4b.js";import"./users-CTLQlyzj.js";import"./log-out-0YzRyKVg.js";import"./index-D91VqjnW.js";import"./index-76Pho1KZ.js";import"./chevron-down-tk6Ytizj.js";import"./table-CJORJgxg.js";const D=(o,x)=>{const l=Number(o)||0;return x==="JPY"?l.toLocaleString():l.toFixed(2)},Ne=new Date().getFullYear(),Se=["All",...Array.from({length:5},(o,x)=>(Ne-x).toString())],we=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function es({payments:o,students:x,filters:l,amountsByCurrency:A={},defaultCurrencyCode:h="MYR",currencies:X=[]}){var U,B,O,H;const[M,V]=c.useState(l.status||""),[P,E]=c.useState(l.currency_code||""),[_,I]=c.useState(l.student_id||""),[k,L]=c.useState(l.payment_month?l.payment_month.length===4?l.payment_month:l.payment_month.split("-")[0]:"All"),[F,Y]=c.useState(((U=l.payment_month)==null?void 0:U.split("-")[1])||""),G=({year:s,month:a,status:r,currency:m,student_id:T})=>{const z=s==="All"?"":a?`${s}-${a}`:s;R.get(i("organization.payments.index"),{status:r||null,month:z||null,currency_code:m||null,student_id:T||null},{preserveScroll:!0,preserveState:!0,replace:!0})},[Q,Z]=c.useState(!0),[t,u]=c.useState({open:!1,payment:null,newStatus:null});c.useEffect(()=>{if(Q){Z(!1);return}G({year:k,month:F,status:M,currency:P,student_id:_})},[k,F,M,P,_]);const ee=()=>{V(""),L("All"),Y(""),E(""),I(""),R.get(i("organization.payments.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})},se=[{header:"#",cell:({row:s})=>s.index+1},{header:"Student",cell:({row:s})=>{const a=s.original.student,r=s.original.attachment;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.name)||"-"}),r&&e.jsx(K,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-300",children:"ðŸ“¤ Proof"})]})}},{header:"Amount",cell:({row:s})=>{var J;const a=s.original,r=a.amount,m=a.currency_code,T=((J=a.currency)==null?void 0:J.symbol)||m,z=D(r,m);return e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[m==="MYR"?"RM ":T,z]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m})]})}},{header:"Status",cell:({row:s})=>e.jsx(K,{variant:s.original.status==="paid"||s.original.status==="success"?"default":"destructive",children:s.original.status})},{header:"Proof",cell:({row:s})=>{const a=s.original.attachment;return e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-xs text-green-600 font-semibold",children:"âœ“ Uploaded"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:"No proof"})]})})}},{header:"Method",accessorKey:"method"},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",accessorKey:"pay_at"},{header:"Actions",cell:({row:s})=>e.jsxs(ne,{children:[e.jsx(re,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(ie,{align:"end",children:[e.jsx(d,{asChild:!0,children:e.jsxs(C,{href:i("organization.payments.edit",s.original.id),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"})," Edit"]})}),s.original.status==="unpaid"&&e.jsxs(d,{onClick:a=>{a.preventDefault(),u({open:!0,payment:s.original,newStatus:"paid"})},children:[e.jsx(ve,{className:"w-4 h-4 mr-2"})," Mark as Paid"]}),(s.original.status==="paid"||s.original.status==="success")&&e.jsxs(d,{onClick:a=>{a.preventDefault(),u({open:!0,payment:s.original,newStatus:"unpaid"})},children:[e.jsx($,{className:"w-4 h-4 mr-2"})," Mark as Unpaid"]}),s.original.attachment&&e.jsx(e.Fragment,{children:e.jsxs(d,{onClick:a=>{if(a.preventDefault(),s.original.attachment){const r=i("organization.payments.download-attachment",{attachment:s.original.attachment.id});window.open(r,"_blank")}},children:[e.jsx(q,{className:"w-4 h-4 mr-2"})," View Proof"]})}),e.jsx(d,{asChild:!0,children:e.jsxs(C,{href:i("organization.payments.destroy",s.original.id),method:"delete",as:"button",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"})," Delete"]})}),e.jsx(d,{asChild:!0,children:e.jsxs(C,{href:i("invoice.show",{payment:s.original.id}),children:[e.jsx(be,{className:"w-4 h-4 mr-2"})," Invoice"]})}),e.jsxs(d,{onClick:a=>{a.preventDefault();const r=i("invoice.download",{payment:s.original.id});window.open(r,"_blank")},children:[e.jsx(q,{className:"w-4 h-4 mr-2"})," Download Invoice"]})]})]})}];return e.jsxs(te,{header:"Payments",children:[e.jsx(ae,{title:"Payments"}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-muted-foreground",children:"Payment Overview"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6",children:[e.jsxs(y,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20 col-span-1 sm:col-span-2 lg:col-span-3 xl:col-span-4",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Total Revenue"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(W,{className:"h-6 w-6 text-primary"})})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[h==="MYR"?"RM":h," ",D(A[h]||0,h)]}),Object.keys(A).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(A).filter(([s])=>s!==h).map(([s,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s,":"]}),e.jsx("span",{children:D(a,s)})]},s))})]})})})]}),e.jsxs(y,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Total Payments"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(W,{className:"h-6 w-6 text-primary"})})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:o.length})})]}),e.jsxs(y,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Paid"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(le,{className:"h-6 w-6 text-green-600"})})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:o.filter(s=>s.status==="paid").length})})]}),e.jsxs(y,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:bg-accent/50 border-2 hover:border-primary/20",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium group-hover:text-primary transition-colors",children:"Unpaid"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(pe,{className:"h-6 w-6 text-yellow-500"})})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold group-hover:text-primary transition-colors",children:o.filter(s=>s.status==="unpaid").length})})]})]})]}),e.jsxs(y,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsx(N,{children:"Payments"}),e.jsx(C,{href:i("organization.payments.create"),children:e.jsx(p,{children:"Add Payment"})})]}),e.jsxs(S,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(w,{className:"text-sm mb-1",children:"Year"}),e.jsxs(j,{value:k,onValueChange:s=>{L(s),s==="All"&&Y("")},children:[e.jsx(g,{children:e.jsx(f,{placeholder:"Year"})}),e.jsx(v,{children:Se.map(s=>e.jsx(n,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(w,{className:"text-sm mb-1",children:"Month"}),e.jsxs(j,{value:F,onValueChange:s=>Y(s==="all"?"":s),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"Month"})}),e.jsxs(v,{children:[e.jsx(n,{value:"all",children:"All"}),we.map(s=>e.jsx(n,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(w,{className:"text-sm mb-1",children:"Status"}),e.jsxs(j,{value:M,onValueChange:s=>V(s==="all"?"":s),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All Statuses"})}),e.jsxs(v,{children:[e.jsx(n,{value:"all",children:"All"}),e.jsx(n,{value:"paid",children:"Paid"}),e.jsx(n,{value:"unpaid",children:"Unpaid"})]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(w,{className:"text-sm mb-1",children:"Currency"}),e.jsxs(j,{value:P,onValueChange:s=>E(s==="all"?"":s),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All Currencies"})}),e.jsxs(v,{children:[e.jsx(n,{value:"all",children:"All"}),X.map(s=>e.jsxs(n,{value:s.code,children:[s.code," -"," ",s.symbol]},s.code))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(w,{className:"text-sm mb-1",children:"Student"}),e.jsxs(j,{value:_,onValueChange:s=>I(s==="all"?"":s),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All Students"})}),e.jsxs(v,{children:[e.jsx(n,{value:"all",children:"All"}),x.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(p,{variant:"secondary",onClick:ee,children:"Reset Filters"})})]})}),e.jsx(ce,{data:o,columns:se})]})]})]}),e.jsx(oe,{open:t.open,onOpenChange:s=>{s||u({open:!1,payment:null,newStatus:null})},children:e.jsxs(de,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Confirm Status Change"}),e.jsxs(he,{children:["Are you sure you want to change the payment status from"," ",e.jsx("strong",{children:((B=t.payment)==null?void 0:B.status)==="paid"?"Paid":"Unpaid"})," ","to"," ",e.jsx("strong",{children:t.newStatus==="paid"?"Paid":"Unpaid"}),"?"]})]}),t.payment&&e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Student:"})," ",(O=t.payment.student)==null?void 0:O.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",((H=t.payment.currency)==null?void 0:H.symbol)||"",D(t.payment.amount,t.payment.currency_code)," ",t.payment.currency_code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Month:"})," ",t.payment.payment_month]})]})}),e.jsxs(ue,{children:[e.jsx(p,{variant:"outline",onClick:()=>{u({open:!1,payment:null,newStatus:null})},children:"Cancel"}),e.jsx(p,{onClick:()=>{t.payment&&t.newStatus&&R.patch(i("organization.payments.updateStatus",t.payment.id),{status:t.newStatus},{onSuccess:()=>{u({open:!1,payment:null,newStatus:null})}})},children:"Confirm"})]})]})})]})}export{es as default};
