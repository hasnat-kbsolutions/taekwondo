import{r as i,y as w,j as e,Y as T,a as N}from"./app-C7QOoTmK.js";import{A,t as p}from"./authenticated-layout-Byski1ZN.js";import{C as k,a as D,b as M,c as O}from"./card-Bz-PV3i5.js";import{S as R,a as _,b as E,c as H,d as z,e as F}from"./select-DXiczpqR.js";import{T as I,a as J,b as g,c as j,d as L,e as b}from"./table-Dzc01Q7z.js";import{f as m}from"./format-7_oTgTIh.js";import{e as V,a as q,s as B}from"./startOfMonth-alQccdl5.js";import"./button-BwnA5GFK.js";import"./input-Dw712aEx.js";import"./index-Ckf3Y_8P.js";import"./index-C2X7DR8K.js";import"./index-BJakivTH.js";import"./chevron-down-CFpZKIZV.js";function se({studentsWithAttendance:c,clubs:y,filters:o}){const[s,u]=i.useState(()=>({club_id:o.club_id||"",date:o.date||m(new Date,"yyyy-MM")})),v=i.useRef(o);i.useEffect(()=>{f(c)},[c]),i.useEffect(()=>{const t=setTimeout(()=>{JSON.stringify(s)!==JSON.stringify(v.current)&&w.get(route("organization.attendances.index"),s,{preserveState:!0,replace:!0,only:["studentsWithAttendance"],onFinish:()=>console.log("Request completed")})},500);return()=>clearTimeout(t)},[s]);const x=s.date?new Date(s.date+"-01"):new Date,h=V({start:B(x),end:q(x)}),[S,f]=i.useState(c),C=async(t,a,l)=>{const r=l?"present":"absent";try{await N.post(route("organization.attendances.toggle"),{student_id:t,date:a,status:r}),f(d=>d.map(n=>({...n,records:n.student.id===t?{...n.records,[a]:r}:n.records}))),p.success(`Attendance marked as ${r}`)}catch{p.error("Failed to update attendance")}};return e.jsxs(A,{header:"Attendances",children:[e.jsx(T,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(k,{children:[e.jsx(D,{children:e.jsx(M,{children:"Attendance List"})}),e.jsxs(O,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(R,{value:s.club_id,onValueChange:t=>u(a=>({...a,club_id:t})),children:[e.jsx(_,{className:"w-full",children:e.jsx(E,{placeholder:"All Clubs"})}),e.jsx(H,{children:e.jsx(z,{children:y.map(t=>e.jsx(F,{value:String(t.id),children:t.name},t.id))})})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx("input",{id:"month-picker",type:"month",value:s.date,onChange:t=>{u(a=>({...a,date:t.target.value}))},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[" ",e.jsxs(I,{children:[e.jsx(J,{children:e.jsxs(g,{children:[e.jsx(j,{children:"Student"}),h.map(t=>e.jsx(j,{className:"text-center min-w-[40px]",children:m(t,"dd")},t.toString()))]})}),e.jsx(L,{children:S.map(({student:t,records:a})=>e.jsxs(g,{children:[e.jsx(b,{children:t.name}),h.map(l=>{const r=m(l,"yyyy-MM-dd"),d=a[r];return e.jsx(b,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:d==="present",onChange:n=>C(t.id,r,n.target.checked)})},r)})]},t.id))})]})]})})]})]})})]})}export{se as default};
