import{r as p,y as O,j as e,Y as z,a as R}from"./app-DnToiaqm.js";import{A as V,t as D}from"./authenticated-layout-CM4EgtRZ.js";import{C as E,a as Y,b as B,c as F}from"./card-CtexpsmE.js";import{S as j,a as b,b as v,c as y,d as S,e as C}from"./select-B-7tiFVF.js";import{T as I,a as J,b as N,c as T,d as L,e as A}from"./table-BIk9QAuP.js";import{t as m,f as w}from"./format-7_oTgTIh.js";import"./button-B6wWgYUz.js";import"./input-BQhyfOO-.js";import"./index-BiH38-3Q.js";import"./index-45IFiFmS.js";function q(d){const a=m(d),c=a.getMonth();return a.setFullYear(a.getFullYear(),c+1,0),a.setHours(23,59,59,999),a}function G(d,a){const c=m(d.start),h=m(d.end);let i=+c>+h;const n=i?+c:+h,r=i?h:c;r.setHours(0,0,0,0);let g=1;const o=[];for(;+r<=n;)o.push(m(r)),r.setDate(r.getDate()+g),r.setHours(0,0,0,0);return i?o.reverse():o}function W(d){const a=m(d);return a.setDate(1),a.setHours(0,0,0,0),a}function ae({studentsWithAttendance:d,branches:a,organizations:c,clubs:h,filters:i}){const[n,r]=p.useState(()=>({branch_id:i.branch_id||"",organization_id:i.organization_id||"",club_id:i.club_id||"",date:i.date||w(new Date,"yyyy-MM")})),g=p.useRef(i);p.useEffect(()=>{const t=setTimeout(()=>{JSON.stringify(n)!==JSON.stringify(g.current)&&O.get(route("attendances.index"),n,{preserveState:!0,replace:!0,only:["studentsWithAttendance"],onFinish:()=>console.log("Request completed")})},500);return()=>clearTimeout(t)},[n]);const o=n.date?new Date(n.date+"-01"):new Date,_=G({start:W(o),end:q(o)}),[k,H]=p.useState(d),M=async(t,s,f)=>{const l=f?"present":"absent";try{await R.post(route("attendances.toggle"),{student_id:t,date:s,status:l}),H(x=>x.map(u=>({...u,records:u.student.id===t?{...u.records,[s]:l}:u.records}))),D.success(`Attendance marked as ${l}`)}catch{D.error("Failed to update attendance")}};return e.jsxs(V,{header:"Attendances",children:[e.jsx(z,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(E,{children:[e.jsx(Y,{children:e.jsx(B,{children:"Attendance List"})}),e.jsxs(F,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(j,{value:n.branch_id,onValueChange:t=>r(s=>({...s,branch_id:t})),children:[e.jsx(b,{className:"w-full",children:e.jsx(v,{placeholder:"All Branches"})}),e.jsx(y,{children:e.jsx(S,{children:a.map(t=>e.jsx(C,{value:String(t.id),children:t.name},t.id))})})]}),e.jsxs(j,{value:n.organization_id,onValueChange:t=>r(s=>({...s,organization_id:t})),children:[e.jsx(b,{className:"w-full",children:e.jsx(v,{placeholder:"All Organizations"})}),e.jsx(y,{children:e.jsx(S,{children:c.map(t=>e.jsx(C,{value:String(t.id),children:t.name},t.id))})})]}),e.jsxs(j,{value:n.club_id,onValueChange:t=>r(s=>({...s,club_id:t})),children:[e.jsx(b,{className:"w-full",children:e.jsx(v,{placeholder:"All Clubs"})}),e.jsx(y,{children:e.jsx(S,{children:h.map(t=>e.jsx(C,{value:String(t.id),children:t.name},t.id))})})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx("input",{id:"month-picker",type:"month",value:n.date,onChange:t=>{r(s=>({...s,date:t.target.value}))},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[" ",e.jsxs(I,{children:[e.jsx(J,{children:e.jsxs(N,{children:[e.jsx(T,{children:"Student"}),_.map(t=>e.jsx(T,{className:"text-center min-w-[40px]",children:w(t,"dd")},t.toString()))]})}),e.jsx(L,{children:k.map(({student:t,records:s})=>e.jsxs(N,{children:[e.jsx(A,{children:t.name}),_.map(f=>{const l=w(f,"yyyy-MM-dd"),x=s[l];return e.jsx(A,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:x==="present",onChange:u=>M(t.id,l,u.target.checked)})},l)})]},t.id))})]})]})})]})]})})]})}export{ae as default};
