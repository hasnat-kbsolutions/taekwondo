import{r as g,W as Q,j as e,Y as Z,y as N,b as ee}from"./app-DA1l7Pz2.js";import{A as te,B as se,D as ae,a as le,b as ne,c as F,t as w}from"./authenticated-layout-Cm50mDP7.js";import{B as i}from"./button-Gy5bETBI.js";import{C as r,a as c,b as o,c as d}from"./card-ZeUXod8E.js";import{L as C}from"./label-C4prtjBf.js";import{S as ie,a as re,b as ce,c as oe,e as de}from"./select-BQWZ1kLl.js";import{D as me}from"./DataTable-DkXI1nMY.js";import{D as he,a as xe,b as pe,c as je,d as fe,e as P}from"./dialog-C1vFvh2b.js";import{F as E,U as z}from"./upload-BeZkSTfH.js";import{D as I}from"./download-DIu56G-Q.js";import{T as ue}from"./trash-2-BSBV37O0.js";import{W as L}from"./wallet-D0WVAAOE.js";import{H as ge}from"./hourglass-BTaeeI1R.js";import{C as O}from"./circle-x-D7hkOPQn.js";import{E as Ne}from"./ellipsis-Ctegt4N9.js";import{F as we}from"./file-text-DPCVAiK_.js";import{f as ye}from"./format-LUeNQFBy.js";import"./input-DxV1BBW2.js";import"./separator-BSkw8R2-.js";import"./index-BPW7cAYa.js";import"./sun-CWJzmtv-.js";import"./users-OAYQJbng.js";import"./log-out-BN-MizCe.js";import"./index-ymjLEhg1.js";import"./index-D85rk6Z2.js";import"./chevron-down-BJ8BK26W.js";import"./table-CHDeVmLV.js";const v=new Date().getFullYear(),be=Array.from({length:31},(l,n)=>v-15+n),k=(l,n="MYR")=>{const m=Number(l)||0;return n==="JPY"?m.toLocaleString():m.toFixed(2)},ve=l=>{if(l===0)return"0 Bytes";const n=1024,m=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(l)/Math.log(n));return Math.round(l/Math.pow(n,y)*100)/100+" "+m[y]};function qe({year:l,payments:n,totalPayments:m,paidPayments:y,pendingPayments:$,unpaidPayments:B,amountsByCurrency:h,defaultCurrencyCode:f}){const[H,R]=g.useState(l||v),W=t=>{const a=parseInt(t);R(a),N.get(route("student.payments.index"),{year:a})},K=()=>{R(v),N.get(route("student.payments.index"),{year:v})},V=[{header:"#",cell:({row:t})=>t.index+1},{header:"Amount",cell:({row:t})=>{var j;const a=((j=t.original.currency)==null?void 0:j.symbol)||"RM",p=t.original.currency_code||"MYR";return`${a} ${k(t.original.amount,p)}`}},{header:"Method",accessorKey:"method"},{header:"Status",cell:({row:t})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.original.status==="paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.original.status})},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",cell:({row:t})=>t.original.pay_at?ye(new Date(t.original.pay_at),"MMM dd, yyyy"):"-"},{header:"Notes",cell:({row:t})=>t.original.notes||"-"},{header:"Proof",cell:({row:t})=>{const a=t.original;return e.jsx("div",{className:"flex items-center gap-2",children:a.attachment?e.jsx(E,{className:"w-4 h-4 text-primary"}):e.jsx(O,{className:"w-4 h-4 text-muted-foreground"})})}},{header:"Actions",cell:({row:t})=>e.jsxs(ae,{children:[e.jsx(le,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsxs(ne,{align:"end",children:[e.jsx(F,{asChild:!0,children:e.jsxs(ee,{href:route("invoice.show",{payment:t.original.id}),children:[e.jsx(we,{className:"w-4 h-4 mr-2"})," View Invoice"]})}),e.jsxs(F,{onClick:a=>{a.preventDefault();const p=route("invoice.download",{payment:t.original.id});window.open(p,"_blank")},children:[e.jsx(I,{className:"w-4 h-4 mr-2"})," Download Invoice"]}),e.jsxs(F,{onClick:a=>{a.preventDefault(),D(t.original),u(!0)},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),t.original.attachment?"Manage":"Upload"," ","Proof"]})]})]})}],[G,u]=g.useState(!1),[s,D]=g.useState(null),[Y,b]=g.useState(null),[x,M]=g.useState(null),{data:_,setData:J,processing:A,errors:U,reset:S}=Q({attachment:null}),T=t=>{var p;const a=(p=t.target.files)==null?void 0:p[0];if(M(a||null),a){if(a.type.startsWith("image/")){const j=new FileReader;j.onloadend=()=>{b(j.result)},j.readAsDataURL(a)}else b(null);J("attachment",a)}},X=()=>{var a;if(!_.attachment||!s){w.error("Please select a file to upload");return}const t=new FormData;t.append("attachment",_.attachment),(a=s.attachment)!=null&&a.id&&t.append("replace_attachment_id",s.attachment.id.toString()),N.post(route("student.payments.upload-attachment",{payment:s.id}),t,{onSuccess:()=>{w.success(s.attachment?"Attachment updated successfully":"Attachment uploaded successfully"),u(!1),b(null),M(null),S()},onError:()=>{w.error("Failed to upload attachment")}})},q=()=>{s!=null&&s.attachment&&confirm("Are you sure you want to delete this attachment?")&&N.delete(route("student.payments.delete-attachment",{attachment:s.attachment.id}),{onSuccess:()=>{w.success("Attachment deleted successfully"),u(!1),D(null),N.reload({only:["payments"]})},onError:()=>{w.error("Failed to delete attachment")}})};return e.jsxs(te,{header:"My Payments",children:[e.jsx(Z,{title:"My Payments"}),e.jsx(he,{open:G,onOpenChange:u,children:e.jsxs(xe,{className:"max-w-2xl",children:[e.jsxs(pe,{children:[e.jsx(je,{children:s!=null&&s.attachment?"Update Payment Proof":"Upload Payment Proof"}),e.jsx(fe,{children:"Upload an image or PDF as proof of payment. Max 5MB."})]}),e.jsxs("div",{className:"space-y-4",children:[(s==null?void 0:s.attachment)&&!x&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(E,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.attachment.original_filename}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.attachment.file_type.toUpperCase()," ","â€¢"," ",ve(s.attachment.file_size)]})]})]})}),s.attachment.file_type.match(/^(jpg|jpeg|png|gif|webp)$/i)&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:`/storage/${s.attachment.file_path}`,alt:"Current proof",className:"w-full h-auto max-h-64 object-contain bg-white"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{s!=null&&s.attachment&&window.open(route("student.payments.download-attachment",{attachment:s.attachment.id}),"_blank")},children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(i,{size:"sm",variant:"destructive",className:"flex-1",onClick:q,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),Y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-muted/50",children:e.jsx("img",{src:Y,alt:"Preview",className:"w-full h-auto max-h-64 object-contain"})})]}),(!(s!=null&&s.attachment)||x)&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),X()},children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(C,{htmlFor:"attachment",children:"Select File"}),e.jsx("input",{id:"attachment",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:T,className:"file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-4 file:py-2 file:mr-4 text-sm"}),U.attachment&&e.jsx("p",{className:"text-sm text-red-600",children:U.attachment})]})}),e.jsxs(P,{className:"gap-2 mt-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>{x?(M(null),b(null),S()):(u(!1),D(null),S())},children:x?"Cancel":"Close"}),x&&e.jsx(i,{type:"submit",disabled:A,children:A?"Uploading...":s!=null&&s.attachment?"Replace":"Upload"})]})]}),e.jsx("input",{id:"attachment-hidden",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:T,className:"hidden"}),(s==null?void 0:s.attachment)&&!x&&e.jsx(P,{children:e.jsxs(i,{variant:"outline",onClick:()=>{var t;(t=document.getElementById("attachment-hidden"))==null||t.click()},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Replace with New File"]})})]})]})}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(o,{children:"Filters"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[180px]",children:[e.jsx(C,{className:"text-sm mb-1",children:"Year"}),e.jsxs(ie,{onValueChange:W,value:H.toString(),children:[e.jsx(re,{children:e.jsx(ce,{placeholder:"Select a year"})}),e.jsx(oe,{children:be.map(t=>e.jsx(de,{value:t.toString(),children:t},t))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(i,{onClick:K,children:"Reset Filters"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Payments"}),e.jsx(L,{className:"h-6 w-6 text-primary"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:m||0})})]}),e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Paid"}),e.jsx(se,{className:"h-6 w-6 text-green-600"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y||0})})]}),e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Unpaid"}),e.jsx(ge,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:$||0})})]}),e.jsxs(r,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Unpaid"}),e.jsx(O,{className:"h-6 w-6 text-red-600"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:B||0})})]}),e.jsxs(r,{className:"col-span-1 sm:col-span-2 lg:col-span-4",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(L,{className:"h-6 w-6 text-primary"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"text-lg font-bold",children:[f==="MYR"?"RM":f," ",k((h==null?void 0:h[f||"MYR"])||0,f||"MYR")]}),h&&Object.keys(h).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(h).filter(([t])=>t!==f).map(([t,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t,":"]}),e.jsx("span",{children:k(a,t)})]},t))})]})})]})]}),e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(o,{children:"My Payments"})}),e.jsx(d,{children:e.jsx(me,{data:n,columns:V})})]})]})]})}export{qe as default};
