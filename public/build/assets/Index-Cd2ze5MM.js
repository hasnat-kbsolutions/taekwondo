import{j as e,b as y,q as ie,r as n,W as ne,Y as oe,y as M}from"./app-DA1l7Pz2.js";import{D as de}from"./DataTable-DkXI1nMY.js";import{B as p}from"./button-Gy5bETBI.js";import{D as ce,a as me,b as ue,c as N,A as xe}from"./authenticated-layout-Cm50mDP7.js";import{B as he}from"./badge-CCwunBC7.js";import{R as se}from"./RatingStars-BnQe8JAd.js";import{s as c}from"./index-sFwGSaal.js";import{F as pe}from"./file-text-DPCVAiK_.js";import{E as ge}from"./ellipsis-Ctegt4N9.js";import{E as fe}from"./eye-Dy4kN5Qq.js";import{S as je}from"./square-pen-EadRlnHQ.js";import{K as ve}from"./key-tKNGguX9.js";import{T as be}from"./trash-2-BSBV37O0.js";import{C as R,a as W,b as q,c as G}from"./card-ZeUXod8E.js";import{L as d}from"./label-C4prtjBf.js";import{I as H}from"./input-DxV1BBW2.js";import{S as z,a as A,b as P,c as F,e as u}from"./select-BQWZ1kLl.js";import{C as Y}from"./country-dropdown-C9X8RD3h.js";import{D as J,a as Q,b as X,c as Z,d as ee,e as Ne}from"./dialog-C1vFvh2b.js";import"./table-CHDeVmLV.js";import"./separator-BSkw8R2-.js";import"./index-BPW7cAYa.js";import"./sun-CWJzmtv-.js";import"./users-OAYQJbng.js";import"./log-out-BN-MizCe.js";import"./index-ymjLEhg1.js";import"./index-D85rk6Z2.js";import"./chevron-down-BJ8BK26W.js";import"./popover-DAnT2VMw.js";import"./globe-D2gkbQgu.js";const ye=(w,j)=>[{header:"#",cell:({row:t})=>t.index+1,meta:{sticky:!0,left:"0px",className:"border-r shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] min-w-[60px] w-[60px]"}},{accessorKey:"code",header:"Code",meta:{sticky:!0,left:"60px",className:"border-r shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] min-w-[120px]"}},{accessorKey:"name",header:"Name",cell:({row:t})=>e.jsx(y,{href:c("admin.student-insights.show",t.original.id),className:"text-blue-600 hover:text-blue-800 hover:underline font-medium",children:t.original.name}),meta:{sticky:!0,left:"180px",className:"border-r shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] min-w-[150px]"}},{accessorKey:"email",header:"Email"},{id:"profile_image",header:"Photo",cell:({row:t})=>{const r=t.original.profile_image;if(r){const v=r.startsWith("http")?r:`/storage/${r}`;return e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:v,alt:"Profile",className:"w-10 h-10 rounded-full object-cover",onError:o=>{var x;o.currentTarget.style.display="none",(x=o.currentTarget.nextElementSibling)==null||x.classList.remove("hidden")}}),e.jsx("span",{className:"text-gray-400 italic text-xs hidden absolute inset-0 flex items-center justify-center",children:"No image"})]})}return e.jsx("span",{className:"text-gray-400 italic",children:"No image"})}},{accessorKey:"surname",header:"Surname"},{accessorKey:"dob",header:"DOB"},{accessorKey:"id_passport",header:"ID/Passport"},{accessorKey:"phone",header:"Phone"},{id:"organization",header:"Organization",cell:({row:t})=>{var r;return((r=t.original.organization)==null?void 0:r.name)||"Not specified"}},{id:"club",header:"Club",cell:({row:t})=>{var r;return((r=t.original.club)==null?void 0:r.name)||"Not specified"}},{id:"identification_document",header:"Documents",cell:({row:t})=>{const r=t.original.identification_document;if(r){const v=r.startsWith("http")?r:`/storage/${r}`;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-blue-500"}),e.jsx("a",{href:v,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-xs underline",children:"View Doc"})]})}return e.jsx("span",{className:"text-gray-400 italic text-xs",children:"No doc"})}},{id:"rating",header:"Rating",cell:({row:t})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{rating:typeof t.original.average_rating=="number"?Math.round(t.original.average_rating):0,readonly:!0,size:"sm"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",t.original.total_ratings,")"]})]})},{accessorKey:"status",header:"Status",cell:({row:t})=>e.jsx(he,{variant:t.original.status?"default":"destructive",children:t.original.status?"Active":"Inactive"})},{id:"actions",header:"Actions",cell:({row:t})=>{const r=t.original;return e.jsxs(ce,{children:[e.jsx(me,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(ue,{align:"end",children:[e.jsxs(N,{onClick:()=>w(r),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"})," View"]}),e.jsx(N,{asChild:!0,children:e.jsxs(y,{href:c("admin.students.edit",r.id),children:[e.jsx(je,{className:"w-4 h-4 mr-2"})," Edit"]})}),j&&e.jsxs(N,{onClick:()=>j(r),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"})," Change Password"]}),e.jsx(N,{asChild:!0,children:e.jsxs(y,{href:c("admin.students.destroy",r.id),method:"delete",as:"button",children:[e.jsx(be,{className:"w-4 h-4 mr-2"})," Delete"]})})]})]})}}];function ss({students:w,organizations:j=[],clubs:t=[],nationalities:r=[],countries:v=[],filters:o}){var O,U,B;const{props:x}=ie(),[we,ae]=n.useState(!1),[_e,te]=n.useState([]),[_,T]=n.useState(o.organization_id||"all"),[S,$]=n.useState(o.club_id||"all"),[C,K]=n.useState(o.nationality||"all"),[D,V]=n.useState(o.country||"all"),[I,k]=n.useState(o.status||"all"),[a,L]=n.useState(null),[g,b]=n.useState(null),l=ne({password:"",password_confirmation:""});n.useEffect(()=>{var s;if((s=x.flash)!=null&&s.import_log){const i=x.flash.import_log;let m=i.find(h=>h.summary),le=i.filter(h=>h.status),E=[];m&&E.push(`Total: ${m.total}, Success: ${m.success}, Failed: ${m.failed}, Percentage: ${m.percentage}%`+(m.error?`, Error: ${m.error}`:"")),le.forEach(h=>{E.push(`${h.status==="success"?"✅":"❌"} ${h.message}`)}),te(E),ae(!0)}},[(O=x.flash)==null?void 0:O.import_log]);const f=s=>{M.get(c("admin.students.index"),{organization_id:s.organization_id??(_!=="all"?_:null),club_id:s.club_id??(S!=="all"?S:null),nationality:s.nationality??(C||null),country:s.country??(D||null),status:s.status??(I!=="all"?I:null)},{preserveScroll:!0,preserveState:!0,replace:!0})},re=()=>{T("all"),$("all"),K(""),V(""),k("all"),M.get(c("admin.students.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})};return e.jsxs(xe,{header:"Students",children:[e.jsx(oe,{title:"Students"}),e.jsxs("div",{className:"container-fluid py-10 w-full",children:[e.jsxs(R,{children:[e.jsx(W,{className:"flex  flex-row items-center justify-between",children:e.jsx(q,{children:"Import / Export Students"})}),e.jsx(G,{children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:e.jsx(p,{asChild:!0,variant:"outline",children:e.jsx("a",{href:c("admin.students.export"),children:"Export Students"})})})})]}),e.jsxs(R,{children:[e.jsxs(W,{className:"flex flex-row items-center justify-between",children:[e.jsx(q,{children:"Students"}),e.jsx(y,{href:c("admin.students.create"),children:e.jsx(p,{children:"Add Student"})})]}),e.jsxs(G,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"organization",className:"text-sm mb-1",children:"Organization"}),e.jsxs(z,{value:_,onValueChange:s=>{T(s),f({organization_id:s})},children:[e.jsx(A,{id:"organization",className:"w-48",children:e.jsx(P,{placeholder:"All Organizations"})}),e.jsxs(F,{children:[e.jsx(u,{value:"all",children:"All"}),j.map(s=>e.jsx(u,{value:String(s.id),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"club",className:"text-sm mb-1",children:"Club"}),e.jsxs(z,{value:S,onValueChange:s=>{$(s),f({club_id:s})},children:[e.jsx(A,{id:"club",className:"w-48",children:e.jsx(P,{placeholder:"All Clubs"})}),e.jsxs(F,{children:[e.jsx(u,{value:"all",children:"All"}),t.map(s=>e.jsx(u,{value:String(s.id),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"w-[200px]",children:[e.jsx(d,{className:"text-sm mb-1",children:"Nationality"}),e.jsx(Y,{placeholder:"All Nationalities",defaultValue:C||"",onChange:s=>{const i=(s==null?void 0:s.alpha3)||"";K(i),f({nationality:i})},slim:!1})]}),e.jsxs("div",{className:"w-[200px]",children:[e.jsx(d,{className:"text-sm mb-1",children:"Country"}),e.jsx(Y,{placeholder:"All Countries",defaultValue:D||"",onChange:s=>{const i=(s==null?void 0:s.alpha3)||"";V(i),f({country:i})},slim:!1})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status",className:"text-sm mb-1",children:"Status"}),e.jsxs(z,{value:I,onValueChange:s=>{k(s),f({status:s})},children:[e.jsx(A,{id:"status",className:"w-32",children:e.jsx(P,{placeholder:"All Statuses"})}),e.jsxs(F,{children:[e.jsx(u,{value:"all",children:"All"}),e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"inactive",children:"Inactive"})]})]})]}),e.jsx("div",{children:e.jsx(p,{variant:"secondary",onClick:re,children:"Reset Filters"})})]})}),e.jsx(de,{columns:ye(s=>L(s),s=>b(s)),data:w})]})]}),a&&e.jsx(J,{open:!!a,onOpenChange:s=>{s||L(null)},children:e.jsxs(Q,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Student Details"}),e.jsx(ee,{children:"View detailed information about the student."})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[a.profile_image?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.profile_image.startsWith("http")?a.profile_image:`/storage/${a.profile_image}`,alt:"Profile",className:"w-32 h-32 rounded-full object-cover border-2 border-gray-200 shadow-lg",onError:s=>{var i;s.currentTarget.style.display="none",(i=s.currentTarget.nextElementSibling)==null||i.classList.remove("hidden")}}),e.jsx("div",{className:"w-32 h-32 hidden flex items-center justify-center rounded-full bg-gray-100 text-gray-400 text-sm italic border-2 border-gray-200",children:"No Image"})]}):e.jsx("div",{className:"w-32 h-32 flex items-center justify-center rounded-full bg-gray-100 text-gray-400 text-sm italic border-2 border-gray-200",children:"No Image"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[a.name," ",a.surname]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.code})]})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{label:"UID",value:a.uid},{label:"Email",value:a.email},{label:"Phone",value:a.phone},{label:"Grade",value:a.grade},{label:"Gender",value:a.gender},{label:"Nationality",value:a.nationality},{label:"Date of Birth",value:a.dob?new Date(a.dob).toLocaleDateString():"Not specified"},{label:"Date of Death",value:a.dod?new Date(a.dod).toLocaleDateString():"Not specified"},{label:"ID/Passport",value:a.id_passport},{label:"Identification Document",value:a.identification_document?e.jsx("a",{href:a.identification_document.startsWith("http")?a.identification_document:`/storage/${a.identification_document}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"View Document"}):"No document uploaded"},{label:"Street",value:a.street||"Not specified"},{label:"Postal Code",value:a.postal_code||"Not specified"},{label:"City",value:a.city||"Not specified"},{label:"Country",value:a.country||"Not specified"},{label:"Organization",value:((U=a.organization)==null?void 0:U.name)||"Not specified"},{label:"Club",value:((B=a.club)==null?void 0:B.name)||"Not specified"},{label:"Status",value:a.status?"Active":"Inactive"},{label:"Rating",value:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{rating:typeof a.average_rating=="number"?Math.round(a.average_rating):0,readonly:!0,size:"sm"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[typeof a.average_rating=="number"?a.average_rating.toFixed(1):"0.0"," ","(",a.total_ratings," ","ratings)"]})]})}].map((s,i)=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:s.label}),e.jsx("div",{className:"text-sm",children:s.value})]},i))})]})]})}),g&&e.jsx(J,{open:!!g,onOpenChange:s=>{s||(b(null),l.reset())},children:e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Change Password"}),e.jsxs(ee,{children:["Update password for"," ",g.name," ",g.surname]})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),l.patch(c("admin.students.updatePassword",g.id),{onSuccess:()=>{b(null),l.reset()}})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"password",children:["New Password"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(H,{id:"password",type:"password",placeholder:"Enter new password",value:l.data.password,onChange:s=>l.setData("password",s.target.value),required:!0}),l.errors.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.errors.password})]}),e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"password_confirmation",children:["Confirm Password"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(H,{id:"password_confirmation",type:"password",placeholder:"Confirm new password",value:l.data.password_confirmation,onChange:s=>l.setData("password_confirmation",s.target.value),required:!0}),l.errors.password_confirmation&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.errors.password_confirmation})]}),e.jsxs(Ne,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>{b(null),l.reset()},children:"Cancel"}),e.jsx(p,{type:"submit",disabled:l.processing,children:l.processing?"Updating...":"Update Password"})]})]})]})})]})]})}export{ss as default};
