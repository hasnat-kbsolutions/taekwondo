import{r as l,y as z,j as e,Y as I,a as W}from"./app-DTQk7vxO.js";import{A as q,t as T}from"./authenticated-layout-CC74nmYh.js";import{C as M,a as _,b as D,c as k}from"./card-IdKNm35h.js";import{B as G}from"./button-CWNR-vJJ.js";import{L as u}from"./label-D5atn-hE.js";import{S as j,a as p,b as f,c as g,e as d}from"./select-C2jbp9A4.js";import{T as J,a as K,b as Y,c as L,d as P,e as $}from"./table-_7vXIEUi.js";import{e as Q,a as U,s as X}from"./startOfMonth-alQccdl5.js";import{f as F}from"./format-7_oTgTIh.js";import"./input-Bg81MIu0.js";import"./separator-C00dqrTm.js";import"./index-SIYl0Iv-.js";import"./sun-DpprhLd3.js";import"./users-CqSFjye9.js";import"./log-out-BKeuGqX9.js";import"./index-DiFbUrIw.js";import"./index-B8ANasXJ.js";import"./chevron-down-0Kdm1Tqi.js";function fe({studentsWithAttendance:V,clubs:B,filters:x}){var y,A;const m=new Date().getFullYear(),b=(new Date().getMonth()+1).toString().padStart(2,"0"),[c,S]=l.useState(((y=x.date)==null?void 0:y.split("-")[0])||m.toString()),[i,v]=l.useState(((A=x.date)==null?void 0:A.split("-")[1])||b),[h,w]=l.useState(()=>({club_id:x.club_id||""}));l.useEffect(()=>{const t=setTimeout(()=>{const s=`${c}-${i}`,a={...h,date:s};z.get(route("organization.attendances.index"),a,{preserveState:!0,replace:!0,only:["studentsWithAttendance"]})},300);return()=>clearTimeout(t)},[c,i,h.club_id]);const N=new Date(`${c}-${i}-01`),C=Q({start:X(N),end:U(N)}),[E,H]=l.useState(V),O=async(t,s,a)=>{const r=a?"present":"absent";try{await W.post(route("organization.attendances.toggle"),{student_id:t,date:s,status:r}),H(o=>o.map(n=>({...n,records:n.student.id===t?{...n.records,[s]:r}:n.records}))),T.success(`Attendance marked as ${r}`)}catch{T.error("Failed to update attendance")}},R=()=>{S(m.toString()),v(b),w({club_id:""})};return e.jsxs(q,{header:"Attendances",children:[e.jsx(I,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-5",children:e.jsxs(M,{children:[e.jsx(_,{className:"flex flex-row items-center justify-between",children:e.jsx(D,{children:"Filters"})}),e.jsx(k,{children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Club"}),e.jsxs(j,{value:h.club_id,onValueChange:t=>w(s=>({...s,club_id:t})),children:[e.jsx(p,{children:e.jsx(f,{placeholder:"All Clubs"})}),e.jsxs(g,{children:[e.jsx(d,{value:"all",children:"All"}),B.map(t=>e.jsx(d,{value:t.id.toString(),children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Year"}),e.jsxs(j,{value:c,onValueChange:S,children:[e.jsx(p,{children:e.jsx(f,{placeholder:"Year"})}),e.jsx(g,{children:Array.from({length:5},(t,s)=>(m-s).toString()).map(t=>e.jsx(d,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Month"}),e.jsxs(j,{value:i,onValueChange:v,children:[e.jsx(p,{children:e.jsx(f,{placeholder:"Month"})}),e.jsx(g,{children:Array.from({length:12},(t,s)=>{const a=(s+1).toString().padStart(2,"0");return e.jsx(d,{value:a,children:new Date(0,s).toLocaleString("default",{month:"long"})},a)})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(G,{className:"bg-foreground text-background",onClick:R,children:"Reset Filters"})})]})})]})}),e.jsx("div",{className:"container mx-auto",children:e.jsxs(M,{children:[e.jsx(_,{children:e.jsx(D,{children:"Attendance List"})}),e.jsx(k,{children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx(L,{children:"Student"}),C.map(t=>e.jsx(L,{className:"text-center min-w-[40px]",children:F(t,"dd")},t.toString()))]})}),e.jsx(P,{children:E.map(({student:t,records:s})=>e.jsxs(Y,{children:[e.jsx($,{children:t.name}),C.map(a=>{const r=F(a,"yyyy-MM-dd"),o=s[r];return e.jsx($,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:o==="present",onChange:n=>O(t.id,r,n.target.checked)})},r)})]},t.id))})]})})})})]})})]})}export{fe as default};
