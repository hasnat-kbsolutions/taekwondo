import{q as E,r as c,j as e,Y,b as g,y as S}from"./app-CNLR0DIp.js";import{A as $}from"./authenticated-layout-DutDL5IX.js";import{B as p}from"./button-BFvzOohO.js";import{S as w,a as C,b as P,c as B,e as k}from"./select-B8yE-HKp.js";import{C as d,a as F,b as M,c as m}from"./card-A51GI-p_.js";import{L as _}from"./label-DDNeWs3Y.js";import{s as h}from"./index-sFwGSaal.js";import"./input-BdDHIpxK.js";import"./separator-DTrM_Ru7.js";import"./index-BswMLaOF.js";import"./sun-CboAYruK.js";import"./users-CUo-C-vI.js";import"./log-out-B1kDetli.js";import"./index-RVYuYhkN.js";import"./index-CwCbuvh8.js";import"./chevron-down-Di6Iui4y.js";const D=new Date().getFullYear(),J=Array.from({length:10},(i,u)=>(D-u).toString()),V=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function le(){const{studentsWithPlans:i=[],month:u="",errors:j={}}=E().props,y=(t=>{if(t&&t.match(/^\d{4}-\d{2}$/)){const[s,l]=t.split("-");return{year:s,month:l}}return{year:"",month:""}})(u),[a,A]=c.useState({year:y.year,month:y.month}),[n,b]=c.useState(i),[o,x]=c.useState(!1);c.useEffect(()=>{b(i)},[i]);const f=(t,s)=>{A(l=>{const r={...l,[t]:s},N=r.year&&r.month?`${r.year}-${r.month}`:"";return N?(x(!0),S.get(h("club.payments.bulk-generate"),{month:N},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{x(!1)},onError:()=>{x(!1)}})):b([]),r})},G=t=>{t.preventDefault();const s=a.year&&a.month?`${a.year}-${a.month}`:"";S.post(h("club.payments.bulk-generate.store"),{month:s})},v=t=>j[t]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:j[t]}),L=n.reduce((t,s)=>{const l=s.currency_code||"MYR";return t[l]||(t[l]={count:0,total:0}),t[l].count++,t[l].total+=s.effective_amount,t},{});return e.jsxs($,{header:"Bulk Generate Payments",children:[e.jsx(Y,{title:"Bulk Generate Payments"}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Generate Payments for All Students"}),e.jsx(g,{href:h("club.payments.index"),children:e.jsx(p,{variant:"outline",children:"Back to Payments"})})]}),e.jsxs(d,{children:[e.jsx(F,{children:e.jsx(M,{children:"Bulk Payment Generation"})}),e.jsx(m,{children:e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md",children:[e.jsxs("div",{children:[e.jsxs(_,{htmlFor:"year",children:["Year"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{value:a.year,onValueChange:t=>f("year",t),disabled:o,children:[e.jsx(C,{className:"mt-1",children:e.jsx(P,{placeholder:"Select year"})}),e.jsx(B,{children:J.map(t=>e.jsx(k,{value:t,children:t},t))})]}),v("year")]}),e.jsxs("div",{children:[e.jsxs(_,{htmlFor:"month",children:["Month"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(w,{value:a.month,onValueChange:t=>f("month",t),disabled:o,children:[e.jsx(C,{className:"mt-1",children:e.jsx(P,{placeholder:"Select month"})}),e.jsx(B,{children:V.map(t=>e.jsx(k,{value:t.value,children:t.label},t.value))})]}),v("month")]})]}),o&&e.jsx("p",{className:"text-sm text-blue-500",children:"Loading filtered students..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select the year and month for which payments will be generated. Students who already have payments for this month will be excluded. Due date will be set to the end of the selected month."}),n.length>0&&e.jsxs(d,{children:[e.jsx(F,{children:e.jsxs(M,{className:"text-lg",children:["Preview: ",n.length," ","Student(s) will receive payments"]})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Summary by Currency:"}),e.jsx("div",{className:"space-y-1",children:Object.entries(L).map(([t,s])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[t,":"," ",s.count," ","payment(s)"]}),e.jsxs("span",{className:"font-medium",children:[t," ",s.total.toFixed(2)]})]},t))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Students:"}),e.jsx("div",{className:"max-h-60 overflow-y-auto border rounded-md p-2",children:e.jsx("div",{className:"space-y-1",children:n.map(t=>e.jsxs("div",{className:"flex justify-between text-sm py-1 border-b last:border-b-0",children:[e.jsx("span",{children:t.student_name}),e.jsxs("span",{className:"font-medium",children:[t.currency_code," ",t.effective_amount.toFixed(2)]})]},t.student_id))})})]})]})})]}),!a.year||!a.month?e.jsx(d,{children:e.jsx(m,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Please select both year and month to see students who will receive payments."})})}):n.length===0?e.jsx(d,{children:e.jsx(m,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground text-center",children:"No students with active fee plans found for this month, or all students already have payments for this month. Please assign fee plans to students first."})})}):null,e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(g,{href:h("club.payments.index"),children:e.jsx(p,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(p,{type:"submit",disabled:n.length===0||!a.year||!a.month||o,children:"Generate Payments"})]})]})})]})]})]})}export{le as default};
