import{r as M,W as se,j as e,Y as te,y as k,b as ae}from"./app-ByP4EyMF.js";import{A as le,W as ie,B as ne,r as ce,q as re,D as de,a as oe,b as me,c as z,t as D}from"./authenticated-layout-Qq67eihM.js";import{B as x}from"./button-xRIIPuWW.js";import{C as n,a as c,b as r,c as d}from"./card-CKPA4ccG.js";import{L as E}from"./label-DlfdlFhI.js";import{S as xe,a as he,b as pe,c as je,e as ge}from"./select-DYOzuw-F.js";import{D as fe}from"./DataTable-Dw3B_R9W.js";import{D as Ne,a as be,b as we,c as ve,d as ue,e as W}from"./dialog-By_CRj9h.js";import{F as K}from"./file-check-mEqBlUoa.js";import{D as V}from"./download-Cl1z07H7.js";import{T as Me}from"./trash-2-BVfeJSpJ.js";import{U as q}from"./upload-MnKly1K6.js";import{c as G}from"./sun-w0LeklHu.js";import{H as ke}from"./hourglass-r_ahzZgW.js";import{C as De}from"./circle-check-B7xuna73.js";import{C as Re}from"./circle-x-D7u-GhdJ.js";import{E as Ye}from"./ellipsis-C7xeqP8s.js";import{F as Se}from"./file-text-C9-O2sHM.js";import{f as ye}from"./format-LUeNQFBy.js";import"./input-DHU4GFng.js";import"./separator-DivMgUP8.js";import"./index-DmN_BMdc.js";import"./users-BmXZoUBI.js";import"./log-out-DV0RpnIg.js";import"./index-BMO2_zHf.js";import"./index-UrMmZlMe.js";import"./index-C39nNiIL.js";import"./chevron-down-oDmv8qA3.js";import"./table-9EkxEIEw.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=G("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=G("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),S=new Date().getFullYear(),Ue=Array.from({length:31},(o,m)=>S-15+m),i=(o,m="MYR")=>{const h=Number(o)||0;return m==="JPY"?h.toLocaleString():h.toFixed(2)},Oe=o=>{if(o===0)return"0 Bytes";const m=1024,h=["Bytes","KB","MB","GB"],R=Math.floor(Math.log(o)/Math.log(m));return Math.round(o/Math.pow(m,R)*100)/100+" "+h[R]};function ms({year:o,payments:m,totalPayments:h,paidPayments:R,pendingPayments:J,unpaidPayments:ze,amountsByCurrency:y,paidAmountsByCurrency:p,unpaidAmountsByCurrency:j,monthlyBreakdown:F,allTimePaidByCurrency:g,allTimeTotalByCurrency:f,defaultCurrencyCode:a,availableYears:Ee}){const[v,H]=M.useState(o||S),X=s=>{const l=parseInt(s);H(l),k.get(route("student.payments.index"),{year:l})},Q=()=>{H(S),k.get(route("student.payments.index"),{year:S})},Z=[{header:"#",cell:({row:s})=>s.index+1},{header:"Amount",cell:({row:s})=>{var w;const l=((w=s.original.currency)==null?void 0:w.symbol)||"RM",b=s.original.currency_code||"MYR";return`${l} ${i(s.original.amount,b)}`}},{header:"Method",accessorKey:"method"},{header:"Status",cell:({row:s})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.original.status==="paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.original.status})},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",cell:({row:s})=>s.original.pay_at?ye(new Date(s.original.pay_at),"MMM dd, yyyy"):"-"},{header:"Notes",cell:({row:s})=>s.original.notes||"-"},{header:"Proof",cell:({row:s})=>{const l=s.original;return e.jsx("div",{className:"flex items-center gap-2",children:l.attachment?e.jsx(K,{className:"w-4 h-4 text-primary"}):e.jsx(Re,{className:"w-4 h-4 text-muted-foreground"})})}},{header:"Actions",cell:({row:s})=>e.jsxs(de,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ye,{className:"h-4 w-4"})})}),e.jsxs(me,{align:"end",children:[e.jsx(z,{asChild:!0,children:e.jsxs(ae,{href:route("invoice.show",{payment:s.original.id}),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"})," View Invoice"]})}),e.jsxs(z,{onClick:l=>{l.preventDefault();const b=route("invoice.download",{payment:s.original.id});window.open(b,"_blank")},children:[e.jsx(V,{className:"w-4 h-4 mr-2"})," Download Invoice"]}),e.jsxs(z,{onClick:l=>{l.preventDefault(),_(s.original),u(!0)},children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),s.original.attachment?"Manage":"Upload"," ","Proof"]})]})]})}],[T,u]=M.useState(!1),[t,_]=M.useState(null),[I,Y]=M.useState(null),[N,U]=M.useState(null),{data:L,setData:B,processing:P,errors:$,reset:O}=se({attachment:null}),A=s=>{var b;const l=(b=s.target.files)==null?void 0:b[0];if(U(l||null),l){if(l.type.startsWith("image/")){const w=new FileReader;w.onloadend=()=>{Y(w.result)},w.readAsDataURL(l)}else Y(null);B("attachment",l)}},C=()=>{var l;if(!L.attachment||!t){D.error("Please select a file to upload");return}const s=new FormData;s.append("attachment",L.attachment),(l=t.attachment)!=null&&l.id&&s.append("replace_attachment_id",t.attachment.id.toString()),k.post(route("student.payments.upload-attachment",{payment:t.id}),s,{onSuccess:()=>{D.success(t.attachment?"Attachment updated successfully":"Attachment uploaded successfully"),u(!1),Y(null),U(null),O()},onError:()=>{D.error("Failed to upload attachment")}})},ee=()=>{t!=null&&t.attachment&&confirm("Are you sure you want to delete this attachment?")&&k.delete(route("student.payments.delete-attachment",{attachment:t.attachment.id}),{onSuccess:()=>{D.success("Attachment deleted successfully"),u(!1),_(null),k.reload({only:["payments"]})},onError:()=>{D.error("Failed to delete attachment")}})};return e.jsxs(le,{header:"My Payments",children:[e.jsx(te,{title:"My Payments"}),e.jsx(Ne,{open:T,onOpenChange:u,children:e.jsxs(be,{className:"max-w-2xl",children:[e.jsxs(we,{children:[e.jsx(ve,{children:t!=null&&t.attachment?"Update Payment Proof":"Upload Payment Proof"}),e.jsx(ue,{children:"Upload an image or PDF as proof of payment. Max 5MB."})]}),e.jsxs("div",{className:"space-y-4",children:[(t==null?void 0:t.attachment)&&!N&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(K,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.attachment.original_filename}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.attachment.file_type.toUpperCase()," ","â€¢"," ",Oe(t.attachment.file_size)]})]})]})}),t.attachment.file_type.match(/^(jpg|jpeg|png|gif|webp)$/i)&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:`/storage/${t.attachment.file_path}`,alt:"Current proof",className:"w-full h-auto max-h-64 object-contain bg-white"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{t!=null&&t.attachment&&window.open(route("student.payments.download-attachment",{attachment:t.attachment.id}),"_blank")},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(x,{size:"sm",variant:"destructive",className:"flex-1",onClick:ee,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),I&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-muted/50",children:e.jsx("img",{src:I,alt:"Preview",className:"w-full h-auto max-h-64 object-contain"})})]}),(!(t!=null&&t.attachment)||N)&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),C()},children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(E,{htmlFor:"attachment",children:"Select File"}),e.jsx("input",{id:"attachment",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:A,className:"file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-4 file:py-2 file:mr-4 text-sm"}),$.attachment&&e.jsx("p",{className:"text-sm text-red-600",children:$.attachment})]})}),e.jsxs(W,{className:"gap-2 mt-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>{N?(U(null),Y(null),O()):(u(!1),_(null),O())},children:N?"Cancel":"Close"}),N&&e.jsx(x,{type:"submit",disabled:P,children:P?"Uploading...":t!=null&&t.attachment?"Replace":"Upload"})]})]}),e.jsx("input",{id:"attachment-hidden",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:A,className:"hidden"}),(t==null?void 0:t.attachment)&&!N&&e.jsx(W,{children:e.jsxs(x,{variant:"outline",onClick:()=>{var s;(s=document.getElementById("attachment-hidden"))==null||s.click()},children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Replace with New File"]})})]})]})}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(r,{children:"Filters"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[180px]",children:[e.jsx(E,{className:"text-sm mb-1",children:"Year"}),e.jsxs(xe,{onValueChange:X,value:v.toString(),children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Select a year"})}),e.jsx(je,{children:Ue.map(s=>e.jsx(ge,{value:s.toString(),children:s},s))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(x,{onClick:Q,children:"Reset Filters"})})]})})]}),e.jsxs(n,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-blue-600"}),e.jsx(r,{className:"text-lg",children:"All-Time Payment History"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Paid (All Time)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[a==="MYR"?"RM":a," ",i((g==null?void 0:g[a||"MYR"])||0,a||"MYR")]}),g&&Object.keys(g).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground",children:Object.entries(g).filter(([s])=>s!==a).map(([s,l])=>e.jsxs("span",{className:"mr-3",children:[s,": ",i(l,s)]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Billed (All Time)"}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[a==="MYR"?"RM":a," ",i((f==null?void 0:f[a||"MYR"])||0,a||"MYR")]}),f&&Object.keys(f).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground",children:Object.entries(f).filter(([s])=>s!==a).map(([s,l])=>e.jsxs("span",{className:"mr-3",children:[s,": ",i(l,s)]},s))})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(r,{className:"text-sm font-medium",children:["Total Payments (",v,")"]}),e.jsx(ie,{className:"h-6 w-6 text-primary"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:h||0})})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Paid"}),e.jsx(ne,{className:"h-6 w-6 text-green-600"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:R||0})})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Unpaid"}),e.jsx(ke,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:J||0})})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Year Total"}),e.jsx(ce,{className:"h-6 w-6 text-primary"})]}),e.jsx(d,{children:e.jsxs("div",{className:"text-lg font-bold",children:[a==="MYR"?"RM":a," ",i((y==null?void 0:y[a||"MYR"])||0,a||"MYR")]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(r,{className:"text-sm font-medium",children:["Paid Amount (",v,")"]}),e.jsx(De,{className:"h-6 w-6 text-green-600"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[a==="MYR"?"RM":a," ",i((p==null?void 0:p[a||"MYR"])||0,a||"MYR")]}),p&&Object.keys(p).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground",children:Object.entries(p).filter(([s])=>s!==a).map(([s,l])=>e.jsxs("span",{className:"mr-3",children:[s,": ",i(l,s)]},s))})]})})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(r,{className:"text-sm font-medium",children:["Unpaid Amount (",v,")"]}),e.jsx(re,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-2xl font-bold text-yellow-500",children:[a==="MYR"?"RM":a," ",i((j==null?void 0:j[a||"MYR"])||0,a||"MYR")]}),j&&Object.keys(j).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground",children:Object.entries(j).filter(([s])=>s!==a).map(([s,l])=>e.jsxs("span",{className:"mr-3",children:[s,": ",i(l,s)]},s))})]})})]})]}),F&&F.length>0&&e.jsxs(n,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-primary"}),e.jsxs(r,{children:["Monthly Breakdown (",v,")"]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:F.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.status==="paid"?"bg-green-500":s.status==="partial"?"bg-yellow-500":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.month_name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.paid_count," paid, ",s.unpaid_count," unpaid"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:[a==="MYR"?"RM":a," ",i(s.total_amount,a||"MYR")]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-green-600",children:["Paid: ",i(s.paid_amount,a||"MYR")]}),s.unpaid_amount>0&&e.jsxs("span",{className:"text-yellow-600",children:["Due: ",i(s.unpaid_amount,a||"MYR")]})]})]})]},s.month))})})]}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(r,{children:"My Payments"})}),e.jsx(d,{children:e.jsx(fe,{data:m,columns:Z})})]})]})]})}export{ms as default};
