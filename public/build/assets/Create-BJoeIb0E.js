import{q as R,r as q,m as H,j as s,Y as O,y as U}from"./app-DonfvVoW.js";import{A as z}from"./authenticated-layout-CqmZS_hs.js";import{I as f}from"./input-Dy_qbc52.js";import{B as _}from"./button-DYztBhfk.js";import{S as y,a as N,b as g,c as C,e as m}from"./select-BXXggIaW.js";import{C as S,a as b,b as w,c as D}from"./card-vZUl9tqe.js";import{L as i}from"./label-DmJFbOHp.js";import{C as F}from"./react-icons.esm-Bkepamhy.js";import{P as B,a as Y,b as E}from"./popover-DTvDaQfx.js";import{C as T}from"./calendar-BCmlrXd6.js";import{C as G}from"./checkbox-Crt_4wxr.js";import{f as u}from"./format-LUeNQFBy.js";import"./separator-Bj2Sa2yG.js";import"./index--YW_Mk4_.js";import"./sun-DZbQ5v7_.js";import"./users-puwp-WAo.js";import"./log-out-C0NbFVe-.js";import"./index-Bhx3pFlk.js";import"./index-CzXEmqM7.js";import"./chevron-down-BuTNFib9.js";function hs(){var M,k,$,I;const{students:h=[],studentFeePlans:j=[],currencies:J=[],bank_information:p=[],errors:A={}}=R().props,[r,l]=q.useState({student_id:"",month:"",amount:"",currency_code:"MYR",status:"paid",method:"cash",pay_at:"",due_date:"",notes:"",transaction_id:"",bank_information:[]}),e=H.useMemo(()=>r.student_id?j.find(t=>String(t.student_id)===String(r.student_id)):null,[r.student_id,j]),a=(t,o)=>{var c;if(l(n=>({...n,[t]:o})),t==="student_id"){const n=j.find(x=>String(x.student_id)===String(o));if(n){typeof n.effective_amount<"u"&&l(v=>({...v,amount:String(n.effective_amount)}));const x=n.currency_code||((c=n.plan)==null?void 0:c.currency_code);x&&l(v=>({...v,currency_code:x}))}}},V=(t,o)=>{l(c=>({...c,bank_information:o?[...c.bank_information,t]:c.bank_information.filter(n=>n!==t)}))},L=t=>{t.preventDefault(),U.post(route("admin.payments.store"),r)},d=t=>A[t]&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:A[t]});return s.jsxs(z,{header:"Add Payment",children:[s.jsx(O,{title:"Add Payment"}),s.jsx("div",{className:"p-6",children:s.jsxs(S,{children:[s.jsx(b,{children:s.jsx(w,{children:"Add Payment"})}),s.jsx(D,{children:s.jsxs("form",{onSubmit:L,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs(i,{children:["Student",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs(y,{value:r.student_id,onValueChange:t=>a("student_id",t),children:[s.jsx(N,{className:"w-full",children:s.jsx(g,{placeholder:"Select Student"})}),s.jsx(C,{children:Array.isArray(h)&&h.length>0?h.map(t=>s.jsxs(m,{value:String(t.id),children:[t.name," ",t.surname||""]},t.id)):s.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No students available"})})]}),d("student_id")]}),s.jsxs("div",{children:[s.jsx(i,{children:"Month (YYYY-MM)"}),s.jsx(f,{type:"month",value:r.month,onChange:t=>a("month",t.target.value)}),d("month")]}),s.jsxs("div",{children:[s.jsxs(i,{children:["Status",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs(y,{value:r.status,onValueChange:t=>a("status",t),children:[s.jsx(N,{className:"w-full",children:s.jsx(g,{placeholder:"Select Status"})}),s.jsxs(C,{children:[s.jsx(m,{value:"unpaid",children:"Unpaid"}),s.jsx(m,{value:"paid",children:"Paid"})]})]}),d("status")]}),s.jsxs("div",{children:[s.jsxs(i,{children:["Method",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs(y,{value:r.method,onValueChange:t=>a("method",t),children:[s.jsx(N,{className:"w-full",children:s.jsx(g,{placeholder:"Select Method"})}),s.jsxs(C,{children:[s.jsx(m,{value:"cash",children:"Cash"}),s.jsx(m,{value:"card",children:"Card"}),s.jsx(m,{value:"stripe",children:"Stripe"})]})]}),d("method")]}),s.jsxs("div",{children:[s.jsx(i,{children:"Transaction ID"}),s.jsx(f,{type:"text",value:r.transaction_id,onChange:t=>a("transaction_id",t.target.value),placeholder:"Optional transaction ID"}),d("transaction_id")]}),s.jsxs("div",{children:[s.jsx(i,{children:"Pay At"}),s.jsxs(B,{children:[s.jsx(Y,{asChild:!0,children:s.jsxs(_,{variant:"outline",className:"w-full justify-start text-left font-normal "+(!r.pay_at&&"text-muted-foreground"),children:[s.jsx(F,{className:"mr-2 h-4 w-4"}),r.pay_at?u(new Date(r.pay_at),"PPP"):"Pick a date"]})}),s.jsx(E,{className:"w-auto p-0",children:s.jsx(T,{mode:"single",selected:r.pay_at?new Date(r.pay_at):void 0,onSelect:t=>a("pay_at",t?u(t,"yyyy-MM-dd"):""),initialFocus:!0})})]}),d("pay_at")]}),s.jsxs("div",{children:[s.jsx(i,{children:"Due Date"}),s.jsxs(B,{children:[s.jsx(Y,{asChild:!0,children:s.jsxs(_,{variant:"outline",className:"w-full justify-start text-left font-normal "+(!r.due_date&&"text-muted-foreground"),children:[s.jsx(F,{className:"mr-2 h-4 w-4"}),r.due_date?u(new Date(r.due_date),"PPP"):"Pick a date"]})}),s.jsx(E,{className:"w-auto p-0",children:s.jsx(T,{mode:"single",selected:r.due_date?new Date(r.due_date):void 0,onSelect:t=>a("due_date",t?u(t,"yyyy-MM-dd"):""),initialFocus:!0})})]}),d("due_date")]}),s.jsx("div",{className:"col-span-2",children:s.jsxs(S,{children:[s.jsx(b,{children:s.jsx(w,{className:"text-base",children:"Fee Plan Details"})}),s.jsxs(D,{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(i,{children:"Plan"}),s.jsx("div",{className:"mt-1 text-sm",children:((M=e==null?void 0:e.plan)==null?void 0:M.name)||"Custom"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Currency"}),s.jsx("div",{className:"mt-1 text-sm",children:(e==null?void 0:e.currency_code)||((k=e==null?void 0:e.plan)==null?void 0:k.currency_code)||"-"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Base Amount"}),s.jsx("div",{className:"mt-1 text-sm",children:typeof(e==null?void 0:e.base_amount)<"u"?e==null?void 0:e.base_amount:"-"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Effective Amount"}),s.jsx("div",{className:"mt-1 text-sm",children:typeof(e==null?void 0:e.effective_amount)<"u"?e==null?void 0:e.effective_amount:"-"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Interval"}),s.jsxs("div",{className:"mt-1 text-sm",children:[e==null?void 0:e.interval,(e==null?void 0:e.interval)==="custom"&&(e!=null&&e.interval_count)?` (${e==null?void 0:e.interval_count})`:""]})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Discount"}),s.jsx("div",{className:"mt-1 text-sm",children:e!=null&&e.discount_type?`${e==null?void 0:e.discount_type} ${e==null?void 0:e.discount_value}`:"None"})]})]})]})})]}),s.jsxs(S,{className:"w-full",children:[s.jsx(b,{children:s.jsx(w,{className:"text-base",children:"Fee Plan Details"})}),s.jsxs(D,{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(i,{children:"Plan"}),s.jsx("div",{className:"mt-1 text-sm",children:(($=e==null?void 0:e.plan)==null?void 0:$.name)||"Custom"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Currency"}),s.jsx("div",{className:"mt-1 text-sm",children:(e==null?void 0:e.currency_code)||((I=e==null?void 0:e.plan)==null?void 0:I.currency_code)||"-"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Base Amount"}),s.jsx("div",{className:"mt-1 text-sm",children:typeof(e==null?void 0:e.base_amount)<"u"?e==null?void 0:e.base_amount:"-"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Effective Amount"}),s.jsx("div",{className:"mt-1 text-sm",children:typeof(e==null?void 0:e.effective_amount)<"u"?e==null?void 0:e.effective_amount:"-"})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Interval"}),s.jsxs("div",{className:"mt-1 text-sm",children:[e==null?void 0:e.interval,(e==null?void 0:e.interval)==="custom"&&(e!=null&&e.interval_count)?` (${e==null?void 0:e.interval_count})`:""]})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Discount"}),s.jsx("div",{className:"mt-1 text-sm",children:e!=null&&e.discount_type?`${e==null?void 0:e.discount_type} ${e==null?void 0:e.discount_value}`:"None"})]})]})]}),s.jsxs("div",{children:[s.jsx(i,{children:"Notes"}),s.jsx(f,{value:r.notes,onChange:t=>a("notes",t.target.value)})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(i,{className:"text-base font-semibold",children:"Bank Information (Select banks to show on invoice)"}),p&&p.length>0?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.map(t=>s.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg",children:[s.jsx(G,{id:`bank-${t.id}`,checked:r.bank_information.includes(t.id),onCheckedChange:o=>V(t.id,o)}),s.jsxs("div",{className:"flex-1",children:[s.jsx(i,{htmlFor:`bank-${t.id}`,className:"text-sm font-medium cursor-pointer",children:t.bank_name}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.account_name," -"," ",t.account_number,t.currency&&` (${t.currency})`]})]})]},t.id))}):s.jsxs("div",{className:"p-4 border border-dashed rounded-lg text-center text-muted-foreground",children:[s.jsx("p",{children:"No bank information available."}),s.jsx("p",{className:"text-sm",children:"Please add bank information first."})]}),d("bank_information")]}),s.jsx("div",{className:"pt-4",children:s.jsx(_,{type:"submit",children:"Save"})})]})})]})})]})}export{hs as default};
