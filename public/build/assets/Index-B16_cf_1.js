import{r as d,y as C,j as e,Y as T,a as N}from"./app-C7QOoTmK.js";import{A as S,t as h}from"./authenticated-layout-Byski1ZN.js";import{C as k,a as A,b as D,c as M}from"./card-Bz-PV3i5.js";import{T as O,a as R,b as p,c as g,d as E,e as b}from"./table-Dzc01Q7z.js";import{f as l}from"./format-7_oTgTIh.js";import{e as F,a as H,s as J}from"./startOfMonth-alQccdl5.js";import"./button-BwnA5GFK.js";import"./input-Dw712aEx.js";import"./index-Ckf3Y_8P.js";function K({studentsWithAttendance:o,filters:m}){const[r,j]=d.useState(()=>({date:m.date||l(new Date,"yyyy-MM")})),y=d.useRef(m);d.useEffect(()=>{x(o)},[o]),d.useEffect(()=>{const t=setTimeout(()=>{JSON.stringify(r)!==JSON.stringify(y.current)&&C.get(route("club.attendances.index"),r,{preserveState:!0,replace:!0,only:["studentsWithAttendance"],onFinish:()=>console.log("Request completed")})},500);return()=>clearTimeout(t)},[r]);const u=r.date?new Date(r.date+"-01"):new Date,f=F({start:J(u),end:H(u)}),[v,x]=d.useState(o),w=async(t,s,c)=>{const a=c?"present":"absent";try{await N.post(route("club.attendances.toggle"),{student_id:t,date:s,status:a}),x(i=>i.map(n=>({...n,records:n.student.id===t?{...n.records,[s]:a}:n.records}))),h.success(`Attendance marked as ${a}`)}catch{h.error("Failed to update attendance")}};return e.jsxs(S,{header:"Attendances",children:[e.jsx(T,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(k,{children:[e.jsx(A,{children:e.jsx(D,{children:"Attendance List"})}),e.jsxs(M,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:e.jsx("div",{className:"grid gap-2",children:e.jsx("input",{id:"month-picker",type:"month",value:r.date,onChange:t=>{j(s=>({...s,date:t.target.value}))},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[" ",e.jsxs(O,{children:[e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(g,{children:"Student"}),f.map(t=>e.jsx(g,{className:"text-center min-w-[40px]",children:l(t,"dd")},t.toString()))]})}),e.jsx(E,{children:v.map(({student:t,records:s})=>e.jsxs(p,{children:[e.jsx(b,{children:t.name}),f.map(c=>{const a=l(c,"yyyy-MM-dd"),i=s[a];return e.jsx(b,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:i==="present",onChange:n=>w(t.id,a,n.target.checked)})},a)})]},t.id))})]})]})})]})]})})]})}export{K as default};
