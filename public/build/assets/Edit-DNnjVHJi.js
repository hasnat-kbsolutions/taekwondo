import{W as H,m as O,j as e,Y as U}from"./app-CNLR0DIp.js";import{B as v}from"./button-BFvzOohO.js";import{S as _,a as g,b as N,c as y,e as m}from"./select-B8yE-HKp.js";import{I as C}from"./input-BdDHIpxK.js";import{L as a}from"./label-DDNeWs3Y.js";import{C as M,a as k,b as B,c as E}from"./card-A51GI-p_.js";import{A as W}from"./authenticated-layout-DutDL5IX.js";import{C as I}from"./react-icons.esm-CQCVVGcd.js";import{P as Y,a as $,b as A}from"./popover-PMlw8EkZ.js";import{C as T}from"./calendar-D_eNKtLk.js";import{C as q}from"./checkbox-CjlDWkYj.js";import{f as h}from"./format-LUeNQFBy.js";import"./index-RVYuYhkN.js";import"./index-CwCbuvh8.js";import"./index-BswMLaOF.js";import"./chevron-down-Di6Iui4y.js";import"./sun-CboAYruK.js";import"./separator-DTrM_Ru7.js";import"./users-CUo-C-vI.js";import"./log-out-B1kDetli.js";function xe({payment:r,students:j=[],studentFeePlans:p=[],bank_information:f=[],currencies:z=[]}){var b,w,D;const{data:i,setData:x,put:V,processing:L,errors:S}=H({student_id:r.student_id||"",month:r.month||"",notes:r.notes||"",amount:r.amount||"",status:r.status||"unpaid",method:r.method||"cash",pay_at:r.pay_at||"",due_date:r.due_date||"",transaction_id:r.transaction_id||"",currency_code:r.currency_code||"MYR",bank_information:((b=r.bank_information)==null?void 0:b.map(s=>s.id))||[]}),t=O.useMemo(()=>i.student_id?p.find(s=>String(s.student_id)===String(i.student_id)):null,[i.student_id,p]),n=(s,o)=>{var u;if(x(s,o),s==="student_id"){const c=p.find(l=>String(l.student_id)===String(o));if(c){typeof c.effective_amount<"u"&&x("amount",String(c.effective_amount));const l=c.currency_code||((u=c.plan)==null?void 0:u.currency_code);l&&x("currency_code",l)}}},F=(s,o)=>{const u=i.bank_information,c=o?[...u,s]:u.filter(l=>l!==s);x("bank_information",c)},R=s=>{s.preventDefault(),V(route("admin.payments.update",r.id))},d=s=>S[s]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:S[s]});return e.jsxs(W,{header:"Edit Payment",children:[e.jsx(U,{title:"Edit Payment"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(M,{children:[e.jsx(k,{children:e.jsx(B,{children:"Edit Payment"})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(a,{children:["Student",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(_,{value:String(i.student_id||""),onValueChange:s=>n("student_id",s),children:[e.jsx(g,{className:"w-full",children:e.jsx(N,{placeholder:"Select Student"})}),e.jsx(y,{children:j&&j.length>0?j.map(s=>e.jsxs(m,{value:String(s.id),children:[s.name," ",s.surname||""]},s.id)):e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No students available"})})]}),d("student_id")]}),e.jsxs("div",{children:[e.jsx(a,{children:"Month (YYYY-MM)"}),e.jsx(C,{type:"month",value:i.month,onChange:s=>n("month",s.target.value)}),d("month")]}),e.jsxs("div",{children:[e.jsxs(a,{children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(_,{value:i.status,onValueChange:s=>n("status",s),children:[e.jsx(g,{className:"w-full",children:e.jsx(N,{placeholder:"Select Status"})}),e.jsxs(y,{children:[e.jsx(m,{value:"unpaid",children:"Unpaid"}),e.jsx(m,{value:"paid",children:"Paid"})]})]}),d("status")]}),e.jsxs("div",{children:[e.jsxs(a,{children:["Method",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(_,{value:i.method,onValueChange:s=>n("method",s),children:[e.jsx(g,{className:"w-full",children:e.jsx(N,{placeholder:"Select Method"})}),e.jsxs(y,{children:[e.jsx(m,{value:"cash",children:"Cash"}),e.jsx(m,{value:"card",children:"Card"}),e.jsx(m,{value:"stripe",children:"Stripe"})]})]}),d("method")]}),e.jsxs("div",{children:[e.jsx(a,{children:"Transaction ID"}),e.jsx(C,{type:"text",value:i.transaction_id,onChange:s=>n("transaction_id",s.target.value),placeholder:"Optional transaction ID"}),d("transaction_id")]}),e.jsxs("div",{children:[e.jsx(a,{children:"Pay At"}),e.jsxs(Y,{children:[e.jsx($,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:"w-full justify-start text-left font-normal "+(!i.pay_at&&"text-muted-foreground"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),i.pay_at?h(new Date(i.pay_at),"PPP"):"Pick a date"]})}),e.jsx(A,{className:"w-auto p-0",children:e.jsx(T,{mode:"single",selected:i.pay_at?new Date(i.pay_at):void 0,onSelect:s=>n("pay_at",s?h(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),d("pay_at")]}),e.jsxs("div",{children:[e.jsx(a,{children:"Due Date"}),e.jsxs(Y,{children:[e.jsx($,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:"w-full justify-start text-left font-normal "+(!i.due_date&&"text-muted-foreground"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),i.due_date?h(new Date(i.due_date),"PPP"):"Pick a date"]})}),e.jsx(A,{className:"w-auto p-0",children:e.jsx(T,{mode:"single",selected:i.due_date?new Date(i.due_date):void 0,onSelect:s=>n("due_date",s?h(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),d("due_date")]}),e.jsx("div",{className:"col-span-2",children:e.jsxs(M,{children:[e.jsx(k,{children:e.jsx(B,{className:"text-base",children:"Fee Plan Details"})}),e.jsxs(E,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{children:"Plan"}),e.jsx("div",{className:"mt-1 text-sm",children:((w=t==null?void 0:t.plan)==null?void 0:w.name)||"Custom"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Currency"}),e.jsx("div",{className:"mt-1 text-sm",children:(t==null?void 0:t.currency_code)||((D=t==null?void 0:t.plan)==null?void 0:D.currency_code)||"-"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Base Amount"}),e.jsx("div",{className:"mt-1 text-sm",children:typeof(t==null?void 0:t.base_amount)<"u"?t==null?void 0:t.base_amount:"-"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Effective Amount"}),e.jsx("div",{className:"mt-1 text-sm",children:typeof(t==null?void 0:t.effective_amount)<"u"?t==null?void 0:t.effective_amount:"-"})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Interval"}),e.jsxs("div",{className:"mt-1 text-sm",children:[t==null?void 0:t.interval,(t==null?void 0:t.interval)==="custom"&&(t!=null&&t.interval_count)?` (${t==null?void 0:t.interval_count})`:""]})]}),e.jsxs("div",{children:[e.jsx(a,{children:"Discount"}),e.jsx("div",{className:"mt-1 text-sm",children:t!=null&&t.discount_type?`${t==null?void 0:t.discount_type} ${t==null?void 0:t.discount_value}`:"None"})]})]})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(a,{children:"Notes"}),e.jsx(C,{value:i.notes,onChange:s=>n("notes",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(a,{className:"text-base font-semibold",children:"Bank Information (Select banks to show on invoice)"}),f&&f.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg",children:[e.jsx(q,{id:`bank-${s.id}`,checked:i.bank_information.includes(s.id),onCheckedChange:o=>F(s.id,o)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(a,{htmlFor:`bank-${s.id}`,className:"text-sm font-medium cursor-pointer",children:s.bank_name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.account_name," -"," ",s.account_number,s.currency&&` (${s.currency})`]})]})]},s.id))}):e.jsxs("div",{className:"p-4 border border-dashed rounded-lg text-center text-muted-foreground",children:[e.jsx("p",{children:"No bank information available."}),e.jsx("p",{className:"text-sm",children:"Please add bank information first."})]}),d("bank_information")]}),e.jsx("div",{className:"pt-4",children:e.jsx(v,{type:"submit",disabled:L,children:"Save"})})]})})]})})]})}export{xe as default};
