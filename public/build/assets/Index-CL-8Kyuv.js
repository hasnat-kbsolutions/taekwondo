import{r as n,W as Ye,j as e,Y as Ee,b as A,y as x}from"./app-Cf1f6aE6.js";import{A as Fe,B as Pe,t as N,D as Te,a as Oe,b as Ie,c as m}from"./authenticated-layout-BWUFX903.js";import{B as d}from"./button-DYamWovx.js";import{B as Le}from"./badge-CeMOusya.js";import{S as _,a as k,b as U,c as R,e as h}from"./select-CfH3MtOu.js";import{D as J,a as W,b as $,c as z,d as K,e as Y}from"./dialog-Dbn_6erV.js";import{D as Ve}from"./DataTable-D051YenH.js";import{C as v,a as b,b as w,c as S}from"./card-DSPrioW3.js";import{L as j}from"./label-C6JvFhuR.js";import{W as oe}from"./wallet-P2F5Ez6-.js";import{H as He}from"./hourglass-D77aSiTI.js";import{F as me,U as he}from"./upload-33lujPG8.js";import{D as xe}from"./download-B2XQRWNO.js";import{T as ue}from"./trash-2-D37-9hG9.js";import{C as pe}from"./circle-x-CMRzTw-s.js";import{E as Je}from"./ellipsis-CGogZ84-.js";import{E as We}from"./eye-CmYwpKF_.js";import{S as $e}from"./square-pen-BbKJ1NtR.js";import{C as ze}from"./circle-check-big-DrEmkmXL.js";import{F as Ke}from"./file-text-BFXgkLMo.js";import"./input-Cs79MDSo.js";import"./separator-C9zOXLy-.js";import"./index-DAYrs0Gt.js";import"./sun-DHFgHePi.js";import"./users-CzVlTGY4.js";import"./log-out-arwFQeNm.js";import"./index-BM1F2IY_.js";import"./index-CEcug2ab.js";import"./chevron-down-BVoNkL2R.js";import"./table-CqNVoMw1.js";const Be=new Date().getFullYear(),qe=["All",...Array.from({length:5},(B,o)=>(Be-o).toString())],Xe=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function Ms({payments:B,filters:o,currencies:je,totalPayments:fe,paidPayments:ge,unpaidPayments:ye,amountsByCurrency:u,defaultCurrencyCode:f}){var ae,le,ne,ie,re,ce;const[E,q]=n.useState(o.status||""),[F,X]=n.useState(o.payment_month?o.payment_month.length===4?o.payment_month:o.payment_month.split("-")[0]:"All"),[P,T]=n.useState(((ae=o.payment_month)==null?void 0:ae.split("-")[1])||""),[O,G]=n.useState(o.currency_code||""),C=(s,t)=>{const i=Number(s)||0;return t==="JPY"?i.toLocaleString():i.toFixed(2)},[r,Ne]=n.useState(null),[ve,I]=n.useState(!1),[a,L]=n.useState(null),[be,g]=n.useState(!1),[Q,D]=n.useState(null),[p,V]=n.useState(null),[l,y]=n.useState({open:!1,payment:null,newStatus:null}),{data:Z,setData:we,processing:ee,errors:se,reset:H}=Ye({attachment:null}),Se=s=>{Ne(s),I(!0)},te=s=>{var i;const t=(i=s.target.files)==null?void 0:i[0];if(V(t||null),t){if(t.type.startsWith("image/")){const c=new FileReader;c.onloadend=()=>{D(c.result)},c.readAsDataURL(t)}else D(null);we("attachment",t)}},Ce=()=>{var t;if(!Z.attachment||!a){N.error("Please select a file to upload");return}const s=new FormData;s.append("attachment",Z.attachment),(t=a.attachment)!=null&&t.id&&s.append("replace_attachment_id",a.attachment.id.toString()),x.post(route("admin.payments.upload-attachment",{payment:a.id}),s,{onSuccess:()=>{N.success(a.attachment?"Attachment updated successfully":"Attachment uploaded successfully"),g(!1),D(null),V(null),H(),x.reload({only:["payments"]})},onError:()=>{N.error("Failed to upload attachment")}})},De=()=>{a!=null&&a.attachment&&confirm("Are you sure you want to delete this attachment?")&&x.delete(route("admin.payments.delete-attachment",{attachment:a.attachment.id}),{onSuccess:()=>{N.success("Attachment deleted successfully"),g(!1),L(null),x.reload({only:["payments"]})},onError:()=>{N.error("Failed to delete attachment")}})},Me=({year:s,month:t,status:i,currency:c})=>{const M=s==="All"?"":t?`${s}-${t}`:s;console.log("Filter Values:",{year:s,month:t,status:i,currency:c,paymentMonth:M}),x.get(route("admin.payments.index"),{status:i||null,payment_month:M||null,currency_code:c||null},{preserveScroll:!0,preserveState:!0,replace:!0})},[Ae,_e]=n.useState(!0);n.useEffect(()=>{if(Ae){_e(!1);return}Me({year:F,month:P,status:E,currency:O})},[F,P,E,O]);const ke=()=>{q(""),X("All"),T(""),G(""),x.get(route("admin.payments.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})},Ue=[{header:"#",cell:({row:s})=>s.index+1},{header:"Student",cell:({row:s})=>{var t;return((t=s.original.student)==null?void 0:t.name)||"-"}},{header:"Amount",cell:({row:s})=>{var de;const t=s.original,i=t.amount,c=t.currency_code,M=((de=t.currency)==null?void 0:de.symbol)||c,Re=C(i,c);return e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[c==="MYR"?"RM ":M,Re]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:c})]})}},{header:"Status",cell:({row:s})=>e.jsx(Le,{variant:s.original.status==="paid"||s.original.status==="success"?"default":"destructive",children:s.original.status})},{header:"Method",accessorKey:"method"},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",accessorKey:"pay_at"},{header:"Proof",cell:({row:s})=>{const t=s.original;return e.jsx("div",{className:"flex items-center gap-2",children:t.attachment?e.jsx(me,{className:"w-4 h-4 text-primary"}):e.jsx(pe,{className:"w-4 h-4 text-muted-foreground"})})}},{header:"Actions",cell:({row:s})=>e.jsxs(Te,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Je,{className:"h-4 w-4"})})}),e.jsxs(Ie,{align:"end",children:[e.jsxs(m,{onClick:()=>Se(s.original),children:[e.jsx(We,{className:"w-4 h-4 mr-2"})," View"]}),e.jsx(m,{asChild:!0,children:e.jsxs(A,{href:route("admin.payments.edit",s.original.id),children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Edit"]})}),s.original.status==="unpaid"&&e.jsxs(m,{onClick:t=>{t.preventDefault(),y({open:!0,payment:s.original,newStatus:"paid"})},children:[e.jsx(ze,{className:"w-4 h-4 mr-2"})," Mark as Paid"]}),(s.original.status==="paid"||s.original.status==="success")&&e.jsxs(m,{onClick:t=>{t.preventDefault(),y({open:!0,payment:s.original,newStatus:"unpaid"})},children:[e.jsx(pe,{className:"w-4 h-4 mr-2"})," Mark as Unpaid"]}),e.jsxs(m,{onClick:t=>{t.preventDefault(),L(s.original),g(!0)},children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),s.original.attachment?"Manage":"Upload"," ","Proof"]}),e.jsx(m,{asChild:!0,children:e.jsxs(A,{href:route("admin.payments.destroy",s.original.id),method:"delete",as:"button",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Delete"]})}),e.jsx(m,{asChild:!0,children:e.jsxs(A,{href:route("invoice.show",{payment:s.original.id}),children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"})," Invoice"]})}),e.jsxs(m,{onClick:t=>{t.preventDefault();const i=route("invoice.download",{payment:s.original.id});window.open(i,"_blank")},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Download Invoice"]})]})]})}];return e.jsxs(Fe,{header:"Payments",children:[e.jsx(Ee,{title:"Payments"}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Total Payments"}),e.jsx(oe,{className:"h-6 w-6 text-primary"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold",children:fe||0})})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Paid"}),e.jsx(Pe,{className:"h-6 w-6 text-green-600"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:ge||0})})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Unpaid"}),e.jsx(He,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:ye||0})})]}),e.jsxs(v,{className:"col-span-1 sm:col-span-2 lg:col-span-4",children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(w,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(oe,{className:"h-6 w-6 text-primary"})]}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"text-lg font-bold",children:[f==="MYR"?"RM":f||""," ",C((u==null?void 0:u[f||"MYR"])||0,f||"MYR")]}),u&&Object.keys(u).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(u).filter(([s])=>s!==f).map(([s,t])=>e.jsxs("div",{children:[s==="MYR"?"RM":s," ",C(t,s)]},s))})]})})]})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsx(w,{children:"Payments"}),e.jsx(A,{href:route("admin.payments.create"),children:e.jsx(d,{children:"Add Payment"})})]}),e.jsxs(S,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(j,{className:"text-sm mb-1",children:"Year"}),e.jsxs(_,{value:F,onValueChange:s=>{X(s),s==="All"&&T("")},children:[e.jsx(k,{children:e.jsx(U,{placeholder:"Year"})}),e.jsx(R,{children:qe.map(s=>e.jsx(h,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(j,{className:"text-sm mb-1",children:"Month"}),e.jsxs(_,{value:P,onValueChange:s=>T(s==="all"?"":s),children:[e.jsx(k,{children:e.jsx(U,{placeholder:"Month"})}),e.jsxs(R,{children:[e.jsx(h,{value:"all",children:"All"}),Xe.map(s=>e.jsx(h,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(j,{className:"text-sm mb-1",children:"Status"}),e.jsxs(_,{value:E,onValueChange:s=>q(s==="all"?"":s),children:[e.jsx(k,{children:e.jsx(U,{placeholder:"All Statuses"})}),e.jsxs(R,{children:[e.jsx(h,{value:"all",children:"All"}),e.jsx(h,{value:"paid",children:"Paid"}),e.jsx(h,{value:"unpaid",children:"Unpaid"})]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(j,{className:"text-sm mb-1",children:"Currency"}),e.jsxs(_,{value:O,onValueChange:s=>G(s==="all"?"":s),children:[e.jsx(k,{children:e.jsx(U,{placeholder:"All Currencies"})}),e.jsxs(R,{children:[e.jsx(h,{value:"all",children:"All"}),je.map(s=>e.jsxs(h,{value:s.code,children:[s.code," -"," ",s.symbol]},s.code))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(d,{variant:"secondary",onClick:ke,children:"Reset Filters"})})]})}),e.jsx(Ve,{data:B,columns:Ue})]})]}),e.jsx(J,{open:ve,onOpenChange:I,children:e.jsxs(W,{className:"w-full",children:[e.jsxs($,{children:[e.jsx(z,{className:"text-3xl text-foreground",children:"Edit Payment"}),e.jsx(K,{className:"text-muted-foreground",children:"Update payment details like amount and status."})]}),r&&e.jsxs("div",{className:"space-y-2 text-sm ",children:[e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Student:"})," ",(le=r.student)==null?void 0:le.name]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Amount:"})," ",((ne=r.currency)==null?void 0:ne.symbol)||"RM"," ",r.amount," (",r.currency_code,")"]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Method:"})," ",r.method]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Payment Month:"})," ",r.payment_month]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Pay At:"})," ",r.pay_at]}),r.notes&&e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Notes:"})," ",r.notes]})]}),e.jsx(Y,{children:e.jsx(d,{onClick:()=>I(!1),children:"Close"})})]})}),e.jsx(J,{open:be,onOpenChange:g,children:e.jsxs(W,{className:"max-w-2xl",children:[e.jsxs($,{children:[e.jsx(z,{children:a!=null&&a.attachment?"Update Payment Proof":"Upload Payment Proof"}),e.jsx(K,{children:"Upload an image or PDF as proof of payment. Max 5MB."})]}),e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.attachment)&&!p&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(me,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.attachment.original_filename}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.attachment.file_type.toUpperCase()})]})]})}),a.attachment.file_type.match(/^(jpg|jpeg|png|gif|webp)$/i)&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:`/storage/${a.attachment.file_path}`,alt:"Current proof",className:"w-full h-auto max-h-64 object-contain bg-white"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{a!=null&&a.attachment&&window.open(route("admin.payments.download-attachment",{attachment:a.attachment.id}),"_blank")},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(d,{size:"sm",variant:"destructive",className:"flex-1",onClick:De,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),Q&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-muted/50",children:e.jsx("img",{src:Q,alt:"Preview",className:"w-full h-auto max-h-64 object-contain"})})]}),(!(a!=null&&a.attachment)||p)&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),Ce()},children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(j,{htmlFor:"attachment",children:"Select File"}),e.jsx("input",{id:"attachment",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:te,className:"file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-4 file:py-2 file:mr-4 text-sm"}),se.attachment&&e.jsx("p",{className:"text-sm text-red-600",children:se.attachment})]})}),e.jsxs(Y,{className:"gap-2 mt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>{p?(V(null),D(null),H()):(g(!1),L(null),H())},children:p?"Cancel":"Close"}),p&&e.jsx(d,{type:"submit",disabled:ee,children:ee?"Uploading...":a!=null&&a.attachment?"Replace":"Upload"})]})]}),e.jsx("input",{id:"attachment-hidden",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:te,className:"hidden"}),(a==null?void 0:a.attachment)&&!p&&e.jsx(Y,{children:e.jsxs(d,{variant:"outline",onClick:()=>{var s;(s=document.getElementById("attachment-hidden"))==null||s.click()},children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Replace with New File"]})})]})]})}),e.jsx(J,{open:l.open,onOpenChange:s=>{s||y({open:!1,payment:null,newStatus:null})},children:e.jsxs(W,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Confirm Status Change"}),e.jsxs(K,{children:["Are you sure you want to change the payment status from"," ",e.jsx("strong",{children:((ie=l.payment)==null?void 0:ie.status)==="paid"?"Paid":"Unpaid"})," ","to"," ",e.jsx("strong",{children:l.newStatus==="paid"?"Paid":"Unpaid"}),"?"]})]}),l.payment&&e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Student:"})," ",(re=l.payment.student)==null?void 0:re.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",((ce=l.payment.currency)==null?void 0:ce.symbol)||"",C(l.payment.amount,l.payment.currency_code)," ",l.payment.currency_code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Month:"})," ",l.payment.payment_month]})]})}),e.jsxs(Y,{children:[e.jsx(d,{variant:"outline",onClick:()=>{y({open:!1,payment:null,newStatus:null})},children:"Cancel"}),e.jsx(d,{onClick:()=>{l.payment&&l.newStatus&&x.patch(route("admin.payments.updateStatus",l.payment.id),{status:l.newStatus},{onSuccess:()=>{y({open:!1,payment:null,newStatus:null})}})},children:"Confirm"})]})]})})]})]})}export{Ms as default};
