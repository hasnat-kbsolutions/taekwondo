import{r as o,y as x,j as e,Y as _,a as I}from"./app-CHTahs9w.js";import{A as z,t as w}from"./authenticated-layout-B6_x2nFS.js";import{C as y,a as C,b as A,c as T}from"./card-BVi_isWq.js";import{B as m}from"./button-61_i5sA_.js";import{L as k}from"./label-nHQe9Kkw.js";import{S as M,a as D,b as Y,c as L,e as $}from"./select-DIgUbpof.js";import{T as W,a as q,b as F,c as h,d as G,e as u}from"./table-D8s5HKRf.js";import{e as J,a as K,s as P}from"./startOfMonth-alQccdl5.js";import{f as B}from"./format-7_oTgTIh.js";import"./input-CUTqb1li.js";import"./separator-Dz2BaDO3.js";import"./index-Bi5xXDMA.js";import"./sun-BU1_nhbK.js";import"./users-kcFiN24-.js";import"./log-out-phlCMelP.js";import"./index-cg3SeDw5.js";import"./index-CYDQTcHE.js";import"./chevron-down-DKEUU5xW.js";function ue({studentsWithAttendance:E,filters:p}){var N,v;const d=new Date().getFullYear(),j=(new Date().getMonth()+1).toString().padStart(2,"0"),[c,f]=o.useState(((N=p.date)==null?void 0:N.split("-")[0])||d.toString()),[l,g]=o.useState(((v=p.date)==null?void 0:v.split("-")[1])||j);o.useEffect(()=>{const t=setTimeout(()=>{const a={date:`${c}-${l}`};x.get(route("instructor.attendances.index"),a,{preserveState:!0,replace:!0,only:["studentsWithAttendance"]})},300);return()=>clearTimeout(t)},[c,l]);const S=new Date(`${c}-${l}-01`),b=J({start:P(S),end:K(S)}),[H,O]=o.useState(E),R=async(t,s,a)=>{const r=a?"present":"absent";try{await I.post(route("instructor.attendances.toggle"),{student_id:t,date:s,status:r}),O(i=>i.map(n=>({...n,records:n.student.id===t?{...n.records,[s]:r}:n.records}))),w.success(`Attendance marked as ${r}`)}catch{w.error("Failed to update attendance")}},V=()=>{f(d.toString()),g(j)};return e.jsxs(z,{header:"Attendances",children:[e.jsx(_,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-5",children:e.jsxs(y,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between",children:[e.jsx(A,{children:"Filters"}),e.jsx(m,{onClick:()=>x.get(route("instructor.attendances.create")),className:"bg-primary text-background",children:"Create Attendance"})]}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(k,{className:"text-sm mb-1",children:"Year"}),e.jsxs(M,{value:c,onValueChange:f,children:[e.jsx(D,{children:e.jsx(Y,{placeholder:"Year"})}),e.jsx(L,{children:Array.from({length:5},(t,s)=>(d-s).toString()).map(t=>e.jsx($,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(k,{className:"text-sm mb-1",children:"Month"}),e.jsxs(M,{value:l,onValueChange:g,children:[e.jsx(D,{children:e.jsx(Y,{placeholder:"Month"})}),e.jsx(L,{children:Array.from({length:12},(t,s)=>{const a=(s+1).toString().padStart(2,"0");return e.jsx($,{value:a,children:new Date(0,s).toLocaleString("default",{month:"long"})},a)})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(m,{className:"bg-primary text-background",onClick:V,children:"Reset Filters"})})]})})]})}),e.jsx("div",{className:"container mx-auto",children:e.jsxs(y,{children:[e.jsx(C,{children:e.jsx(A,{children:"Attendance List"})}),e.jsx(T,{children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(F,{children:[e.jsx(h,{children:"Student"}),b.map(t=>e.jsx(h,{className:"text-center min-w-[40px]",children:B(t,"dd")},t.toString())),e.jsx(h,{className:"text-center",children:"Actions"})]})}),e.jsx(G,{children:H.map(({student:t,records:s})=>e.jsxs(F,{children:[e.jsxs(u,{children:[t.name," ",t.surname]}),b.map(a=>{const r=B(a,"yyyy-MM-dd"),i=s[r];return e.jsx(u,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:i==="present",onChange:n=>R(t.id,r,n.target.checked)})},r)}),e.jsx(u,{className:"text-center",children:e.jsx("div",{className:"flex justify-center space-x-2",children:e.jsx(m,{size:"sm",variant:"outline",onClick:()=>x.get(route("instructor.attendances.create")),children:"Add"})})})]},t.id))})]})})})})]})})]})}export{ue as default};
