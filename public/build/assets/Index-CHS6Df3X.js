import{r as g,W as X,j as e,Y as q,y as N,b as Q}from"./app-7XFigbmq.js";import{A as Z,W as T,B as ee,D as te,a as ae,b as se,c as F,t as w}from"./authenticated-layout-B6kGi5TT.js";import{B as i}from"./button-CCcPhxbK.js";import{C as h,a as x,b as p,c as f}from"./card-BKWKaNas.js";import{L as C}from"./label-ztH3PvpF.js";import{S as le,a as ne,b as ie,c as re,e as ce}from"./select-Dnkl5v9W.js";import{D as oe}from"./DataTable-CYfQn6yM.js";import{D as de,a as me,b as he,c as xe,d as pe,e as E}from"./dialog-CnpdXIFW.js";import{F as z}from"./file-check-BCLxPlP4.js";import{D as I}from"./download-OjLig0MA.js";import{T as fe}from"./trash-2-QeIVhHGm.js";import{U as L}from"./upload-CbRi6k0e.js";import{H as je}from"./hourglass-DG2uoKFQ.js";import{C as ue}from"./circle-x-DpPaFevA.js";import{E as ge}from"./ellipsis-BHF0nFoR.js";import{F as Ne}from"./file-text-DkuEkhrt.js";import{f as we}from"./format-LUeNQFBy.js";import"./input-CnohFrKr.js";import"./separator-DyyDiEGZ.js";import"./index-DEaZXpuG.js";import"./sun-NolOlq6D.js";import"./users-2aCKo87b.js";import"./log-out-Bg06zR0y.js";import"./index-CHEfl8Xa.js";import"./index-D4rJs81K.js";import"./chevron-down-5jzcqLDA.js";import"./table-uXPPKHso.js";const b=new Date().getFullYear(),ye=Array.from({length:31},(l,n)=>b-15+n),k=(l,n="MYR")=>{const r=Number(l)||0;return n==="JPY"?r.toLocaleString():r.toFixed(2)},ve=l=>{if(l===0)return"0 Bytes";const n=1024,r=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(l)/Math.log(n));return Math.round(l/Math.pow(n,y)*100)/100+" "+r[y]};function qe({year:l,payments:n,totalPayments:r,paidPayments:y,pendingPayments:O,unpaidPayments:be,amountsByCurrency:c,defaultCurrencyCode:j}){const[$,R]=g.useState(l||b),B=t=>{const s=parseInt(t);R(s),N.get(route("student.payments.index"),{year:s})},H=()=>{R(b),N.get(route("student.payments.index"),{year:b})},W=[{header:"#",cell:({row:t})=>t.index+1},{header:"Amount",cell:({row:t})=>{var m;const s=((m=t.original.currency)==null?void 0:m.symbol)||"RM",d=t.original.currency_code||"MYR";return`${s} ${k(t.original.amount,d)}`}},{header:"Method",accessorKey:"method"},{header:"Status",cell:({row:t})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.original.status==="paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.original.status})},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",cell:({row:t})=>t.original.pay_at?we(new Date(t.original.pay_at),"MMM dd, yyyy"):"-"},{header:"Notes",cell:({row:t})=>t.original.notes||"-"},{header:"Proof",cell:({row:t})=>{const s=t.original;return e.jsx("div",{className:"flex items-center gap-2",children:s.attachment?e.jsx(z,{className:"w-4 h-4 text-primary"}):e.jsx(ue,{className:"w-4 h-4 text-muted-foreground"})})}},{header:"Actions",cell:({row:t})=>e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",children:[e.jsx(F,{asChild:!0,children:e.jsxs(Q,{href:route("invoice.show",{payment:t.original.id}),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"})," View Invoice"]})}),e.jsxs(F,{onClick:s=>{s.preventDefault();const d=route("invoice.download",{payment:t.original.id});window.open(d,"_blank")},children:[e.jsx(I,{className:"w-4 h-4 mr-2"})," Download Invoice"]}),e.jsxs(F,{onClick:s=>{s.preventDefault(),D(t.original),u(!0)},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),t.original.attachment?"Manage":"Upload"," ","Proof"]})]})]})}],[K,u]=g.useState(!1),[a,D]=g.useState(null),[Y,v]=g.useState(null),[o,M]=g.useState(null),{data:_,setData:V,processing:A,errors:U,reset:S}=X({attachment:null}),P=t=>{var d;const s=(d=t.target.files)==null?void 0:d[0];if(M(s||null),s){if(s.type.startsWith("image/")){const m=new FileReader;m.onloadend=()=>{v(m.result)},m.readAsDataURL(s)}else v(null);V("attachment",s)}},G=()=>{var s;if(!_.attachment||!a){w.error("Please select a file to upload");return}const t=new FormData;t.append("attachment",_.attachment),(s=a.attachment)!=null&&s.id&&t.append("replace_attachment_id",a.attachment.id.toString()),N.post(route("student.payments.upload-attachment",{payment:a.id}),t,{onSuccess:()=>{w.success(a.attachment?"Attachment updated successfully":"Attachment uploaded successfully"),u(!1),v(null),M(null),S()},onError:()=>{w.error("Failed to upload attachment")}})},J=()=>{a!=null&&a.attachment&&confirm("Are you sure you want to delete this attachment?")&&N.delete(route("student.payments.delete-attachment",{attachment:a.attachment.id}),{onSuccess:()=>{w.success("Attachment deleted successfully"),u(!1),D(null),N.reload({only:["payments"]})},onError:()=>{w.error("Failed to delete attachment")}})};return e.jsxs(Z,{header:"My Payments",children:[e.jsx(q,{title:"My Payments"}),e.jsx(de,{open:K,onOpenChange:u,children:e.jsxs(me,{className:"max-w-2xl",children:[e.jsxs(he,{children:[e.jsx(xe,{children:a!=null&&a.attachment?"Update Payment Proof":"Upload Payment Proof"}),e.jsx(pe,{children:"Upload an image or PDF as proof of payment. Max 5MB."})]}),e.jsxs("div",{className:"space-y-4",children:[(a==null?void 0:a.attachment)&&!o&&e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(z,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.attachment.original_filename}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.attachment.file_type.toUpperCase()," ","â€¢"," ",ve(a.attachment.file_size)]})]})]})}),a.attachment.file_type.match(/^(jpg|jpeg|png|gif|webp)$/i)&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:`/storage/${a.attachment.file_path}`,alt:"Current proof",className:"w-full h-auto max-h-64 object-contain bg-white"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{a!=null&&a.attachment&&window.open(route("student.payments.download-attachment",{attachment:a.attachment.id}),"_blank")},children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Download"]}),e.jsxs(i,{size:"sm",variant:"destructive",className:"flex-1",onClick:J,children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),Y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-muted/50",children:e.jsx("img",{src:Y,alt:"Preview",className:"w-full h-auto max-h-64 object-contain"})})]}),(!(a!=null&&a.attachment)||o)&&e.jsxs("form",{onSubmit:t=>{t.preventDefault(),G()},children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(C,{htmlFor:"attachment",children:"Select File"}),e.jsx("input",{id:"attachment",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:P,className:"file:border-0 file:bg-primary file:text-primary-foreground file:rounded-md file:px-4 file:py-2 file:mr-4 text-sm"}),U.attachment&&e.jsx("p",{className:"text-sm text-red-600",children:U.attachment})]})}),e.jsxs(E,{className:"gap-2 mt-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>{o?(M(null),v(null),S()):(u(!1),D(null),S())},children:o?"Cancel":"Close"}),o&&e.jsx(i,{type:"submit",disabled:A,children:A?"Uploading...":a!=null&&a.attachment?"Replace":"Upload"})]})]}),e.jsx("input",{id:"attachment-hidden",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:P,className:"hidden"}),(a==null?void 0:a.attachment)&&!o&&e.jsx(E,{children:e.jsxs(i,{variant:"outline",onClick:()=>{var t;(t=document.getElementById("attachment-hidden"))==null||t.click()},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Replace with New File"]})})]})]})}),e.jsxs("div",{className:"container mx-auto py-10 space-y-6",children:[e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(p,{children:"Filters"})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[180px]",children:[e.jsx(C,{className:"text-sm mb-1",children:"Year"}),e.jsxs(le,{onValueChange:B,value:$.toString(),children:[e.jsx(ne,{children:e.jsx(ie,{placeholder:"Select a year"})}),e.jsx(re,{children:ye.map(t=>e.jsx(ce,{value:t.toString(),children:t},t))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(i,{onClick:H,children:"Reset Filters"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Payments"}),e.jsx(T,{className:"h-6 w-6 text-primary"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold",children:r||0})})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Paid"}),e.jsx(ee,{className:"h-6 w-6 text-green-600"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y||0})})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Unpaid"}),e.jsx(je,{className:"h-6 w-6 text-yellow-500"})]}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:O||0})})]}),e.jsxs(h,{className:"col-span-1 sm:col-span-2 lg:col-span-4",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(T,{className:"h-6 w-6 text-primary"})]}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"text-lg font-bold",children:[j==="MYR"?"RM":j," ",k((c==null?void 0:c[j||"MYR"])||0,j||"MYR")]}),c&&Object.keys(c).length>1&&e.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:Object.entries(c).filter(([t])=>t!==j).map(([t,s])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t,":"]}),e.jsx("span",{children:k(s,t)})]},t))})]})})]})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(p,{children:"My Payments"})}),e.jsx(f,{children:e.jsx(oe,{data:n,columns:W})})]})]})]})}export{qe as default};
