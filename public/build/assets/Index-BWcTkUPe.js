import{r,j as e,Y as U,b as d,y as k}from"./app-2gn4RfSZ.js";import{B as u}from"./button-BIncYwTu.js";import{B as H}from"./badge-BdwXvqD0.js";import{A as $,D as q,a as z,b as X,c as o}from"./authenticated-layout-Cg-1muXU.js";import{S as h,a as x,b as p,c as j,e as i}from"./select-DucK0tRK.js";import{D as G,a as Q,b as W,c as Z,d as ee,e as se}from"./dialog-DhmpaYvM.js";import{D as ae}from"./DataTable-DGXkLYlU.js";import{C as te,a as le,b as ne,c as re}from"./card-aDrCg9A8.js";import{L as y}from"./label-DHZZwbSO.js";import{E as ie}from"./ellipsis-Da7RdrnB.js";import{E as ce}from"./eye-D0bOhJrm.js";import{S as oe}from"./square-pen-l5RzgZWa.js";import{C as de}from"./circle-check-big-CkUaz1X6.js";import{C as me}from"./circle-x-BxOfsFzc.js";import{T as ue}from"./trash-2-DD-1iLwA.js";import{F as he}from"./file-text-PEhMVDmf.js";import{D as xe}from"./download-MkR0Ff7t.js";import"./input-Dj8_zug_.js";import"./separator-B-OjaV0S.js";import"./index-Bkygkmel.js";import"./createLucideIcon-DybH0MdA.js";import"./building-2-DNx1rPF9.js";import"./users-CkuQDTLu.js";import"./log-out-C5WUean8.js";import"./sun-CBb6fQqu.js";import"./index-CBzvCrkR.js";import"./index-BFcKiWpC.js";import"./chevron-down-ytmlgpZO.js";import"./table-2ad5ZTOX.js";const pe=new Date().getFullYear(),je=["All",...Array.from({length:5},(S,l)=>(pe-l).toString())],ye=[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}];function qe({payments:S,filters:l,currencies:E}){var M,P,_;const[f,w]=r.useState(l.status||""),[g,A]=r.useState(l.payment_month?l.payment_month.length===4?l.payment_month:l.payment_month.split("-")[0]:"All"),[b,v]=r.useState(((M=l.payment_month)==null?void 0:M.split("-")[1])||""),[N,D]=r.useState(l.currency_code||""),Y=(s,a)=>{const n=Number(s)||0;return a==="JPY"?n.toLocaleString():n.toFixed(2)},[t,T]=r.useState(null),[V,C]=r.useState(!1),I=s=>{T(s),C(!0)},L=({year:s,month:a,status:n,currency:c})=>{const m=s==="All"?"":a?`${s}-${a}`:s;console.log("Filter Values:",{year:s,month:a,status:n,currency:c,paymentMonth:m}),k.get(route("admin.payments.index"),{status:n||null,payment_month:m||null,currency_code:c||null},{preserveScroll:!0,preserveState:!0,replace:!0})},[B,R]=r.useState(!0);r.useEffect(()=>{if(B){R(!1);return}L({year:g,month:b,status:f,currency:N})},[g,b,f,N]);const J=()=>{w(""),A("All"),v(""),D(""),k.get(route("admin.payments.index"),{},{preserveScroll:!0,preserveState:!1,replace:!0})},K=[{header:"#",cell:({row:s})=>s.index+1},{header:"Student",cell:({row:s})=>{var a;return((a=s.original.student)==null?void 0:a.name)||"-"}},{header:"Amount",cell:({row:s})=>{var F;const a=s.original,n=a.amount,c=a.currency_code,m=((F=a.currency)==null?void 0:F.symbol)||c,O=Y(n,c);return e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[c==="MYR"?"RM ":m,O]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:c})]})}},{header:"Status",cell:({row:s})=>e.jsx(H,{variant:s.original.status==="paid"||s.original.status==="success"?"default":"destructive",children:s.original.status})},{header:"Method",accessorKey:"method"},{header:"Payment Month",accessorKey:"payment_month"},{header:"Pay At",accessorKey:"pay_at"},{header:"Actions",cell:({row:s})=>e.jsxs(q,{children:[e.jsx(z,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsxs(X,{align:"end",children:[e.jsxs(o,{onClick:()=>I(s.original),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"})," View"]}),e.jsx(o,{asChild:!0,children:e.jsxs(d,{href:route("admin.payments.edit",s.original.id),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"})," Edit"]})}),s.original.status==="unpaid"&&e.jsx(o,{asChild:!0,children:e.jsxs(d,{href:route("admin.payments.updateStatus",s.original.id),method:"patch",data:{status:"paid"},as:"button",children:[e.jsx(de,{className:"w-4 h-4 mr-2"})," ","Mark as Paid"]})}),(s.original.status==="paid"||s.original.status==="success")&&e.jsx(o,{asChild:!0,children:e.jsxs(d,{href:route("admin.payments.updateStatus",s.original.id),method:"patch",data:{status:"unpaid"},as:"button",children:[e.jsx(me,{className:"w-4 h-4 mr-2"})," Mark as Unpaid"]})}),e.jsx(o,{asChild:!0,children:e.jsxs(d,{href:route("admin.payments.destroy",s.original.id),method:"delete",as:"button",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Delete"]})}),e.jsx(o,{asChild:!0,children:e.jsxs(d,{href:route("invoice.show",{payment:s.original.id}),children:[e.jsx(he,{className:"w-4 h-4 mr-2"})," Invoice"]})}),e.jsxs(o,{onClick:a=>{a.preventDefault();const n=route("invoice.download",{payment:s.original.id});window.open(n,"_blank")},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Download Invoice"]})]})]})}];return e.jsxs($,{header:"Payments",children:[e.jsx(U,{title:"Payments"}),e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs(te,{children:[e.jsxs(le,{className:"flex flex-row items-center justify-between",children:[e.jsx(ne,{children:"Payments"}),e.jsx(d,{href:route("admin.payments.create"),children:e.jsx(u,{children:"Add Payment"})})]}),e.jsxs(re,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(y,{className:"text-sm mb-1",children:"Year"}),e.jsxs(h,{value:g,onValueChange:s=>{A(s),s==="All"&&v("")},children:[e.jsx(x,{children:e.jsx(p,{placeholder:"Year"})}),e.jsx(j,{children:je.map(s=>e.jsx(i,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(y,{className:"text-sm mb-1",children:"Month"}),e.jsxs(h,{value:b,onValueChange:s=>v(s==="all"?"":s),children:[e.jsx(x,{children:e.jsx(p,{placeholder:"Month"})}),e.jsxs(j,{children:[e.jsx(i,{value:"all",children:"All"}),ye.map(s=>e.jsx(i,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(y,{className:"text-sm mb-1",children:"Status"}),e.jsxs(h,{value:f,onValueChange:s=>w(s==="all"?"":s),children:[e.jsx(x,{children:e.jsx(p,{placeholder:"All Statuses"})}),e.jsxs(j,{children:[e.jsx(i,{value:"all",children:"All"}),e.jsx(i,{value:"paid",children:"Paid"}),e.jsx(i,{value:"unpaid",children:"Unpaid"})]})]})]}),e.jsxs("div",{className:"flex flex-col w-[160px]",children:[e.jsx(y,{className:"text-sm mb-1",children:"Currency"}),e.jsxs(h,{value:N,onValueChange:s=>D(s==="all"?"":s),children:[e.jsx(x,{children:e.jsx(p,{placeholder:"All Currencies"})}),e.jsxs(j,{children:[e.jsx(i,{value:"all",children:"All"}),E.map(s=>e.jsxs(i,{value:s.code,children:[s.code," -"," ",s.symbol]},s.code))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(u,{variant:"secondary",onClick:J,children:"Reset Filters"})})]})}),e.jsx(ae,{data:S,columns:K})]})]}),e.jsx(G,{open:V,onOpenChange:C,children:e.jsxs(Q,{className:"w-full",children:[e.jsxs(W,{children:[e.jsx(Z,{className:"text-3xl text-foreground",children:"Edit Payment"}),e.jsx(ee,{className:"text-muted-foreground",children:"Update payment details like amount and status."})]}),t&&e.jsxs("div",{className:"space-y-2 text-sm ",children:[e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Student:"})," ",(P=t.student)==null?void 0:P.name]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Amount:"})," ",((_=t.currency)==null?void 0:_.symbol)||"RM"," ",t.amount," (",t.currency_code,")"]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Status:"})," ",t.status]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Method:"})," ",t.method]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Payment Month:"})," ",t.payment_month]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Pay At:"})," ",t.pay_at]}),t.notes&&e.jsxs("p",{className:"flex justify-between",children:[e.jsx("strong",{children:"Notes:"})," ",t.notes]})]}),e.jsx(se,{children:e.jsx(u,{onClick:()=>C(!1),children:"Close"})})]})})]})]})}export{qe as default};
