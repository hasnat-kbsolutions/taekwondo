import{r as l,y as M,j as e,Y as O,a as z}from"./app-C8-svnQh.js";import{A as R,t as x}from"./authenticated-layout-CtINddQR.js";import{C as E,a as H,b as V,c as I}from"./card-Cvuq4wNP.js";import{S as p,a as f,b as g,c as j,d as b,e as y}from"./select-Jr2DV3jZ.js";import{T as J,a as L,b as v,c as S,d as q,e as C}from"./table-B3B55m6C.js";import{e as B,a as F,s as G}from"./startOfMonth-alQccdl5.js";import{f as m}from"./format-7_oTgTIh.js";import"./button-Dq3BAU6g.js";import"./input-bCp47spT.js";import"./index-B8fxqQYZ.js";import"./index-DeUBShaD.js";import"./index-BCMVRlKF.js";import"./chevron-down-CmpPDW4_.js";function ne({studentsWithAttendance:w,clubs:N,organizations:T,filters:i}){const[s,c]=l.useState(()=>({club_id:i.club_id||"",organization_id:i.organization_id||"",date:i.date||m(new Date,"yyyy-MM")})),A=l.useRef(i);l.useEffect(()=>{const t=setTimeout(()=>{JSON.stringify(s)!==JSON.stringify(A.current)&&M.get(route("admin.attendances.index"),s,{preserveState:!0,replace:!0,only:["studentsWithAttendance"],onFinish:()=>console.log("Request completed")})},500);return()=>clearTimeout(t)},[s]);const u=s.date?new Date(s.date+"-01"):new Date,h=B({start:G(u),end:F(u)}),[_,k]=l.useState(w),D=async(t,a,o)=>{const n=o?"present":"absent";try{await z.post(route("admin.attendances.toggle"),{student_id:t,date:a,status:n}),k(d=>d.map(r=>({...r,records:r.student.id===t?{...r.records,[a]:n}:r.records}))),x.success(`Attendance marked as ${n}`)}catch{x.error("Failed to update attendance")}};return e.jsxs(R,{header:"Attendances",children:[e.jsx(O,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-10",children:e.jsxs(E,{children:[e.jsx(H,{children:e.jsx(V,{children:"Attendance List"})}),e.jsxs(I,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(p,{value:s.club_id,onValueChange:t=>c(a=>({...a,club_id:t})),children:[e.jsx(f,{className:"w-full",children:e.jsx(g,{placeholder:"All Clubs"})}),e.jsx(j,{children:e.jsx(b,{children:N.map(t=>e.jsx(y,{value:String(t.id),children:t.name},t.id))})})]}),e.jsxs(p,{value:s.organization_id,onValueChange:t=>c(a=>({...a,organization_id:t})),children:[e.jsx(f,{className:"w-full",children:e.jsx(g,{placeholder:"All Organizations"})}),e.jsx(j,{children:e.jsx(b,{children:T.map(t=>e.jsx(y,{value:String(t.id),children:t.name},t.id))})})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx("input",{id:"month-picker",type:"month",value:s.date,onChange:t=>{c(a=>({...a,date:t.target.value}))},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[" ",e.jsxs(J,{children:[e.jsx(L,{children:e.jsxs(v,{children:[e.jsx(S,{children:"Student"}),h.map(t=>e.jsx(S,{className:"text-center min-w-[40px]",children:m(t,"dd")},t.toString()))]})}),e.jsx(q,{children:_.map(({student:t,records:a})=>e.jsxs(v,{children:[e.jsx(C,{children:t.name}),h.map(o=>{const n=m(o,"yyyy-MM-dd"),d=a[n];return e.jsx(C,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:d==="present",onChange:r=>D(t.id,n,r.target.checked)})},n)})]},t.id))})]})]})})]})]})})]})}export{ne as default};
