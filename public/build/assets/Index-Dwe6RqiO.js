import{r as l,y as E,j as e,Y as F,b as H,a as O}from"./app-DW2TxMgL.js";import{A as R,t as T}from"./authenticated-layout-B_yFzDtv.js";import{C as I,a as W,b as q,c as G}from"./card-CqzSjebV.js";import{B as J}from"./button-CsZSMTLi.js";import{L as u}from"./label-Bvb_2ToT.js";import{S as p,a as j,b as f,c as g,e as o}from"./select-Cj2JwZec.js";import{T as K,a as P,b as M,c as _,d as Q,e as D}from"./table-Jd8h4bTV.js";import{e as U,a as X,s as Z}from"./startOfMonth-Bwwd0hjf.js";import{f as Y}from"./format-LUeNQFBy.js";import"./input-nn3PE6Gg.js";import"./separator-BM8IWe7h.js";import"./index-C9Zwqpo7.js";import"./sun-Dutj5cWs.js";import"./users-B7MXfBln.js";import"./log-out-Dry3ofyU.js";import"./index-lrOY0KwQ.js";import"./index-m-EOdtvA.js";import"./chevron-down-ClaI-n98.js";function ge({studentsWithAttendance:k,clubs:L,filters:m}){var y,A;const x=new Date().getFullYear(),b=(new Date().getMonth()+1).toString().padStart(2,"0"),[c,S]=l.useState(((y=m.date)==null?void 0:y.split("-")[0])||x.toString()),[i,v]=l.useState(((A=m.date)==null?void 0:A.split("-")[1])||b),[h,w]=l.useState(()=>({club_id:m.club_id||""}));l.useEffect(()=>{const t=setTimeout(()=>{const a=`${c}-${i}`,s={...h,date:a};E.get(route("organization.attendances.index"),s,{preserveState:!0,replace:!0,only:["studentsWithAttendance"]})},300);return()=>clearTimeout(t)},[c,i,h.club_id]);const C=new Date(`${c}-${i}-01`),N=U({start:Z(C),end:X(C)}),[$,V]=l.useState(k),z=async(t,a,s)=>{const r=s?"present":"absent";try{await O.post(route("organization.attendances.toggle"),{student_id:t,date:a,status:r}),V(d=>d.map(n=>({...n,records:n.student.id===t?{...n.records,[a]:r}:n.records}))),T.success(`Attendance marked as ${r}`)}catch{T.error("Failed to update attendance")}},B=()=>{S(x.toString()),v(b),w({club_id:""})};return e.jsxs(R,{header:"Attendances",children:[e.jsx(F,{title:"Attendances"}),e.jsx("div",{className:"container mx-auto py-5",children:e.jsxs(I,{children:[e.jsx(W,{children:e.jsx(q,{children:"Attendance List"})}),e.jsxs(G,{children:[e.jsx("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Club"}),e.jsxs(p,{value:h.club_id,onValueChange:t=>w(a=>({...a,club_id:t})),children:[e.jsx(j,{children:e.jsx(f,{placeholder:"All Clubs"})}),e.jsxs(g,{children:[e.jsx(o,{value:"all",children:"All"}),L.map(t=>e.jsx(o,{value:t.id.toString(),children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Year"}),e.jsxs(p,{value:c,onValueChange:S,children:[e.jsx(j,{children:e.jsx(f,{placeholder:"Year"})}),e.jsx(g,{children:Array.from({length:5},(t,a)=>(x-a).toString()).map(t=>e.jsx(o,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex flex-col w-[200px]",children:[e.jsx(u,{className:"text-sm mb-1",children:"Month"}),e.jsxs(p,{value:i,onValueChange:v,children:[e.jsx(j,{children:e.jsx(f,{placeholder:"Month"})}),e.jsx(g,{children:Array.from({length:12},(t,a)=>{const s=(a+1).toString().padStart(2,"0");return e.jsx(o,{value:s,children:new Date(0,a).toLocaleString("default",{month:"long"})},s)})})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(J,{variant:"secondary",onClick:B,children:"Reset Filters"})})]})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[800px]",children:e.jsxs(K,{children:[e.jsx(P,{children:e.jsxs(M,{children:[e.jsx(_,{children:"Student"}),N.map(t=>e.jsx(_,{className:"text-center min-w-[40px]",children:Y(t,"dd")},t.toString()))]})}),e.jsx(Q,{children:$.map(({student:t,records:a})=>e.jsxs(M,{children:[e.jsx(D,{children:e.jsx(H,{href:route("organization.students.edit",t.id),className:"text-blue-600 hover:text-blue-800 hover:underline font-medium",children:t.name})}),N.map(s=>{const r=Y(s,"yyyy-MM-dd"),d=a[r];return e.jsx(D,{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:d==="present",onChange:n=>z(t.id,r,n.target.checked)})},r)})]},t.id))})]})})})]})]})})]})}export{ge as default};
